<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>I AM SLOW WALKER, BUT I NEVER WALK BACK</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://lmwtuedu.cn/"/>
  <updated>2019-09-25T05:33:20.853Z</updated>
  <id>http://lmwtuedu.cn/</id>
  
  <author>
    <name>darker</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title></title>
    <link href="http://lmwtuedu.cn/2019/09/25/2019-09-25-%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8-%E5%8E%9F%E5%AD%90%E6%80%A7%E6%A6%82%E5%BF%B5-01/"/>
    <id>http://lmwtuedu.cn/2019/09/25/2019-09-25-线程安全-原子性概念-01/</id>
    <published>2019-09-25T02:40:54.430Z</published>
    <updated>2019-09-25T05:33:20.853Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Google和baidu 一下讲解多线程的很多很多。<br>通过我的学习以及记录一些我认为“有条理”的多线程。</p></blockquote><h1 id="线程的原子性"><a href="#线程的原子性" class="headerlink" title="线程的原子性"></a>线程的原子性</h1><p>我对于原子性的理解： “不可拆分；不可中断，全部执行完或者全部不执行”。</p><p>线程针对于原子性（Atomicity）的操作就是安全的。所以我们只需要保证操作的对象是原子性的就可以了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="comment">// 线程不安全</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountExample1</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 请求总数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> clientTotal = <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 同时并发执行的线程数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> threadTotal = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 线程池</span></span><br><span class="line">        ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class="line">        <span class="comment">// 信号（[ˈseməfɔː(r)]）</span></span><br><span class="line">        <span class="keyword">final</span> Semaphore semaphore = <span class="keyword">new</span> Semaphore(threadTotal);</span><br><span class="line">        <span class="keyword">final</span> CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(clientTotal);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; clientTotal ; i++) &#123;</span><br><span class="line">            executorService.execute(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    semaphore.acquire();</span><br><span class="line">                    add();</span><br><span class="line">                    semaphore.release();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">"exception"</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">                countDownLatch.countDown();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        countDownLatch.await();</span><br><span class="line">        executorService.shutdown();</span><br><span class="line">        log.info(<span class="string">"count:&#123;&#125;"</span>, count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们先看看上述的程序，功能实现是：多线程针对于 add() 方法进行操作； add方法只是简单的做了count++。</p><p>Q：那么线程是安全的吗？<br>A：线程的安全是什么： 原子性，原子性是不可拆分的， count++可以进行拆分为： count = count + 1; 三步操作：1.count 值取出来； 2.  +1  3. 赋值给count<br>所以线程不是安全的。</p><p>如何保证现场安全呢？ </p><p>常见将 add换成这样子</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     count++;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>加上了 synchronized. synchronized是啥？ 可以理解为 “锁” 锁到底是啥呢？ 目前简单的举一个例子： 厕所只有一个蹲坑； 你要使用它，那么就得一个一个来，上厕所的人先要关门<br>上完的人出来，下一个人才能进去。 synchronized就是“门锁”  特别注意：synchronized 是不可被打断的。</p><p>疑问点： synchronized 锁， 锁的是啥？ 对象、方法、还是类呢？ Reentranlock又是啥？ Reentranlock与synchronized的区别？</p><p>OK。 原子性概念已经讲解完毕。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;Google和baidu 一下讲解多线程的很多很多。&lt;br&gt;通过我的学习以及记录一些我认为“有条理”的多线程。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;线程的原子性&quot;&gt;&lt;a href=&quot;#线程的原子性&quot; class=&quot;headerlin
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>燕十八的MYSQL练习</title>
    <link href="http://lmwtuedu.cn/2018/10/17/2018-10-17-%E7%87%95%E5%8D%81%E5%85%ABMYSQL%E7%BB%83%E4%B9%A0/"/>
    <id>http://lmwtuedu.cn/2018/10/17/2018-10-17-燕十八MYSQL练习/</id>
    <published>2018-10-16T16:00:00.000Z</published>
    <updated>2019-09-17T08:34:06.081Z</updated>
    
    <content type="html"><![CDATA[<h1 id="燕十八的MYSQL练习"><a href="#燕十八的MYSQL练习" class="headerlink" title="燕十八的MYSQL练习"></a>燕十八的MYSQL练习</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> goods (</span><br><span class="line">  goods_id mediumint(<span class="number">8</span>) <span class="keyword">unsigned</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">  goods_name <span class="built_in">varchar</span>(<span class="number">120</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">''</span>,</span><br><span class="line">  cat_id <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">'0'</span>,</span><br><span class="line">  brand_id <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">'0'</span>,</span><br><span class="line">  goods_sn <span class="built_in">char</span>(<span class="number">15</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">''</span>,</span><br><span class="line">  goods_number <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">'0'</span>,</span><br><span class="line">  shop_price <span class="built_in">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">'0.00'</span>,</span><br><span class="line">  market_price <span class="built_in">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">'0.00'</span>,</span><br><span class="line">  click_count <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">'0'</span></span><br><span class="line">) <span class="keyword">engine</span>=myisam <span class="keyword">default</span> <span class="keyword">charset</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">`goods`</span> </span><br><span class="line"><span class="keyword">values</span> </span><br><span class="line">(<span class="number">1</span>,<span class="string">'kd876'</span>,<span class="number">4</span>,<span class="number">8</span>,<span class="string">'ecs000000'</span>,<span class="number">1</span>,<span class="number">1388.00</span>,<span class="number">1665.60</span>,<span class="number">9</span>),</span><br><span class="line">(<span class="number">4</span>,<span class="string">'诺基亚n85原装充电器'</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="string">'ecs000004'</span>,<span class="number">17</span>,<span class="number">58.00</span>,<span class="number">69.60</span>,<span class="number">0</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="string">'诺基亚原装5800耳机'</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="string">'ecs000002'</span>,<span class="number">24</span>,<span class="number">68.00</span>,<span class="number">81.60</span>,<span class="number">3</span>),</span><br><span class="line">(<span class="number">5</span>,<span class="string">'索爱原装m2卡读卡器'</span>,<span class="number">11</span>,<span class="number">7</span>,<span class="string">'ecs000005'</span>,<span class="number">8</span>,<span class="number">20.00</span>,<span class="number">24.00</span>,<span class="number">3</span>),</span><br><span class="line">(<span class="number">6</span>,<span class="string">'胜创kingmax内存卡'</span>,<span class="number">11</span>,<span class="number">0</span>,<span class="string">'ecs000006'</span>,<span class="number">15</span>,<span class="number">42.00</span>,<span class="number">50.40</span>,<span class="number">0</span>),</span><br><span class="line">(<span class="number">7</span>,<span class="string">'诺基亚n85原装立体声耳机hs-82'</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="string">'ecs000007'</span>,<span class="number">20</span>,<span class="number">100.00</span>,<span class="number">120.00</span>,<span class="number">0</span>),</span><br><span class="line">(<span class="number">8</span>,<span class="string">'飞利浦9@9v'</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="string">'ecs000008'</span>,<span class="number">1</span>,<span class="number">399.00</span>,<span class="number">478.79</span>,<span class="number">10</span>),</span><br><span class="line">(<span class="number">9</span>,<span class="string">'诺基亚e66'</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="string">'ecs000009'</span>,<span class="number">4</span>,<span class="number">2298.00</span>,<span class="number">2757.60</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">10</span>,<span class="string">'索爱c702c'</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="string">'ecs000010'</span>,<span class="number">7</span>,<span class="number">1328.00</span>,<span class="number">1593.60</span>,<span class="number">11</span>),</span><br><span class="line">(<span class="number">11</span>,<span class="string">'索爱c702c'</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="string">'ecs000011'</span>,<span class="number">1</span>,<span class="number">1300.00</span>,<span class="number">0.00</span>,<span class="number">0</span>),</span><br><span class="line">(<span class="number">12</span>,<span class="string">'摩托罗拉a810'</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="string">'ecs000012'</span>,<span class="number">8</span>,<span class="number">983.00</span>,<span class="number">1179.60</span>,<span class="number">13</span>),</span><br><span class="line">(<span class="number">13</span>,<span class="string">'诺基亚5320 xpressmusic'</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="string">'ecs000013'</span>,<span class="number">8</span>,<span class="number">1311.00</span>,<span class="number">1573.20</span>,<span class="number">13</span>),</span><br><span class="line">(<span class="number">14</span>,<span class="string">'诺基亚5800xm'</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="string">'ecs000014'</span>,<span class="number">1</span>,<span class="number">2625.00</span>,<span class="number">3150.00</span>,<span class="number">6</span>),</span><br><span class="line">(<span class="number">15</span>,<span class="string">'摩托罗拉a810'</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="string">'ecs000015'</span>,<span class="number">3</span>,<span class="number">788.00</span>,<span class="number">945.60</span>,<span class="number">8</span>),</span><br><span class="line">(<span class="number">16</span>,<span class="string">'恒基伟业g101'</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="string">'ecs000016'</span>,<span class="number">0</span>,<span class="number">823.33</span>,<span class="number">988.00</span>,<span class="number">3</span>),</span><br><span class="line">(<span class="number">17</span>,<span class="string">'夏新n7'</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="string">'ecs000017'</span>,<span class="number">1</span>,<span class="number">2300.00</span>,<span class="number">2760.00</span>,<span class="number">2</span>),</span><br><span class="line">(<span class="number">18</span>,<span class="string">'夏新t5'</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="string">'ecs000018'</span>,<span class="number">1</span>,<span class="number">2878.00</span>,<span class="number">3453.60</span>,<span class="number">0</span>),</span><br><span class="line">(<span class="number">19</span>,<span class="string">'三星sgh-f258'</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="string">'ecs000019'</span>,<span class="number">12</span>,<span class="number">858.00</span>,<span class="number">1029.60</span>,<span class="number">7</span>),</span><br><span class="line">(<span class="number">20</span>,<span class="string">'三星bc01'</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="string">'ecs000020'</span>,<span class="number">12</span>,<span class="number">280.00</span>,<span class="number">336.00</span>,<span class="number">14</span>),</span><br><span class="line">(<span class="number">21</span>,<span class="string">'金立 a30'</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="string">'ecs000021'</span>,<span class="number">40</span>,<span class="number">2000.00</span>,<span class="number">2400.00</span>,<span class="number">4</span>),</span><br><span class="line">(<span class="number">22</span>,<span class="string">'多普达touch hd'</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="string">'ecs000022'</span>,<span class="number">1</span>,<span class="number">5999.00</span>,<span class="number">7198.80</span>,<span class="number">16</span>),</span><br><span class="line">(<span class="number">23</span>,<span class="string">'诺基亚n96'</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="string">'ecs000023'</span>,<span class="number">8</span>,<span class="number">3700.00</span>,<span class="number">4440.00</span>,<span class="number">17</span>),</span><br><span class="line">(<span class="number">24</span>,<span class="string">'p806'</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="string">'ecs000024'</span>,<span class="number">100</span>,<span class="number">2000.00</span>,<span class="number">2400.00</span>,<span class="number">35</span>),</span><br><span class="line">(<span class="number">25</span>,<span class="string">'小灵通/固话50元充值卡'</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="string">'ecs000025'</span>,<span class="number">2</span>,<span class="number">48.00</span>,<span class="number">57.59</span>,<span class="number">0</span>),</span><br><span class="line">(<span class="number">26</span>,<span class="string">'小灵通/固话20元充值卡'</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="string">'ecs000026'</span>,<span class="number">2</span>,<span class="number">19.00</span>,<span class="number">22.80</span>,<span class="number">0</span>),</span><br><span class="line">(<span class="number">27</span>,<span class="string">'联通100元充值卡'</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="string">'ecs000027'</span>,<span class="number">2</span>,<span class="number">95.00</span>,<span class="number">100.00</span>,<span class="number">0</span>),</span><br><span class="line">(<span class="number">28</span>,<span class="string">'联通50元充值卡'</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="string">'ecs000028'</span>,<span class="number">0</span>,<span class="number">45.00</span>,<span class="number">50.00</span>,<span class="number">0</span>),</span><br><span class="line">(<span class="number">29</span>,<span class="string">'移动100元充值卡'</span>,<span class="number">14</span>,<span class="number">0</span>,<span class="string">'ecs000029'</span>,<span class="number">0</span>,<span class="number">90.00</span>,<span class="number">0.00</span>,<span class="number">0</span>),</span><br><span class="line">(<span class="number">30</span>,<span class="string">'移动20元充值卡'</span>,<span class="number">14</span>,<span class="number">0</span>,<span class="string">'ecs000030'</span>,<span class="number">9</span>,<span class="number">18.00</span>,<span class="number">21.00</span>,<span class="number">1</span>),</span><br><span class="line">(<span class="number">31</span>,<span class="string">'摩托罗拉e8 '</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="string">'ecs000031'</span>,<span class="number">1</span>,<span class="number">1337.00</span>,<span class="number">1604.39</span>,<span class="number">5</span>),</span><br><span class="line">(<span class="number">32</span>,<span class="string">'诺基亚n85'</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="string">'ecs000032'</span>,<span class="number">4</span>,<span class="number">3010.00</span>,<span class="number">3612.00</span>,<span class="number">9</span>);</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fwb97u6yzmj30sb0fjnek.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><h2 id="where"><a href="#where" class="headerlink" title="where"></a>where</h2><p>1.0 查询主键微32的商品</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">where</span> goods_id = <span class="number">32</span>;</span><br></pre></td></tr></table></figure><p>1.1 不属于第3栏目的所有商品</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span> goods <span class="keyword">where</span> cat_id !=<span class="number">3</span>;</span><br></pre></td></tr></table></figure><p>1.2 本店价格高于3000元的商品</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span> goods <span class="keyword">where</span> shop_price &gt; <span class="number">3000</span>;</span><br></pre></td></tr></table></figure><p>1.3 本店价格低于或等于100元的商品 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span> goods <span class="keyword">where</span> shop_price &lt;=<span class="number">100</span>;</span><br></pre></td></tr></table></figure><p>1.4 取出第4栏目或第11栏目的商品(不许用or) </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span> goods <span class="keyword">where</span> cat_id <span class="keyword">in</span> (<span class="number">4</span>,<span class="number">11</span>);</span><br></pre></td></tr></table></figure><p>1.5 取出100&lt;=价格&lt;=500的商品(不许用and) </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">where</span> shop_price <span class="keyword">between</span> <span class="number">100</span> <span class="keyword">and</span> <span class="number">500</span>;</span><br></pre></td></tr></table></figure><p>1.6 取出不属于第3栏目且不属于第11栏目的商品(and,或not in分别实现) </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">where</span> cat_id !=<span class="number">3</span> <span class="keyword">and</span> cat_id != <span class="number">11</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">where</span> cat_id <span class="keyword">not</span> <span class="keyword">in</span>(<span class="number">3</span>,<span class="number">11</span>);</span><br></pre></td></tr></table></figure><p>1.7 取出价格大于100且小于300,或者大于4000且小于5000的商品() </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">where</span> (shop_price &gt; <span class="number">100</span> <span class="keyword">and</span> shop_price &lt; <span class="number">300</span>) <span class="keyword">or</span> (shop_price &gt; <span class="number">4000</span> <span class="keyword">and</span> shop_price &lt; <span class="number">5000</span>);</span><br></pre></td></tr></table></figure><p>1.8 取出第3个栏目下面价格&lt;1000或&gt;3000,并且点击量&gt;5的系列商品</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">where</span> cat_id =<span class="number">3</span> <span class="keyword">and</span> (shop_price &lt;<span class="number">1000</span> <span class="keyword">or</span> shop_price &gt;<span class="number">3000</span>) <span class="keyword">and</span> click_count &gt; <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">where</span> cat_id =<span class="number">3</span> <span class="keyword">and</span> ( shop_price <span class="keyword">not</span> <span class="keyword">between</span> <span class="number">1000</span> <span class="keyword">and</span> <span class="number">3000</span>) <span class="keyword">and</span> click_count &gt; <span class="number">5</span>;</span><br></pre></td></tr></table></figure><p>1.10 取出名字以”诺基亚”开头的商品 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">where</span> goods_name <span class="keyword">like</span> <span class="string">"诺基亚%"</span>;</span><br></pre></td></tr></table></figure><p>1.11 取出名字为”诺基亚Nxx”的手机 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">where</span> goods_name <span class="keyword">like</span> <span class="string">"诺基亚N%"</span>;</span><br></pre></td></tr></table></figure><p>1.12 取出名字不以”诺基亚”开头的商品 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">where</span> goods_name <span class="keyword">not</span> <span class="keyword">like</span> <span class="string">"诺基亚%"</span>;</span><br></pre></td></tr></table></figure><p>1.13 取出第3个栏目下面价格在1000到3000之间,并且点击量&gt;5 “诺基亚”开头的系列商品</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *<span class="keyword">from</span> goods <span class="keyword">where</span> cat_id =<span class="number">3</span> <span class="keyword">and</span> (shop_price <span class="keyword">between</span> <span class="number">1000</span> <span class="keyword">and</span> <span class="number">3000</span> ) <span class="keyword">and</span> click_count &gt;<span class="number">5</span> <span class="keyword">and</span> goods_name <span class="keyword">like</span> <span class="string">"诺基亚%"</span>;</span><br></pre></td></tr></table></figure><p>1.14 把good表中商品名为’诺基亚xxxx’的商品,改为’HTCxxxx’, 提示:大胆的把列看成变量,参与运算,甚至调用函数来处理.substring(),concat()</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(<span class="string">"HTC"</span>,<span class="keyword">substring</span>(goods_name,<span class="number">4</span>)) <span class="keyword">from</span> goods <span class="keyword">where</span> goods_name <span class="keyword">like</span> <span class="string">'诺基亚%'</span>;</span><br></pre></td></tr></table></figure><h2 id="group"><a href="#group" class="headerlink" title="group"></a>group</h2><p>2.1 查出最贵的商品的价格</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">max</span>(shop_price) <span class="keyword">from</span> goods;</span><br><span class="line"></span><br><span class="line"><span class="comment">## #查询具体的最贵的商品信息</span></span><br><span class="line"><span class="keyword">select</span> goods_id, goods_name,shop_price <span class="keyword">from</span> goods,(<span class="keyword">select</span> <span class="keyword">max</span>(shop_price) <span class="keyword">as</span> sp <span class="keyword">from</span> goods) maxp <span class="keyword">where</span> goods.shop_price = sp;</span><br></pre></td></tr></table></figure><p>2.2 查出最大(最新)的商品编号 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">max</span>(goods_id) <span class="keyword">from</span> goods;</span><br></pre></td></tr></table></figure><p>2.3 查出最便宜的商品的价格 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">min</span>(shop_price) <span class="keyword">from</span> goods;</span><br></pre></td></tr></table></figure><p>2.4 查出最旧(最小)的商品编号</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">min</span>(goods_id) <span class="keyword">from</span> goods;</span><br></pre></td></tr></table></figure><p>2.5 查询该店所有商品的库存总量 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">sum</span>(goods_number) <span class="keyword">from</span> goods;</span><br></pre></td></tr></table></figure><p>2.6 查询所有商品的平均价 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">avg</span>(shop_price) <span class="keyword">from</span> goods;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 每类商品均价</span></span><br><span class="line"><span class="keyword">select</span> cat_id, <span class="keyword">avg</span>(shop_price) <span class="keyword">from</span> goods <span class="keyword">group</span> <span class="keyword">by</span> cat_id;</span><br></pre></td></tr></table></figure><p>2.7 查询该店一共有多少种商品</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> goods;</span><br></pre></td></tr></table></figure><h2 id="having与group综合运用"><a href="#having与group综合运用" class="headerlink" title="having与group综合运用"></a>having与group综合运用</h2><p>3.1 查询该店的商品比市场价所节省的价格:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> goods_id, goods_name, (shop_price - market_price) <span class="keyword">from</span> goods;</span><br></pre></td></tr></table></figure><p>3.2 查询每个商品所积压的货款(提示:库存*单价) </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> goods_id, goods_name ,(shop_price*goods_number) <span class="keyword">from</span> goods;</span><br></pre></td></tr></table></figure><p>3.3 查询该店积压的总货款 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">sum</span>(shop_price*goods_number) <span class="keyword">from</span> goods;</span><br></pre></td></tr></table></figure><p>3.4 查询该店每个栏目下面积压的货款.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> cat_id, <span class="keyword">sum</span>(shop_price*goods_number) <span class="keyword">from</span> goods <span class="keyword">group</span> <span class="keyword">by</span> cat_id;</span><br></pre></td></tr></table></figure><p>3.5 查询比市场价省钱200元以上的商品及该商品所省的钱(where和having分别实现)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># where</span></span><br><span class="line"><span class="keyword">select</span> * , (market_price -shop_price) <span class="keyword">from</span> goods <span class="keyword">where</span> (market_price -shop_price) &gt; <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># having</span></span><br><span class="line"><span class="keyword">select</span> * , (market_price -shop_price) <span class="keyword">as</span> shengqian <span class="keyword">from</span> goods <span class="keyword">having</span> shengqian &gt; <span class="number">200</span>;</span><br></pre></td></tr></table></figure><p>3.6 查询积压货款超过2W元的栏目,以及该栏目积压的货款</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> cat_id, <span class="keyword">sum</span>(shop_price*goods_number) <span class="keyword">as</span> sum_cat_price <span class="keyword">from</span> goods <span class="keyword">group</span> <span class="keyword">by</span> cat_id <span class="keyword">having</span> sum_cat_price &gt; <span class="number">20000</span>;</span><br></pre></td></tr></table></figure><h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`lesson_score`</span> (</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`subject`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`score`</span> <span class="built_in">tinyint</span>(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> lesson_score</span><br><span class="line"><span class="keyword">values</span></span><br><span class="line">(<span class="string">'张三'</span>,<span class="string">'数学'</span>,<span class="number">90</span>),</span><br><span class="line">(<span class="string">'张三'</span>,<span class="string">'语文'</span>,<span class="number">50</span>),</span><br><span class="line">(<span class="string">'张三'</span>,<span class="string">'地理'</span>,<span class="number">40</span>),</span><br><span class="line">(<span class="string">'李四'</span>,<span class="string">'语文'</span>,<span class="number">55</span>),</span><br><span class="line">(<span class="string">'李四'</span>,<span class="string">'政治'</span>,<span class="number">45</span>),</span><br><span class="line">(<span class="string">'王五'</span>,<span class="string">'政治'</span>,<span class="number">30</span>);</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fwbclia8d1j308805amxl.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>要求:查询出2门及2门以上不及格者的平均成绩</p><p><strong><font color="red">错误</font></strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 这种写法错误</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> , <span class="keyword">count</span>(score &lt; <span class="number">60</span>) <span class="keyword">as</span> <span class="keyword">num</span>, <span class="keyword">avg</span>(score) <span class="keyword">from</span> lesson_score <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">name</span> <span class="keyword">having</span> <span class="keyword">num</span> &gt;= <span class="number">2</span>;</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fwbddyq2p0j30op0ctn8u.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>注意： count,是数行数的，其实与里面是啥没有关系，所以 <code>score &lt; 60</code> 没有生效。</p><p>count(score &lt; 60) 只是统计行数。</p><p>所以重新添加数据，注意图片显示。</p><ul><li>平均成绩</li><li>挂科情况</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 挂科情况</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>, score &lt; <span class="number">60</span> <span class="keyword">from</span> lesson_score;</span><br><span class="line"><span class="comment">## 注意 score&lt;60 的结果只有两种，0和1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 那么我们可以统计 name 的总共的挂科情况</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>, <span class="keyword">sum</span>((score&lt;<span class="number">60</span>)) <span class="keyword">from</span> lesson_score <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">name</span>;</span><br><span class="line"><span class="comment">## 此时我们得到总体的挂科数量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 挂科 &gt;=2 的人我们是不是可以查询到</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>, <span class="keyword">sum</span>((score&lt;<span class="number">60</span>))&gt;=<span class="number">2</span> <span class="keyword">from</span> lesson_score <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">name</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 那么我们可以这么写：</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>, <span class="keyword">avg</span>(score), <span class="keyword">sum</span>((score&lt;<span class="number">60</span>)) <span class="keyword">as</span> <span class="keyword">num</span> <span class="keyword">from</span> lesson_score <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">name</span> <span class="keyword">having</span> <span class="keyword">num</span> &gt;=<span class="number">2</span>;</span><br></pre></td></tr></table></figure><h2 id="order-by-与-limit-查询"><a href="#order-by-与-limit-查询" class="headerlink" title="order by 与 limit 查询"></a>order by 与 limit 查询</h2><p>4.1 按价格由高到低排序 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">order</span> <span class="keyword">by</span> shop_price <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure><p>4.2 按发布时间由早到晚排序 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">order</span> <span class="keyword">by</span> add_time;</span><br></pre></td></tr></table></figure><p>4.3 接栏目由低到高排序,栏目内部按价格由高到低排序</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">order</span> <span class="keyword">by</span> cat_id, shop_price <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure><p>4.4 取出价格最高的前三名商品 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">order</span> <span class="keyword">by</span> shop_price <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">3</span>;</span><br></pre></td></tr></table></figure><p>4.5 取出点击量前三名到前5名的商品 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> goods <span class="keyword">order</span> <span class="keyword">by</span> click_count <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">2</span>,<span class="number">3</span>;</span><br></pre></td></tr></table></figure><p>4.6 </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;燕十八的MYSQL练习&quot;&gt;&lt;a href=&quot;#燕十八的MYSQL练习&quot; class=&quot;headerlink&quot; title=&quot;燕十八的MYSQL练习&quot;&gt;&lt;/a&gt;燕十八的MYSQL练习&lt;/h1&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;
      
    
    </summary>
    
    
      <category term="MYSQL" scheme="http://lmwtuedu.cn/categories/MYSQL/"/>
    
    
      <category term="MYSQL" scheme="http://lmwtuedu.cn/tags/MYSQL/"/>
    
  </entry>
  
  <entry>
    <title>Redis（01）笔记</title>
    <link href="http://lmwtuedu.cn/2018/09/20/2018-09-20-Redis%E7%AC%94%E8%AE%B0_01/"/>
    <id>http://lmwtuedu.cn/2018/09/20/2018-09-20-Redis笔记_01/</id>
    <published>2018-09-19T16:00:00.000Z</published>
    <updated>2019-09-17T08:20:05.256Z</updated>
    
    <content type="html"><![CDATA[<p>#Redis笔记01</p><blockquote><p>工作中也常常用到redis，对Redis的使用也是停留在一些操作上面，工作上也遇到要用redis的场景，例如：单点登录、缓存数据库（热点数据）、高并发某些特定业务的优化等；一直忙于项目，没有时间整理，前段时间买了一本掘金 老钱的Redis，觉得不错，顺便整理一下redis的知识，如有错误地方，请指正。</p></blockquote><h3 id="基础数据结构"><a href="#基础数据结构" class="headerlink" title="基础数据结构"></a>基础数据结构</h3><ul><li>string: 字符串</li><li>list: 列表</li><li>set: 集合</li><li>hash: 哈希</li><li>zset: 有序集合</li></ul><p>封装了基本的线程池以及工具类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.darker.redis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@auther</span> lj</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/9/17 16:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@email</span> lmwtuedu@163.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisPool</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Logger log = LoggerFactory.getLogger(RedisPool.class);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 线程池的配置，继承于apache common pool2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> JedisPoolConfig jedisPoolConfig;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * redis的IP地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String ip;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * redis的端口号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * redis的密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 可用连接实例的最大数目，默认值为8；</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxTotal;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxIdle;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 等待可用连接的最大时间，单位毫秒，</span></span><br><span class="line"><span class="comment">     * 默认值为-1，表示永不超时。如果超过等待时间，</span></span><br><span class="line"><span class="comment">     * 则直接抛出JedisConnectionException；</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> maxWaitMillis;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * redis的线程池</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化Redis连接池</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jedisPool = <span class="keyword">new</span> JedisPool(jedisPoolConfig, ip, port, <span class="number">4000</span>, password);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"First create JedisPool error : "</span> + e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取Instance</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Jedis <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jedisPool.getResource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 回收redis</span></span><br><span class="line"><span class="comment">     * 注意：returnResource</span></span><br><span class="line"><span class="comment">     *      returnBrokenResource</span></span><br><span class="line"><span class="comment">     * 两种方法封装close</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jedis</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Jedis jedis)</span></span>&#123;</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>封装了一个Manger的类工具，专门管理redis的操作。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.darker.redis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@auther</span> lj</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/9/18 10:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@email</span> lmwtuedu@163.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> RedisPool redisPool;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisManager</span><span class="params">(RedisPool redisPool)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisPool = redisPool;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Jedis <span class="title">getRedis</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisPool.getInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Jedis jedis)</span></span>&#123;</span><br><span class="line">       redisPool.close(jedis);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  .....   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以下基于基本的类型，给予操作，以及一些使用场景。</p><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><p> 字符串的结构使用非常广泛，一个常见的用途就是<strong>缓存用户信息</strong>； 怎么缓存用户信息呢？ 例如用户信息是一个对象或者是一个JSON，推荐采用json，键值对方式容易扩张，然后序列化成字符串形式，然后塞进Redis缓存。 同样，取用户信息经过一次反序列化的过程。</p><p>Redis 的字符串是动态字符串，是可以修改的字符串，内部结构实现上类似于 Java 的 ArrayList，<font color="red">采用预分配冗余空间的方式</font>来减少内存的频繁分配。</p><blockquote><p>当字符串长度小于 1M 时，扩容都是加倍现有的空间，如果超过 1M，扩容时一次只会多扩 1M 的空间。需要注意的是字符串最大长度为 512M。</p></blockquote><p>这句话：”扩容都是加倍现有空间”。</p><p>字符串是由多个字节组成，每个字节又是由8个bit组成，如此便可以将一个字符串看成很多bit的组合，这便是 <em>bitmap(位图)</em> 数据结构。</p><p>Jedis提供关于String的操作Java的API有这些：set</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fvdj4jptm6j30ad03w0t4.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 存储数据到缓存中，若key已存在则覆盖 value的长度不能超过1073741824 bytes (1 GB)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">set</span><span class="params">(String key, String value)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 存储数据到缓存中，并制定过期时间和当Key存在时是否覆盖。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> nxxx </span></span><br><span class="line"><span class="comment"> *            nxxx的值只能取NX或者XX，如果取NX，则只有当key不存在是才进行set，如果取XX，则只有当key已经存在时才进行set</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> expx expx的值只能取EX或者PX，代表数据过期时间的单位，EX代表秒，PX代表毫秒。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> time 过期时间，单位是expx所代表的单位。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">set</span><span class="params">(String key, String value, String nxxx, String expx, <span class="keyword">long</span> time)</span></span>;</span><br></pre></td></tr></table></figure><h4 id="String的应用场景"><a href="#String的应用场景" class="headerlink" title="String的应用场景"></a>String的应用场景</h4><p>1) 存储SQL的某一个字段</p><p>把Key值设计为：  <code>表名：主键名：主键值：字段名</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set user:id:1:email:123456@163.com</span><br></pre></td></tr></table></figure><p>2)存储对象</p><p>String类型支持任何格式的字符串，应用最多的就是存储JSON或其他对象格式的字符串，应用最多的就是存储JSON或其他对象格式化的字符串。(这种场景下推荐使用hash数据类型)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set user:id:1 &apos;[&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;zj&quot;,&quot;email&quot;:&quot;156577812@qq.com&quot;&#125;,&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;zj&quot;,&quot;email&quot;:&quot;156577812@qq.com&quot;&#125;]&apos;</span><br></pre></td></tr></table></figure><p>3) 生成自增id</p><p>当redis的string类型的值为整数形式时，redis可以把它当做是整数一样进行自增(incr)、自减(decr)操作。由于redis所有操作都是原子性的，所以<code>不必担心客户端连接时可能出现的事务</code>问题。</p><h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><p>Redis的列相当于Java语言的LinkedList，注意它是链表而不是数组。这意味着list的插入和删除操作非常快，时间复杂度为O(1), 但是索引很慢，时间复杂度为O(n).</p><p>如果再深入一点，你会发现Redis底层存储的还不是一个简单的linkedlist，而是称之为快速链表quicklist 的一个结构。</p><p>首先在列表元素较少的情况下会使用一块连续的内存存储，这个结构是 <code>ziplist</code> , 也是压缩列表。 它将所有的元素紧挨着一起存储，分配的是一块连续的内存。 当数据量比较多的时候才会改成 quicklist。 因为普通的链表需要的附加指针空间太大，会比较浪费时间，而且会加重内存的碎片化。 比如这个列表存的只是<code>int</code>类型的数据， 结构上还需要两个额外的指针 <code>prev</code> 和 <code>next</code>. 所以Redis将链表和 <code>ziplist</code>结合起来组成了 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 右进</span></span><br><span class="line"><span class="function">Long <span class="title">rpush</span><span class="params">(String key, String... string)</span></span>;</span><br><span class="line"><span class="comment">// 左进</span></span><br><span class="line"><span class="function">Long <span class="title">lpush</span><span class="params">(String key, String... string)</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 左出</span></span><br><span class="line"><span class="function">String <span class="title">lpop</span><span class="params">(String key)</span></span>;</span><br><span class="line"><span class="comment">// 右出</span></span><br><span class="line"><span class="function">String <span class="title">rpop</span><span class="params">(String key)</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;String&gt; <span class="title">lrange</span><span class="params">(String key, <span class="keyword">long</span> start, <span class="keyword">long</span> end)</span></span>;</span><br></pre></td></tr></table></figure><h4 id="list数据类型的应用场景"><a href="#list数据类型的应用场景" class="headerlink" title="list数据类型的应用场景"></a>list数据类型的应用场景</h4><p>1) 消息队列</p><p>redis的list数据类型对于大部分使用者来说，是实现队列服务最为经济，最为简单方式。</p><p>2) “最新内容”</p><p>因为list结构的数据查询两端附近的数据性能非常好，所以适合一些需要获取最新数据的场景，比如新闻类应用的 “最新新闻”。</p><p>优化建议：<br>list是链表结构，所以如果在头部和尾部插入数据，性能非常高，不受链表长度影响；但是如果在链表中插入数据，性能就会越来越差。</p><h3 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h3><p>Redis的字典相当于Java语言里面的HashMap，它是无序字典。 内部实现结构上同Java的HashMap也一致。 同样的数组 + 链表二位结构。 第一维 hash的数组位置碰撞时，就会将碰撞的元素使用链表串接起来。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tNbRwly1fv818grt5cj30au07m0t5.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>不同的是，Redis的字典的值只能是字符串，另外它们的rehash的方式不一样，因为Java的HashMap在字典很大的时候，rehash是个耗时的操作，需要一次性全部rehash。 Redis为了提高性能，不能堵塞服务，所以采取了渐进方式rehash策略。</p><p> <img src="https://ws1.sinaimg.cn/large/006tNbRwly1fv81g60s5tj30jl06bjs6.jpg" alt></p><p> 渐进式 rehash 会在 rehash 的同时，保留新旧两个 hash 结构，查询时会同时查询两个 hash 结构，然后在后续的定时任务中以及 hash 操作指令中，循序渐进地将旧 hash 的内容一点点迁移到新的 hash 结构中。当搬迁完成了，就会使用新的hash结构取而代之。</p><p> hash 结构也可以用来存储用户信息，不同于字符串一次性需要<strong>全部序列化整个对象</strong>，hash 可以对用户结构中的每个字段单独存储。这样当我们需要获取用户信息时可以进行部分获取。而以整个字符串的形式去保存用户信息的话就只能一次性全部读取，这样就会比较浪费网络流量。</p><p> hash 也有缺点，hash 结构的存储消耗要高于单个字符串，到底该使用 hash 还是字符串，需要根据实际情况再三权衡。</p><h4 id="hash数据类型的应用场景"><a href="#hash数据类型的应用场景" class="headerlink" title="hash数据类型的应用场景"></a>hash数据类型的应用场景</h4><p>hash 类型很像一个关系型数据库的数据表，hash 的 Key 是一个唯一值，Value 部分是一个 hashmap 的结构。</p><p>假设一张表结构如下：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tNbRwly1fvetx6nuoej30kn02gdfv.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>如果要用redis的hash结构存储，数据模型如下：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tNbRwly1fvetycmurxj30bv05gglv.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>hash数据类型在存储上述类型的数据时具有比string类型更加灵活、更快的优势。使用string类型存储，必然需要转换和解析json格式的字符串，即便不需要转换，在内存开销方面还是hash占优势。</p><h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>Redis的集合相当于Java语言里面的HashSet，它内部的键值对是无序的的唯一的，它的内部实现相当于一个特殊的字典，字典中所有的value都是NULL。</p><p>set 结构可以用来存储活动中奖的用户 ID，因为有去重功能，可以保证同一个用户不会中奖两次。</p><p>set数据类型是一个集合(没有排序，不重复)，可以对set类型的数据进行添加、删除、判断是否存在等操作(时间复杂度O(1))</p><p>set集合不允许数据重复，如果添加的数据在set中已经存在，将只保留一份。</p><p>set类型提供了多个set之间的聚合运算，如求交集、并集、补集；这些操作在redis的内部完成，效率很高。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fvft48n6qmj30d708ydg7.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>set 类型的特点是——不重复且无序的一组数据，并且具有丰富的计算功能，在一些特定的场景中可以高效的解决一般关系型数据库不方便做的工作。</p><h4 id="set的应用场景"><a href="#set的应用场景" class="headerlink" title="set的应用场景"></a>set的应用场景</h4><p>“共同好友列表”</p><p>　社交类应用中，获取两个人或多个人的共同好友，两个人或多个人共同关注的微博这样类似的功能，用 MySQL 的话操作很复杂，可以把每个人的好友 id 存到集合中，获取共同好友的操作就可以简单到一个取交集的命令就搞定。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// 这里为了方便阅读，把 id 替换成姓名</span><br><span class="line">sadd user:wade james melo paul kobe</span><br><span class="line">sadd user:james wade melo paul kobe</span><br><span class="line">sadd user:paul wade james melo kobe</span><br><span class="line">sadd user:melo wade james paul kobe</span><br><span class="line"></span><br><span class="line">// 获取 wade 和 james 的共同好友</span><br><span class="line">sinter user:wade user:james</span><br><span class="line">/* 输出：</span><br><span class="line"> *      1) &quot;kobe&quot;</span><br><span class="line"> *      2) &quot;paul&quot;</span><br><span class="line"> *      3) &quot;melo&quot;</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line"> // 获取香蕉四兄弟的共同好友</span><br><span class="line"> sinter user:wade user:james user:paul user:melo</span><br><span class="line"> /* 输出：</span><br><span class="line"> *      1) &quot;kobe&quot;</span><br><span class="line"> */</span><br><span class="line"> </span><br><span class="line"> /*</span><br><span class="line">     类似的需求还有很多 , 必须把每个标签下的文章 id 存到集合中，可以很容易的求出几个不同标签下的共同文章；</span><br><span class="line"> 把每个人的爱好存到集合中，可以很容易的求出几个人的共同爱好。 </span><br><span class="line"> */</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Long <span class="title">sadd</span><span class="params">(String key, String... member)</span></span>;</span><br><span class="line"><span class="function">Long <span class="title">sadd</span><span class="params">(<span class="keyword">byte</span>[] key, <span class="keyword">byte</span>[]... member)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="zset"><a href="#zset" class="headerlink" title="zset"></a>zset</h3><p>zset 可能是 Redis 提供的最为特色的数据结构，它也是在面试中面试官最爱问的数据结构。它类似于 Java 的 SortedSet 和 HashMap 的结合体，一方面它是一个 set，保证了内部 value 的唯一性，另一方面它可以给每个 value 赋予一个 score，代表这个 value 的排序权重。它的内部实现用的是一种叫做「跳跃列表」的数据结构。</p><p>zset 可以用来存粉丝列表，value 值是粉丝的用户 ID，score 是关注时间。我们可以对粉丝列表按关注时间进行排序。</p><p>zset 还可以用来存储学生的成绩，value 值是学生的 ID，score 是他的考试成绩。我们可以对成绩按分数进行排序就可以得到他的名次。</p><p>java: zadd(…) 参数列表如下：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tNbRwly1fvfud0h68jj30ce03wgm2.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Long <span class="title">zadd</span><span class="params">(String key, <span class="keyword">double</span> score, String member)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Long <span class="title">zadd</span><span class="params">(String key, <span class="keyword">double</span> score, String member, ZAddParams params)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Long <span class="title">zadd</span><span class="params">(String key, Map&lt;String, Double&gt; scoreMembers)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Long <span class="title">zadd</span><span class="params">(String key, Map&lt;String, Double&gt; scoreMembers, ZAddParams params)</span></span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;#Redis笔记01&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;工作中也常常用到redis，对Redis的使用也是停留在一些操作上面，工作上也遇到要用redis的场景，例如：单点登录、缓存数据库（热点数据）、高并发某些特定业务的优化等；一直忙于项目，没有时间整理，前段时间买了
      
    
    </summary>
    
    
      <category term="Redis" scheme="http://lmwtuedu.cn/categories/Redis/"/>
    
    
      <category term="Redis" scheme="http://lmwtuedu.cn/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>闲说RPC_01</title>
    <link href="http://lmwtuedu.cn/2018/09/05/2018-09-05-%E9%97%B2%E8%AF%B4RPC_01/"/>
    <id>http://lmwtuedu.cn/2018/09/05/2018-09-05-闲说RPC_01/</id>
    <published>2018-09-04T16:00:00.000Z</published>
    <updated>2019-09-18T03:13:49.847Z</updated>
    
    <content type="html"><![CDATA[<p>#闲说-RPC_01</p><blockquote><p>我只是一个网络搬运工，客观的归纳整理。 如有侵权，请联系我</p></blockquote><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>Java</li><li>JDK1.8</li><li>IDEA</li><li>maven</li></ul><h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h2><p>常言道听的多了就懂了，一老听同事RPC，我本人也懂得一些rpc的用法，例如一些开源框架阿里的dubbo，调度中心的工具zookeeper。 熟练的运用如何操作。通过spring只需简单的配置一些配置，例如：</p><p>服务端配置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:application name=&quot;xxxxxx-rpc-service&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;dubbo:registry address=&quot;zookeeper://127.0.0.1:2181&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;20881&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--&lt;dubbo:monitor protocol=&quot;registry&quot;/&gt;--&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 系统 --&gt;</span><br><span class="line">&lt;bean id=&quot;xxxSystemService&quot; class=&quot;com.xxxxx.rpc.service.impl.UpmsSystemServiceImpl&quot;/&gt;</span><br><span class="line">&lt;dubbo:service interface=&quot;com.xxxxxx.rpc.api.xxxSystemService&quot; ref=&quot;upmsSystemService&quot; timeout=&quot;10000&quot;/&gt;</span><br></pre></td></tr></table></figure><p>客户端配置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:application name=&quot;xxx-server&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;dubbo:registry file=&quot;./xxx-server-dubbo.cache&quot; address=&quot;zookeeper://127.0.0.1:2181&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 订阅服务 --&gt;</span><br><span class="line">&lt;dubbo:consumer check=&quot;false&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 系统 --&gt;</span><br><span class="line">&lt;dubbo:reference id=&quot;xxxSystemService&quot; interface=&quot;com.xxx.rpc.api.xxxSystemService&quot; mock=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure><p>我摘录了一些知乎的关于原理的回答：</p><p><a href="https://www.zhihu.com/question/25536695" target="_blank" rel="noopener">知乎rpc解释</a></p><h3 id="摘录"><a href="#摘录" class="headerlink" title="摘录"></a>摘录</h3><p>RPC：远程调用。通过RPC框架，使得我们可以像调用本地方法一样地调用远程机器上的方法：</p><p>1、本地调用某个函数方法</p><p>2、本地机器的RPC框架把这个调用信息封装起来（调用的函数、入参等），序列化(json、xml等)后，通过网络传输发送给远程服务器</p><p>3、远程服务器收到调用请求后，远程机器的RPC框架反序列化获得调用信息，并根据调用信息定位到实际要执行的方法，执行完这个方法后，序列化执行结果，通过网络传输把执行结果发送回本地机器</p><p>4、本地机器的RPC框架反序列化出执行结果，函数return这个结果</p><p>作者：Doing<br>链接：<a href="https://www.zhihu.com/question/25536695/answer/285844835" target="_blank" rel="noopener">https://www.zhihu.com/question/25536695/answer/285844835</a><br>来源：知乎<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fuyhjsuwwdj30hv0adtah.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fuyhkql03nj30ij0b2ju7.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>具体的详细点击链接查看一些人对于原理的解释吧。</p><h3 id="归纳"><a href="#归纳" class="headerlink" title="归纳"></a>归纳</h3><p>知乎的一些回答，提到了一些概念东西，RPC的实现需要： 选择传输协议、协议传输层、注册中心选择。</p><ul><li><p>选择传输协议</p><p>高性能的rpc和良好的编码协议是分不开的。好的协议不仅耗用流量小，而且序列化和反序列化更快。<br>现在比较流行的协议thrift、protobuf、json、restful等。其中thrfit和protobuf性能都比较优异，而且占用空间较小，最重要是跨语言，具有语言平台无关性。美中不足就是他们都需要预先根据协议文件预先生成好代码。开发不流畅，但是我们可以自定义协议。像dubbo和motan一样。具体详细百度dubbo和motan</p></li></ul><ul><li><p>协议传输层</p><p>Netty框架不局限于rpc，更多的是作为一种网络协议的实现框架，例如HTTP，由于RPC需要高效的网络通信，就可能选择以Netty作为基础。 Netty提供异步的、事件驱动的网络应用程序架构和工具，用以快速开发高性能、高可靠的网络服务器和客户端程序。目前使用netty作为传输层的rpc框架有很多，例如dubbo motan等</p></li><li><p>注册中心的选择</p><p>现在有很多提供服务注册发现的服务，实现成本比较低的就是zookeeper，可以很容易的实现服务注册和服务发现的功能。</p></li></ul><h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2><p> 以上都是对RPC的一些原理的一些东西的解释。接下来就请查看我基于一份别人写的开源项目，去剖析RPC的一些实现东东吧。具体详细见：闲说-RPC（二）</p><blockquote><p>一个流浪的码农，小主赏赐一口饭吃～</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;#闲说-RPC_01&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;我只是一个网络搬运工，客观的归纳整理。 如有侵权，请联系我&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/
      
    
    </summary>
    
    
      <category term="framework" scheme="http://lmwtuedu.cn/categories/framework/"/>
    
    
      <category term="rpc" scheme="http://lmwtuedu.cn/tags/rpc/"/>
    
  </entry>
  
  <entry>
    <title>学习架构参考</title>
    <link href="http://lmwtuedu.cn/2018/08/29/2018-08-29-%E5%AD%A6%E4%B9%A0%E5%8F%82%E8%80%83%E8%AE%BE%E8%AE%A1%E6%9E%B6%E6%9E%84/"/>
    <id>http://lmwtuedu.cn/2018/08/29/2018-08-29-学习参考设计架构/</id>
    <published>2018-08-28T16:00:00.000Z</published>
    <updated>2019-09-17T08:19:21.179Z</updated>
    
    <content type="html"><![CDATA[<p>##学习参考设计架构</p><p>在此收集的支付宝的系统架构图包含：清算、客服、处理、资金、财务等等，由于资料年限限制，仅供参考，但基本架构相信还是变化不大的。作为支付行业的龙头，架构系统值得学习！</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/0069RVTdgy1fuqeoxyex8j30ga0c742v.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/0069RVTdgy1fuqepvq8eaj30jb0dltg8.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/0069RVTdgy1fuqer16z5rj30kd0c10x8.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/0069RVTdgy1fuqeroc5hlj30ki0f4thc.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/0069RVTdgy1fuqesbxcb2j30kf0fgth7.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/0069RVTdgy1fuqet7zlo5j30lj0go7bh.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/0069RVTdgy1fuqeu14b2wj30mt0gfwo9.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/0069RVTdgy1fuqevfexbqj30mk0g7qb4.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/0069RVTdgy1fuqew6zyo0j30of0fs47s.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/0069RVTdgy1fuqewwj9azj30kh0ejdl1.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/0069RVTdgy1fuqexsew1kj30nd0giwq6.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/0069RVTdgy1fuqeyi4uo1j30mc0g3aj0.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/0069RVTdgy1fuqez5nymwj30nh0hfwnn.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/0069RVTdgy1fuqezojjk5j30m40gnqf2.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/0069RVTdgy1fuqf0iuidlj30mw0hjk26.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/0069RVTdgy1fuqf169lslj30kp0g5q95.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;##学习参考设计架构&lt;/p&gt;
&lt;p&gt;在此收集的支付宝的系统架构图包含：清算、客服、处理、资金、财务等等，由于资料年限限制，仅供参考，但基本架构相信还是变化不大的。作为支付行业的龙头，架构系统值得学习！&lt;/p&gt;
&lt;figure class=&quot;image-bubble&quot;&gt;
  
      
    
    </summary>
    
    
      <category term="framework" scheme="http://lmwtuedu.cn/categories/framework/"/>
    
    
      <category term="framework" scheme="http://lmwtuedu.cn/tags/framework/"/>
    
  </entry>
  
  <entry>
    <title>ELK搭建实时日志分析平台</title>
    <link href="http://lmwtuedu.cn/2018/07/26/2018-07-26-ELK(ElasticSearch,%20Logstash,%20Kibana)%E6%90%AD%E5%BB%BA%E5%AE%9E%E6%97%B6%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B9%B3%E5%8F%B0/"/>
    <id>http://lmwtuedu.cn/2018/07/26/2018-07-26-ELK(ElasticSearch, Logstash, Kibana)搭建实时日志分析平台/</id>
    <published>2018-07-25T16:00:00.000Z</published>
    <updated>2019-09-17T08:18:36.180Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ELK-ElasticSearch-Logstash-Kibana-搭建实时日志分析平台"><a href="#ELK-ElasticSearch-Logstash-Kibana-搭建实时日志分析平台" class="headerlink" title="ELK(ElasticSearch, Logstash, Kibana)搭建实时日志分析平台"></a>ELK(ElasticSearch, Logstash, Kibana)搭建实时日志分析平台</h1><p>在搜索ELK资料的时候，发现这篇文章比较好，于是摘抄一小段：<br>以下内容来自：<a href="http://baidu.blog.51cto.com/71938/1676798" target="_blank" rel="noopener">http://baidu.blog.51cto.com/71938/1676798</a></p><p>日志主要包括系统日志、应用程序日志和安全日志。系统运维和开发人员可以通过日志了解服务器软硬件信息、检查配置过程中的错误及错误发生的原因。经常分析日志可以了解服务器的负荷，性能安全性，从而及时采取措施纠正错误。<br>通常，日志被分散的储存不同的设备上。如果你管理数十上百台服务器，你还在使用依次登录每台机器的传统方法查阅日志。这样是不是感觉很繁琐和效率低下。当务之急我们使用集中化的日志管理，例如：开源的syslog，将所有服务器上的日志收集汇总。<br>集中化管理日志后，日志的统计和检索又成为一件比较麻烦的事情，一般我们使用grep、awk和wc等Linux命令能实现检索和统计，但是对于要求更高的查询、排序和统计等要求和庞大的机器数量依然使用这样的方法难免有点力不从心。<br>开源实时日志分析ELK平台能够完美的解决我们上述的问题，ELK由ElasticSearch、Logstash和Kiabana三个开源工具组成。官方网站：<a href="https://www.elastic.co/products" target="_blank" rel="noopener">https://www.elastic.co/products</a></p><p>•    Elasticsearch是个开源分布式搜索引擎，它的特点有：分布式，零配置，自动发现，索引自动分片，索引副本机制，restful风格接口，多数据源，自动搜索负载等。</p><p>•    Logstash是一个完全开源的工具，他可以对你的日志进行收集、过滤，并将其存储供以后使用（如，搜索）。</p><p>•    Kibana 也是一个开源和免费的工具，它Kibana可以为 Logstash 和 ElasticSearch 提供的日志分析友好的 Web 界面，可以帮助您汇总、分析和搜索重要数据日志。</p><p>—————————-摘抄内容结束——————————-</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ftnb3g1co9j31c20xnatk.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><h2 id="ELK平台搭建"><a href="#ELK平台搭建" class="headerlink" title="ELK平台搭建"></a>ELK平台搭建</h2><ul><li>系统环境</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">System: Centos release 6.7 (Final)</span><br><span class="line">ElasticSearch: 2.1.0</span><br><span class="line">Logstash: 2.1.1</span><br><span class="line">Kibana: 4.3.0</span><br><span class="line">Java: openjdk version  &quot;1.8.0_65&quot;</span><br></pre></td></tr></table></figure><p>注：由于Logstash的运行依赖于Java环境， 而Logstash 1.5以上版本不低于java 1.7，因此推荐使用最新版本的Java。因为我们只需要Java的运行环境，所以可以只安装JRE，不过这里我依然使用JDK，请自行搜索安装。</p><p>ELK下载：<a href="https://www.elastic.co/downloads/" target="_blank" rel="noopener">https://www.elastic.co/downloads/</a></p><p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1ftnb6wvlgcj31bc1eywv1.jpg" alt></p><p>##ElasticSearch<br>配置ElasticSearch：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf elasticsearch-2.1.0.tar.gz</span><br><span class="line">cd elasticsearch-2.1.0</span><br></pre></td></tr></table></figure><p>安装Head插件（Optional）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/plugin install mobz/elasticsearch-head</span><br></pre></td></tr></table></figure><p>然后编辑ES的配置文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi config/elasticsearch.yml</span><br></pre></td></tr></table></figure><p>修改以下配置项：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cluster.name=es_cluster</span><br><span class="line">node.name=node0</span><br><span class="line">path.data=/tmp/elasticsearch/data</span><br><span class="line">path.logs=/tmp/elasticsearch/logs</span><br></pre></td></tr></table></figure><p>#当前hostname或IP，我这里是centos2</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">network.host=centos2</span><br><span class="line">network.port=9200</span><br></pre></td></tr></table></figure><p><strong><font color="red">错误修改</font></strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1ftnb9r4r82j31c20jp78v.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p><strong><font color="red">正确示范：</font></strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1ftnbf0250yj30zv0b7n23.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>其他的选项保持默认，然后启动ES：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/elasticsearch</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1ftnbg68k0oj31ev0qiwt1.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p><strong><font color="red">启动提示错误时：</font></strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftnbm1fzkkj31c215dtnc.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>可以看到，它跟其他的节点的传输端口为9300，接受HTTP请求的端口为9200。<br>使用ctrl+C停止。当然，也可以使用后台进程的方式启动ES：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/elasticsearch &amp;</span><br></pre></td></tr></table></figure><p>然后可以打开页面localhost:9200，将会看到以下内容：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftnbmq97p3j316p0mtq9a.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>返回展示了配置的cluster_name和name，以及安装的ES的版本等信息<br>刚刚安装的head插件，它是一个用浏览器跟ES集群交互的插件，可以查看集群状态、集群的doc内容、执行搜索和普通的Rest请求等。现在也可以使用它打开<a href="localhost:9200/_plugin/head" target="_blank" rel="noopener">localhost:9200/_plugin/head</a>页面来查看ES集群状态：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftnborznz2j31dr0lm45f.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>可以看到，现在，ES集群中没有index，也没有type，因此这两条是空的。</p><h2 id="Logstash"><a href="#Logstash" class="headerlink" title="Logstash"></a>Logstash</h2><p>Logstash的功能如下：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftnbr8l9dpj31g70o5wje.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>其实它就是一个收集器而已，我们需要为它指定Input和Output（当然Input和Output可以为多个）。由于我们需要把Java代码中Log4j的日志输出到ElasticSearch中，因此这里的Input就是Log4j，而Output就是ElasticSearch。<br>配置Logstash：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf logstash-2.1.1.tar.gz</span><br><span class="line">cd logstash-2.1.1</span><br></pre></td></tr></table></figure><p>编写配置文件(名字和位置可以随意，这里我放在config目录下，取名为log4j_to_es.conf)：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir config</span><br><span class="line">vi config/log4j_to_es.conf</span><br></pre></td></tr></table></figure><p>输入以下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># For detail structure of this file</span><br><span class="line"># Set: https://www.elastic.co/guide/en/logstash/current/configuration-file-structure.html</span><br><span class="line">input &#123;</span><br><span class="line">  # For detail config for log4j as input, </span><br><span class="line">  # See: https://www.elastic.co/guide/en/logstash/current/plugins-inputs-log4j.html</span><br><span class="line">  log4j &#123;</span><br><span class="line">    mode =&gt; &quot;server&quot;</span><br><span class="line">    host =&gt; &quot;centos2&quot;</span><br><span class="line">    port =&gt; 4567</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">filter &#123;</span><br><span class="line">  #Only matched data are send to output.</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">  # For detail config for elasticsearch as output, </span><br><span class="line">  # See: https://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html</span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">    action =&gt; &quot;index&quot;            #The operation on ES</span><br><span class="line">    hosts  =&gt; &quot;centos2:9200&quot;     #ElasticSearch host, can be array.</span><br><span class="line">    index  =&gt; &quot;ec&quot;               #The index to write data to, can be any string.</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>logstash命令只有2个参数：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftnbsqgezaj313v0graey.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>因此使用agent来启动它（使用-f指定配置文件）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/logstash agent -f config/log4j_to_es.conf</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftnbv8aledj31kw0aa441.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>到这里，我们已经可以使用Logstash来收集日志并保存到ES中了，下面来看看项目代码。<br>Java项目<br>照例先看项目结构图：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ftnbvo9i1vj30m30naaeb.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>pom.xml，很简单，只用到了Log4j库：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>log4j.properties，将Log4j的日志输出到SocketAppender，因为官网是这么说的：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftnbwnt058j31hg0kl7g6.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">log4j.rootLogger=INFO,console</span><br><span class="line"></span><br><span class="line"># for package com.demo.elk, log would be sent to socket appender.</span><br><span class="line">log4j.logger.com.demo.elk=DEBUG, socket</span><br><span class="line"></span><br><span class="line"># appender socket</span><br><span class="line">log4j.appender.socket=org.apache.log4j.net.SocketAppender</span><br><span class="line">log4j.appender.socket.Port=4567</span><br><span class="line">log4j.appender.socket.RemoteHost=centos2</span><br><span class="line">log4j.appender.socket.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.socket.layout.ConversionPattern=%d [%-5p] [%l] %m%n</span><br><span class="line">log4j.appender.socket.ReconnectionDelay=10000</span><br><span class="line"></span><br><span class="line"># appender console</span><br><span class="line">log4j.appender.console=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.console.target=System.out</span><br><span class="line">log4j.appender.console.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.console.layout.ConversionPattern=%d [%-5p] [%l] %m%n</span><br></pre></td></tr></table></figure><p>注意：这里的端口号需要跟Logstash监听的端口号一致，这里是4567。</p><p><font color="red">特别注意：工程的包名称</font></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ftnbxs5ht3j31c208l0v7.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>Application.java，使用Log4j的LOGGER打印日志即可：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.demo.elk;</span><br><span class="line"></span><br><span class="line">import org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line">public class Application &#123;</span><br><span class="line">    private static final Logger LOGGER = Logger.getLogger(Application.class);</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">            LOGGER.error(&quot;Info log [&quot; + i + &quot;].&quot;);</span><br><span class="line">            Thread.sleep(500);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用Head插件查看ES状态和内容<br>运行Application.java，先看看console的输出（当然，这个输出只是为了做验证，不输出到console也可以的）：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftnc0t60enj31kw0endv5.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>再来看看ES的head页面：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ftnc17fs0yj31kw0o5k5c.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>切换到Browser标签：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1ftnc4792wij31kw0pm17i.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>单击某一个文档（doc），则会展示该文档的所有信息：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ftnc4m5d3wj317k0tv7hy.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>可以看到，除了基础的message字段是我们的日志内容，Logstash还为我们增加了许多字段。而在<a href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-log4j.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/current/plugins-inputs-log4j.html</a>中也明确说明了这一点：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftnc5fm6i6j31kw0lawx1.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>上面使用了ES的Head插件观察了ES集群的状态和数据，但这只是个简单的用于跟ES交互的页面而已，并不能生成报表或者图表什么的，接下来使用Kibana来执行搜索并生成图表。</p><p>##Kibana<br>配置Kibana:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf kibana-4.3.0-linux-x86.tar.gz</span><br><span class="line">cd kibana-4.3.0-linux-x86</span><br><span class="line">vi config/kibana.yml</span><br></pre></td></tr></table></figure><p>修改以下几项（由于是单机版的，因此host的值也可以使用localhost来代替，这里仅仅作为演示）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server.port: 5601</span><br><span class="line">server.host: “centos2”</span><br><span class="line">elasticsearch.url: http://centos2:9200</span><br><span class="line">kibana.index: “.kibana”</span><br></pre></td></tr></table></figure><p>启动kibana：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/kibana</span><br></pre></td></tr></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1ftnc745twvj31kw0fgtn5.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>用浏览器打开该地址：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftnc835w4pj31kw12s4bh.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>为了后续使用Kibana，需要配置至少一个Index名字或者Pattern，它用于在分析时确定ES中的Index。这里我输入之前配置的Index名字applog，Kibana会自动加载该Index下doc的field，并自动选择合适的field用于图标中的时间字段：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1ftnc8guq3pj31kw11ualm.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>点击Create后，可以看到左侧增加了配置的Index名字：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftnc8t5shej31kw0xvdpv.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>接下来切换到Discover标签上，注意右上角是查询的时间范围，如果没有查找到数据，那么你就可能需要调整这个时间范围了，这里我选择Today：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ftnc9831pnj31kw0u414r.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>接下来就能看到ES中的数据了：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1ftnc9y6fkhj31kw11eapo.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>执行搜索看看呢：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ftncacyi0ej31kw116wqb.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>点击右边的保存按钮，保存该查询为search_all_logs。接下来去Visualize页面，点击新建一个柱状图（Vertical Bar Chart），然后选择刚刚保存的查询search_all_logs，之后，Kibana将生成类似于下图的柱状图（只有10条日志，而且是在同一时间段的，比较丑，但足可以说明问题了：)  ）：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ftncauatjsj31kw11bqcy.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>你可以在左边设置图形的各项参数，点击Apply Changes按钮，右边的图形将被更新。同理，其他类型的图形都可以实时更新。<br>点击右边的保存，保存此图，命名为search_all_logs_visual。接下来切换到Dashboard页面：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1ftncb76eruj31kw0jaags.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>单击新建按钮，选择刚刚保存的search_all_logs_visual图形，面板上将展示该图：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ftncblehm1j31kw0ub79t.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>如果有较多数据，我们可以根据业务需求和关注点在Dashboard页面添加多个图表：柱形图，折线图，地图，饼图等等。当然，我们可以设置更新频率，让图表自动更新：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1ftncbyu8qzj31kw0hlaio.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>如果设置的时间间隔够短，就很趋近于实时分析了。<br>到这里，ELK平台部署和基本的测试已完成。</p><p>参考：<br><a href="http://baidu.blog.51cto.com/71938/1676798" target="_blank" rel="noopener">http://baidu.blog.51cto.com/71938/1676798</a><br><a href="http://blog.csdn.net/cnweike/article/details/33736429" target="_blank" rel="noopener">http://blog.csdn.net/cnweike/article/details/33736429</a></p><p>来自： <a href="http://my.oschina.net/itblog/blog/547250" target="_blank" rel="noopener">http://my.oschina.net/itblog/blog/547250</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ELK-ElasticSearch-Logstash-Kibana-搭建实时日志分析平台&quot;&gt;&lt;a href=&quot;#ELK-ElasticSearch-Logstash-Kibana-搭建实时日志分析平台&quot; class=&quot;headerlink&quot; title=&quot;ELK(
      
    
    </summary>
    
    
      <category term="ELK" scheme="http://lmwtuedu.cn/categories/ELK/"/>
    
    
      <category term="ElasticSearch" scheme="http://lmwtuedu.cn/tags/ElasticSearch/"/>
    
      <category term="Logstash" scheme="http://lmwtuedu.cn/tags/Logstash/"/>
    
      <category term="Kibana" scheme="http://lmwtuedu.cn/tags/Kibana/"/>
    
  </entry>
  
  <entry>
    <title>爆雷之后 中产惊惶</title>
    <link href="http://lmwtuedu.cn/2018/07/26/2018-08-06-%E7%88%86%E9%9B%B7%E4%B9%8B%E5%90%8E%20%E4%B8%AD%E4%BA%A7%E6%83%8A%E6%83%B6/"/>
    <id>http://lmwtuedu.cn/2018/07/26/2018-08-06-爆雷之后 中产惊惶/</id>
    <published>2018-07-25T16:00:00.000Z</published>
    <updated>2019-09-17T08:18:56.538Z</updated>
    
    <content type="html"><![CDATA[<h2 id="爆雷之后-中产惊惶"><a href="#爆雷之后-中产惊惶" class="headerlink" title="爆雷之后 中产惊惶"></a>爆雷之后 中产惊惶</h2><p>昏暗的灯光下，程⽣在电脑前跟各地难友沟通。他在杭州拱墅区的一所廉价宾馆已经住了20多天，每天所做的事就是想尽各种办法把自己的本金讨回。</p><p>财富小镇P2P平台的这一串爆雷，撕破了脆弱的中产幻觉。他们不仅损失了百万投资，体面和尊严也突然成了奢侈品。</p><p>7月25日，杭州的温度高达37度。苏州的家庭主妇李霞、广州的创业者程生、湖南的大学生张颖以及北京的保姆张彩娥，以一种怪异的方式，聚集到京杭大运河附近一家廉价旅馆。</p><p>他们自称P2P爆雷潮中的‌‌“难民‌‌”，在过去的一两年内，将家庭或个人的所有积蓄，2万到100万不等，投入到了杭州号称服务新中产的P2P平台投融家。让他们猝不及防的是，平台突然爆雷了。过去几天里，他们顶着烈日或午后忽然而至的暴雨，像无头苍蝇一样，奔走于杭州各个区，寻找追回财产的任何一丝可能性。</p><p>他们好像什么都有，但丧之也不过一夜之间。数以万计家庭的数十亿财富，突然蒸发，所有人被生活抛到了从未到达的境地。很多人从没想过自己会与维权扯上关系，体面和尊严突然成了奢侈品。</p><p>突如其来的爆雷</p><p>李霞是从苏州到了杭州后，才知道‌”爆雷‌‌“这个词的，‌‌”感觉天都塌了‌‌“。回忆起爆雷当天的情形，她情绪依然激动。这个家庭主妇可能是最早发现平台不对劲的投资者之一。7月9日那天是周一，早餐之后，丈夫去上班，女儿放暑假在家玩iPad，她例行打开投融家APP查看投资的情况，却发现登陆界面出现闪退。</p><p>这是过去不曾有的情形。李霞一直很放心投融家，自2016年7月接触以来，平台的任何异动都会提前发布公告。‌‌”这次没有任何通知，平台突然变得不稳定，这很不正常。‌‌“</p><p>押注了家庭的全部积蓄以及父母的10万公积金，平台的任何风吹草动都能引起李霞的警觉。她马上翻到在线客服页面，打算咨询客服。</p><p>客服界面也出现了异常。理应是工作时间，对话框却挂出一行红字：‌‌”当前无客服在线。客服工作时间：工作日09：00<del>21：00 非工作日09：00</del>17：30‌‌“。李霞心里咯噔了一下，立即拨打客服热线。</p><p>400开头的电话始终无人接听。中午，下午，晚上，她重复了多次。一夜辗转反侧，次日清晨，李霞重拨时，听筒里传来了冰冷的提示——‌‌”您所拨打的电话号码已被注销‌‌“。‌‌”这么快就把客服电话就注销了，公司跑路了？‌‌“李霞意识到出了问题，整个人慌了神。</p><p>余额不能提现，到期的标的没有回款，客服电话无人接听。分布在各地的投资者此前并无任何沟通渠道，APP内的投友交流区突然变成了投资客们的维权联络区。一些人踊跃建群，希望收集更多的公司信息。有人回忆，自己在7月5日还有回款，但只提出了利息，只差了几天就能避开雷区；也有人反映，7月6日投的标的没能成功生成合同。投融系另一款产品多多理财的员工，7月9日在多多理财官网上发出消息，称多多理财失去控制，员工被拖欠工资社保，引导投资人报警。</p><p>种种迹象指向了公司崩盘。</p><p>有投资者坐不住，直接飞到了投融家总部所在地杭州，其中包括浙江衢州的程生和女友。</p><p>7月9日，程生的女友在投融家平台购买的十几个标的里，正好有一个当天到期。往常标的到期后，本金和收益都会在上午九点返到个人账户，但那天到了下午，账户依然毫无动静。半个月来的奔波和睡眠不足，在程生脸上留下了大大的黑眼圈。30岁的程生做过服装批发生意，两年前转辗到广州，目前正在创业，100万元几乎是他们能拿出的全部积蓄。‌‌”她一提到这事就哭，我也是爆雷后才知道投入这么大。‌‌“程生说。</p><p>他们到杭州后，立马赶往投融家的办公室。它位于杭州市拱墅区财富小镇的核心位置，投融家所关联的投融长富集团占据了一栋大楼的12~17层，从楼梯的窗户远眺，能看到千年川流不息的京杭大运河。历史上，运河曾给杭州带来了源源不断的财富。</p><p>7月9日傍晚，程生在这里看到的却是一片混乱。办公室空无一人，A4纸印的各类文件撒了一地，办公桌抽屉大开，饮料瓶和各种杂物到处都是。守了半天一无所获后，他只好去派出所报案。接下来的几天，投融长富涌来了来自全国的投资者，等着他们的除了紧锁的办公室，只剩下还没来得及撤走的公司宣传用易拉宝。红色的展板一派喜庆，上面还在庆祝6月份公司业绩破100亿。</p><p>投融系前理财经理冯佳觉得最残酷的是，赔了的不只是自己的钱。父母、朋友和客户的钱都套进去了，这让她背负了巨大的道德压力。‌‌”我觉得我没法再过好了‌‌“，冯佳这些天里瘦了7斤。杭州7月的气温天天在36度以上，她却时不时会打个寒颤。</p><p>她是金融行业的老人。2011年互联网金融行业刚刚起步时，她开始从业，自认对选公司和选产品都很谨慎，‌‌”当初E租宝想招我，我一看他们一天内更新的借款人数量就觉得不靠谱，哪里来这么多人要借钱呢。‌‌“冯佳告诉别人，自己避开过不少坑。</p><p>一年前，冯佳任职于投融系旗下的某家子公司，并逐步买入了一些公司的产品，父母的养老金加上自己的存款，总计投入95万元。当时，一些亲戚朋友和客户向她咨询过理财产品，最终通过她购买了投融系的理财产品，总额有好几百万元。</p><p>7月9日一早，一位老客户告知她，投融长富旗下的一款产品本该当天到期，却未收到本息。她一惊，转身就致电前同事，对方告诉她，‌‌”老板联系不上了‌‌“。电话挂断后，冯佳浑身发软。朋友开车送她回家，下车时她双腿使不上劲，摔了一跤。半个多月里，冯佳时不时感到一阵恍惚，总忍不住拍打手臂确认自己不是在做梦，‌‌”我不敢相信这一切会发生在我的身上‌‌“。</p><p>也有人在7月9日这天毫无知觉。杭州本地人武连是在13日才得知爆雷消息，他投过9个平台，投融家是爆雷的第一家。‌‌”投融家注册用户有145万，现在知道的受害者据说有几万人，还有些标没有到期的人，估计还不知道投融家已经爆雷了。‌‌“李霞说。</p><p>不少人从外地赶赴杭州，‌‌”我死也要死个明白‌‌“。‌‌”从前我来杭州是来旅游的，现在变成了到处被人赶。‌‌“李霞也带着女儿走上了维权讨债之路。他们在盛夏的杭州像无头苍蝇一样，挤在廉价旅馆里等着消息，一有消息，立即赶到可能会带来转机的现场。</p><p>慢慢建立的信任</p><p>‌‌”信任崩塌了，还有什么能相信呢？‌‌“李霞经常越说越激动，突如其来的P2P违约雷暴让很多人产生了幻灭感。</p><p>许多人经常被追问，为什么要把身家性命押注到一家互联网金融平台上。‌‌<strong>”我就是信任它呀‌‌“</strong>，<strong><font color="red">几乎所有投资者都用信任来解释自己的投资行为</font></strong>。</p><p>李霞是从一个公众号的推荐中知道了投融家的存在，像她一样加入维权行列的武连则是从杭州本地的电台节目交通91.8上知道了它。他们都再三强调了投融家背后的上市公司投融长富的背景，认为这让公司的抗风险能力更高，产品更规范。</p><p>李霞认为自己已经非常谨慎了。她两年前开始投资投融家产品，和多数投资者一样，最初额度都很小，几千块试水，周期不长，密切留意平台的到账时间。两年来，产品回款及提现几乎是秒到账。‌‌”非常准，就慢慢信任它了。‌‌“</p><blockquote><p>套路玩法1：初步建立信任，秒到账，周期短，慢慢建立信任链</p></blockquote><p>投融家平台非常注意对用户的运营和维护。2017年2月正值农历新年，李霞收到了投融家发来的包裹，里面是一个紫砂保温杯。‌‌”一周年时给投资者送的小礼品，公司有这个文化还挺用心的。‌‌“她没有用过那个紫砂保温杯，却因此对投融家的信任度更高了。</p><blockquote><p>套路玩法2:对用户邮寄小的礼物，杯子、公仔、键盘、鼠标、鼠标垫、行李箱、背包、剃须刀； 此套路常常出现在生活中，办理信用卡上。 人都是需要被爱的，进一步建立此公司满靠谱，挺用心的。</p></blockquote><p>她还留意到，平台经常会提前几天发出服务器运维的公告，包括某些银行充值或提现的服务指引公告。这些细节让她形成了一个印象：投融家在意用户的感受，平台的可控性高，不会无缘无故出问题。李霞的投资额度越来越大，时间周期也逐渐变长，最终她把父母的十几万存款与自己十几年的积蓄都放了进去。</p><blockquote><p>套路玩法3: 公告指示：引导用户一些操作，基本操作技能，在乎用户体验，让用户感受可控性高</p></blockquote><p>有人相信自己是拿到了内幕消息的。程生的女友是金融从业者，有位朋友是杭州某家银行的管理层，‌‌”他自己买了，然后推荐给我们‌‌“。在这种微妙的类似内幕消息的心理暗示下，程生家里的现金陆续被放进了投融家。‌‌”其实她也希望分散一下风险，所以分成了十几个标，在不同的时间段买的。‌‌“程生认为，一旦相信了这个平台，投一半和投全部几乎没有区别，有闲钱了就投。</p><blockquote><p>套路玩法4: 所谓的“内幕消息”，公司职员购买公司产品，金融从业者，高管～～， “听起别人的推荐” 一口相传，朋友推荐，这样比自己推销更可靠～～</p></blockquote><p>武连也以为自己站在了安全警戒线内。他是本地人，有各种消息渠道，一些信息和迹象让他相信，这是家‌‌”跟上面关系很好‌‌“的公司。在投融家的公众号上，政府官员考察的信息被当做新闻推送，像武连这样的投资者将之视作政府的背书。</p><blockquote><p>套路玩法5: 跟所谓的“关系” 政府搞好关系，当地媒体推送，以及媒体的传播～～ 借助外部优秀的形象包装自己，如上市公司，靠山央企，国家保障～～</p></blockquote><p>维权者中，还有一些本不具备投资知识的人‌‌”听了高档人的建议‌‌“，也杀了进去。张彩娥瞒着家人赶到了杭州，她家在河南，在北京做家政，在投融系平台总共投了十五万元。2017年儿子买车想要钱，她没给，想再多存点，‌‌”如果是低档人说的，我可能就不投了‌‌“。</p><blockquote><p>套路玩法6: “高档人推荐”， 眼红所谓别人的利益，都想去从中分一杯羹，就好比撸羊毛的策略～</p></blockquote><p>也有人觉得自己做足了功课，是理性投资者。张颖刚满20岁，还在念大三，自己打工存下了两万多元。她考过证券从业资格证、投资顾问证，还打算考CPA。投资之前，她仔细比较了一些机构给各个网贷平台的打分，最终挑选了收益率相对安全、分数在前30的投融家。‌‌”我避开了很多雷，从来没想到还会被坑。‌‌“张颖在几天的时间里脸上长了不少痘痘，她没告诉家人这一切，唯一庆幸的是自己还没毕业没有更多钱来投资。</p><blockquote><p>套路玩法7: 我以为我避开了很多雷区，其实下一步就是‘深渊’。</p></blockquote><p>资深从业者冯佳相信自己看公司的眼光，‌‌”我会用安全感来形容那个时候的公司。‌‌“她还记得投融长富2017年9月入驻拱墅区财富小镇时公司意气风发的场景。当时，新的办公室在特色小镇中心位置，五层里有一层据说要开辟为咖啡厅，专门接待各路投资者。办公区显眼的位置，有一面墙全部是投融系公司获得的奖杯和勋章，董事长在台上演讲，踌躇满志，一切看上去欣欣向荣。</p><p>‌‌”看到那一切，我觉得老板是一个非常想干实事的人，一切才刚刚开始。‌‌“她觉得即使未来有风险也应该能撑四五年，所以投了两年期的产品，也向朋友和家人介绍了一些产品。</p><blockquote><p>套路玩法8: 这让我突然想到了，中国的贾老板。 会做PPT的大佬，以及会开发布会的大佬</p></blockquote><p>杭州人王淑珍的境遇类似于冯佳的客户和朋友。她听说业务员自己也购买了投融家产品，‌‌”业务员自己也买了，开车接送我，对我很好。‌‌“68岁的王淑珍认为，业务员总不可能买亏，于是放心地分三次总计投入了70万元。</p><p>来自亲友的推荐、内幕消息、一些互金公司指数排行、上市公司的光环、地方政府背书甚至对自身投资能力的自信，都是投资者选择某家P2P平台的理由。</p><p>一些投资者会拿P2P平台和余额宝作对比，收益率被再三提及。他们不认为自己是在赌博，觉得理性的投资应该被保护。‌‌”余额宝的收益也有过百分之六七，我们比余额宝高不了多少的，没有超过行业水平的。‌‌“投融家平台上标的7%~9%之间的收益率，偶尔做活动，加赠1%的收益，但这种情况极少。</p><blockquote><p>保护： 你所谓的保护，其实我想呵呵，亏吃了，你就要认； 出来混，迟早要还～～ </p></blockquote><p>‌‌”如果收益率超过15%，我肯定不敢投了。‌‌“李霞说。过去几年里，银行储蓄贬值几乎是人尽皆知的事，有人反问了一句，‌‌”除了P2P我们还能投资什么？‌‌“</p><p>毫无征兆的倒塌？</p><p>整个家庭十几年的积蓄被自己投到了一个P2P平台，虽然能归结为信任。但这群投资者有一个无法面对的问题。</p><p>‌‌”你怪自己吗？‌‌“</p><p>坐在旅馆床上的李霞听到这句话，情绪突然失控。她双手掩面，抽泣起来。‌‌”怎么能不怪自己，我本来什么都有，有房有车，现在怎么弄成这样，像个难民。‌‌“她抽噎着，肩膀不能自制地颤动，她的女儿就在隔壁房间，高烧刚刚退去。前一天晚上，她们住的廉价旅馆大床房里挤了八九个人，地毯上铺着几床被子，桌子上放着早晨没吃完的咸菜和包子。窗外阳光热辣，但不远处能看到一团乌云，盛夏的暴雨正在酝酿。</p><p>难友抱团维权，为了节约成本他们多人合住。最高时一个房间住着9个人，分摊每人几十元的房费，只希望能等到最好的消息。</p><p>一切真的毫无征兆吗？逐渐平静之后，李霞开始回想整个事情的经过，想起了被她疏忽的蛛丝马迹。</p><p>年初，丈夫留意到监管收紧，提醒李霞注意风险，但没有引起她的警觉。6月初，投融家在APP中发布了一则诱人的活动：‌‌”跨越百亿，感恩加息1%‌‌“（简称‌‌”跨百亿‌‌“）。愚人节前后，它的交易额刚刚突破90亿。‌‌”跨百亿‌‌“推出之后短短一周之内，平台吸收资金超10亿。因为加息的诱惑，李霞非但没有将到期的20万元提现，反倒追投了20万元。</p><blockquote><p>套路玩法9: 监管加紧，最后收割一波，贪念往往是最好的诱饵，所以感恩加息1%</p></blockquote><p>‌‌”跨百亿‌‌“期间，‌‌”迷局‌‌“已经露出端倪。例如，平台上突然涌现出许多标的，随时都可以投标。此前，这是不可想象的事。通常情况下，平台每天只有两次抢标的时间，类似于准点秒杀，有些标的一经挂出，几分钟内就会被‌‌”秒光‌‌“。</p><p>李霞恍然发现，不知道从什么时候开始，自己已经不再看任何标的合同，不知道借款人是谁，也不知道借款的原因。但是，在小额试水初期，原本从事行政工作的她会悉心研究每次投标的合同细则，评估项目风险。</p><blockquote><p>优秀的习惯，需要长期保持，别让利益或者时间的流逝，慢慢蒙蔽了双眼，最后可能是压死自己的一根稻草；其实常常我们注册一些东西，或者一些关于利益的，我们都没有好好读过～～</p></blockquote><p>出事之后，李霞才仔细查看了标的内容——几乎都是关于净水器的，这令她感到不可思议。净水器几乎成了一个梗，杭州拱墅区小河派出所门口，维权的投资客们彼此打招呼时会问，‌‌”你也买了净水器？‌‌“</p><p>6月底，投融家平台上演了荒诞的一幕，包括教师、会计、工程师、家庭主妇、保姆等成千上万人，一周之内砸10亿资金，疯狂投资净水器。‌‌”标的极有可能是假的，<strong>投融家在自融</strong>，试想想，谁需要买那么多净水器？‌‌“李霞懊丧地说。</p><p>投资者们没有察觉的风险预警并不少。</p><p><font color="red">投融家‌‌”跨百亿‌‌“活动开始那天，小米推荐的车贷平台‌‌”小灰熊金服‌‌“宣告清盘；此前3天，河南的P2P平台金牌理财发布停业公告。闷雷滚滚，没有人觉得他人的不幸与自己有关。</font></p><p>6月11日，在投融长富的总部大楼里，投融家为交易额破百亿举办了一场庆祝会，CEO在内的高管悉数到场，并邀请了两位投资人，他们代表了多数中产家庭，从小额开始，缓慢建立信任，最终重仓投融家。在各色蛋糕、曲奇、水果和鲜榨果汁的甜美香气里，投融长富副总裁付奇打了一手温情牌：‌‌”这是一次家庭的聚会。‌‌“这些信息都通过微信公众号与APP传递给了投资人——我们平台一切都好。</p><p>另一个被投资者频繁提及的障眼法是‌‌”备案‌‌“。在投融家APP中较显眼的位置，至今还放着一则宣传信息，公司正在进行一项覆盖整个行业的P2P网络借贷备案。这种资质背书，让李霞和程生们觉得又给平台上了一重保险，让平台变得更规范了。</p><blockquote><p>不停的加码的同时，不停的给用户打安定剂，稳定用户，准备跑路；玩法很简单，但是…</p></blockquote><p>但实际上，早在6月14日，多家主流媒体报道，整个行业原本定于6月底前完成的P2P网络借贷备案工作已整体后延。中国银行保险监督管理委员会普惠金融部主任李均锋曾在‌‌”第十届陆家嘴论坛‌‌“接受采访时表示，整个行业的备案工作年内可能不能完成。</p><p>投融家爆雷至今，程生等人都不知道公司备案的具体情况，也没有细致去了解过实际情况。到爆雷之时，投资者们始终相信平台融资额增加会有利于备案工作的完成。‌‌”（在当时）我们甚至产生与平台共进退的荣誉感。‌‌“程生情绪有些复杂。</p><p>整个行业的沉疴也成了不理性投资孳生的土壤。P2P和各类理财平台狂飙猛进的那几年，作为身在其中的员工，冯佳甚至感觉到有些触目惊心，‌‌”任何投资都有风险，但我无法向客户提示风险。‌‌“她刚入行的时候，互金公司会对销售人员进行产品风险培训，在客户沟通阶段也会提示风险。‌‌”但实际情况是，理财经理一说风险，客户掉头就走，这就是国人的理财心理。‌‌“</p><p>现实教育了冯佳，大部分的理财者都没有理性的预期，‌‌”他们只接受稳赚不赔，本息一样都不能少。‌‌“长此以往，为了客户留存，几乎所有平台的理财经理都不再提示潜在的风险。</p><p>在一些理财顾问那里，投资者已经习惯把自己的积蓄全盘托付，坐在家里，等待每月的利息如期到账。像冯佳一样的理财顾问们，也习惯了用‌‌”没问题‌‌“‌‌”我自己也投的，比较稳‌‌“来告知风险。风险是个概率事件，只要它未曾发生，它仿佛就不存在。在大部分的理财平台上，风险提示的埋点都特别深，投融家平台的设置也是如此。</p><p>酒店里挂着一件印有‌‌”还钱‌‌“两字的t恤，全国各地的难友制作了200件衣服以此得到有关部门重视，但似乎没有得到效果。</p><p>一些维权的投资者遇到对风险的疑问时，语气会变得急促。‌‌”我是和平台发生交易，就算看了也没有用，责任在平台。‌‌“说这话时，一位投资者语速加快，声音提高。与之相矛盾的是，和大部分的投资者一样，她知道P2P理论上只是信息中介。</p><p>‌‌”疏忽‌‌“的的确不止李霞一人。王淑珍在杭州一栋老式居民楼里摊开总计70万元的3份合同时，眼睛几乎要眯成一条缝才能艰难找到转账记录。‌‌”我看不清合同上的字‌‌“，王淑珍认为，她签订的合同等同于高一点利息的银行定存。细如蝼蚁的字号对她已经是不小的障碍，名目繁杂的条例她则根本没有打开看过。</p><p>看似毫无征兆的倒塌，可能更是一场缓慢的‌‌”合谋‌‌“。在通胀、孩子教育投入、养老医疗等压力的裹挟下，许多人前赴后继地将自己的半生积蓄投进了P2P。他们如温水煮青蛙般，逐渐放松警惕并日益‌‌”疏忽‌‌“，怀抱微妙的自欺与侥幸心态，如同在浓雾的夜晚开车，被扑朔迷离的光亮迷惑，最终走向了盛夏的雷暴。</p><blockquote><p>“合谋”： 通货膨胀，  教育投入， 养老的医疗， 房产的上涨～～。温水煮青蛙，自欺以及侥幸心态</p></blockquote><p>被打乱的生活，被打醒的中产幻觉</p><p>李霞和程生都还在杭州的廉价旅馆里捱日子。他们住的房间已经从9楼搬到7楼。7层的墙壁被涂成了玫粉色，部分墙灰已经剥落，午后阳光斜射进来的时候，甬道就像血色洞窟。</p><p>程生的心情已经逐渐平复下来。他的100万元投入里，有50万元要在9月用来偿还此前的贷款，他的女友时常因为自责而情绪崩溃。为了缓解她的压力，程生经常汇总各类信息，这也让他成了从各地赶来杭州的‌‌”难友‌‌“们某种程度上的精神支撑。</p><p>但对未来能做什么，他也没有明确的计划，‌‌”只能走一步看一步‌‌“。两天前，程生与女朋友商定，如果一切途径都走不通，就一起徒步去色达。‌‌”求人不行，求己不行，那就只能求佛了。‌‌“他还算年轻，喜欢徒步，生活的一记惊雷他仿佛还熬得住。</p><p>对家里有老有小的李霞而言，这一切撕开了脆弱的中产幻觉。正值暑假，李霞的一天本应该是规律又有点单调的。早晨给老公做早餐，上午辅导女儿做作业，下午再带着孩子画画，晚上十点多就能睡觉。她几乎把基础生活支出之外的储蓄，全部投入投融家，稳定的回款曾给她带来安全感。</p><blockquote><p>财富在自己手中才是安全感，我命由我，不由天～</p></blockquote><p>‌‌”爆雷‌‌“后，李霞带着女儿来到了杭州，本来正在旅游的他们发生了意外，生活轨迹发生了变化。</p><p>现在一切都乱了。那40万元里除了父母的养老金，还有要给孩子报英语班、画画班的钱。‌‌”全家只有我丈夫一人上班，本来想给孩子报个钢琴班，现在也只能压缩这些计划了。‌‌“她每天只顾得上在各个群里探听各种消息，没有心力给孩子辅导作业，小女孩经常一个人被留在宾馆看动画片。</p><p>她还担心热度消退，像此前所有新闻热点一样，最终不了了之。她不希望同伴决心动摇，甚至不愿意一起行动的伙伴将不利于维权的信息告诉身在外地的人。‌‌”这么突然的财产蒸发，也没有人管这样的平台，影响的都是中间阶层，会出事的。‌‌“李霞有点咬牙切齿。</p><p>冯佳也有了改变。‌‌”我之前觉得自己很独立‌‌“，她自诩独立女性，按照自己的意志生活，收入可观，喜欢旅行。她钟情于小城清迈，那是邓丽君去世的地方。‌‌”现在觉得这就是一场中产的幻觉。‌‌“</p><p>她希望自己能好好哭一场。为了缩减开支，她可能没法再住在现在的房子，投融系之后干了近一年的工作也丢了。上司知道她此前的公司爆雷，没说别的，只问她，‌‌”你还能在这行做吗？你打算怎么做？‌‌“</p><p>她的确对自己产生了怀疑。‌‌”不只是从业背景有污点的问题，而是客户的钱砸在里面了，这意味着我七年攒的资源都没有了。‌‌“</p><p>从7月9日知道消息，到真正报警，冯佳拖了十天。她花了三天才给所有投资了的朋友客户打完电话，每次打电话前要做很久的心理准备，经常讲到一半，整个人情绪崩溃。</p><p>她不愿意立即报警，也尽量压着客户朋友别太早报警。‌‌”逾期和提现困难有时候是正常的，如果投资人施压过多，老板跑路，才是致命的问题。‌‌“那几天，她把自己关在家里，不放过任何一点信息，‌‌”每天都在想，老板是去找钱了，也许平台还能运转，也许还有转机。脑子里时刻都在上演一部连续剧。‌‌“她甚至产生过一种自私的期望，平台只要撑过10月份，她就可以拿回自己和客户朋友们的钱。7月20日，她得知投融长富的老板李振军早在7月初就已出境，这才彻底死心。</p><p>在咖啡馆里，冯佳斩钉截铁地说：‌‌”我不再那么相信自己的专业、能力，甚至根本不知道还可以相信什么。‌‌“她开始怀疑自己能否独自应对生活的风险，‌‌”也许我该去找个人结婚生子了。‌‌“</p><p>这场风暴对中产以下家庭的打击，也许更为致命。王淑珍生活节俭，闷热的夏夜依然舍不得开空调，见我们时，桌上的饭菜散发出了异味。她的家庭本已危机四伏。大儿子还在殡仪馆，八月份墓地才能安置妥当。年过三十的小儿子至今未婚，多年的积蓄被她砸进理财产品。她原本指望到期之后取现，将一家人住的老房子装修一下，但现在一切都是泡影。</p><p>王淑珍把一生的积蓄70万，全投资到投融系的产品里，如今已经血本无归。如果不是该公司的员工一直的推荐和心软地签了合同，这波爆雷潮可能就与她无关。</p><p>维权群里，不时有‌‌”更惨‌‌“的消息传来：有人因此离了婚，有人中风了，有人举债加杠杆投资，据说还有人挪用了公款……</p><p>截至7月30日，有媒体统计传出爆雷的P2P平台超过250家，以投融家为例注册用户规模在145万人，目前影响人数数万人，这场盛夏的雷暴影响的人数难以预估。</p><p>7月底的黄昏时分，财富小镇华灯初上，远洋大厦楼前几百米的位置，音乐喷泉已经升起，新中产家庭的夜生活刚刚开始。商场橱窗里摆出新一季的服装，咖啡很香，蛋糕很甜，音乐时髦又愉快。挂着‌‌”投融长富‌‌“四个字的招牌，已不再亮灯，相较于周边的大厦有点黯淡失色。</p><p>冯佳坐在喷泉前的石凳上茫然看着欢闹的人群，‌‌”我已经不是三周前的那个我了。‌”对身陷其中的人而言，这场遭遇是一场大考。而广场中心，嬉闹的孩子正不顾一切冲进喷泉中。往来的人们正享受着繁荣的都市生活，他们对几百米外正发生的雷暴一无所知。</p><blockquote><p>国人思想：事不关己，高高挂起～～ 其实都是有点可悲的，包括我们自己</p></blockquote><p>（文中人物皆为化名）<a href="https://botanwang.com/articles/201808/%E7%88%86%E9%9B%B7%E4%B9%8B%E5%90%8E%7C%E4%B8%AD%E4%BA%A7%E6%83%8A%E6%83%B6.html" target="_blank" rel="noopener">https://botanwang.com/articles/201808/%E7%88%86%E9%9B%B7%E4%B9%8B%E5%90%8E%7C%E4%B8%AD%E4%BA%A7%E6%83%8A%E6%83%B6.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;爆雷之后-中产惊惶&quot;&gt;&lt;a href=&quot;#爆雷之后-中产惊惶&quot; class=&quot;headerlink&quot; title=&quot;爆雷之后 中产惊惶&quot;&gt;&lt;/a&gt;爆雷之后 中产惊惶&lt;/h2&gt;&lt;p&gt;昏暗的灯光下，程⽣在电脑前跟各地难友沟通。他在杭州拱墅区的一所廉价宾馆已经住了20多
      
    
    </summary>
    
    
      <category term="article" scheme="http://lmwtuedu.cn/categories/article/"/>
    
    
      <category term="news" scheme="http://lmwtuedu.cn/tags/news/"/>
    
  </entry>
  
  <entry>
    <title>SQL如何支持TLS1.2</title>
    <link href="http://lmwtuedu.cn/2018/07/20/2018-07-20-SQL%E5%A6%82%E4%BD%95%E6%94%AF%E6%8C%81TLV1.2/"/>
    <id>http://lmwtuedu.cn/2018/07/20/2018-07-20-SQL如何支持TLV1.2/</id>
    <published>2018-07-19T16:00:00.000Z</published>
    <updated>2019-09-17T08:18:09.155Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SQL如何支持TLS1-2"><a href="#SQL如何支持TLS1-2" class="headerlink" title="SQL如何支持TLS1.2"></a>SQL如何支持TLS1.2</h1><p>近期工作需要送检项目被扫描处以下漏洞：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1ftf6esgntej30sl0l141u.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>注意： solution给出的方案是update；当时我看到这个句话时，我内心时崩溃的以及一脸的问好❓❓</p><p>更新，更新What？</p><p>丢给公司的技术支持先查询了（因为我是第一次遇见此问题，手头还有其他项目要忙）； 其他项目忙完已经是两个星期之后，刚忙完手头其他项目（公司对此项目比较重视）； 领导领导的上级来了，来了一顿逼叨逼叨的，说了一大堆； 唉，呀， 我是那种不干活的人吗？ 来了一句“你处理问题能力有问题？” “WTF？？？” 怀疑我的能力，默默的收拾一下，来吧，搞定此bug漏洞所在！有点扯远了，来吧，言归正传！</p><p>环境：</p><ul><li>Windows7（64位系统 4G内存）</li><li>SQL2005 </li><li>我司送检软件</li></ul><p>查询了一下：</p><ol><li>此漏洞是啥？<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftf76b6r68j30oh0b840r.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure></li></ol><p>此漏洞对OpenSSL协议有问题？ SSL3？ 那我软件协议是啥版本？ 能支持啥版本呢？ 排查对象<br>还有 针对 CBC模式的呢？？？ 我得搞清楚用了哪些东西（协议以及算法）</p><p>链接🔗<a href="https://segmentfault.com/a/1190000012731888" target="_blank" rel="noopener">常见的几种SSL/TLS漏洞及攻击方式</a></p><p>Google以及百度，查询到有这样的一个软件：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1ftf7iba2c9j30n00by0xl.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>对对对，专门针对IIS的一款非常棒棒哒的神器；可以很直观的设置协议<br>看见木有： protocols： 协议； ciphers : 密码（算法）； hash：哈希； KeyExchange：密钥交换；</p><p>我们需要设置如下：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tNc79gy1ftg4vmjo1qj30om0j9wfu.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tNc79gy1ftg4vmsrl4j30om0j9wgf.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>CipherSuites的选择是根据什么来决定的呢？ 是根据系统的加密套件决定的；加密套件哪里寻找呢？</p><p>windows 系统下有一个命令： gpedit.msc</p><p>SSL的组件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">确定安全套接字层(SSL)使用的密码套件。</span><br><span class="line"></span><br><span class="line">如果启用此设置，则 SSL 密码套件将按指定的顺序进行排列。</span><br><span class="line"></span><br><span class="line">如果禁用或不配置此设置，则将使用出厂默认密码套件顺序。</span><br><span class="line"></span><br><span class="line">SSL2、SSL3、TLS 1.0 和 TLS 1.1 密码套件:</span><br><span class="line"></span><br><span class="line">TLS_RSA_WITH_AES_128_CBC_SHA</span><br><span class="line">TLS_RSA_WITH_AES_256_CBC_SHA</span><br><span class="line">TLS_RSA_WITH_RC4_128_SHA</span><br><span class="line">TLS_RSA_WITH_3DES_EDE_CBC_SHA</span><br><span class="line">TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P256</span><br><span class="line">TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P384</span><br><span class="line">TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P521</span><br><span class="line">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P256</span><br><span class="line">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P384</span><br><span class="line">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P521</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P256</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P384</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P521</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P256</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P384</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P521</span><br><span class="line">TLS_DHE_DSS_WITH_AES_128_CBC_SHA</span><br><span class="line">TLS_DHE_DSS_WITH_AES_256_CBC_SHA</span><br><span class="line">TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA</span><br><span class="line">TLS_RSA_WITH_RC4_128_MD5</span><br><span class="line">SSL_CK_RC4_128_WITH_MD5</span><br><span class="line">SSL_CK_DES_192_EDE3_CBC_WITH_MD5</span><br><span class="line">TLS_RSA_WITH_NULL_SHA</span><br><span class="line">TLS_RSA_WITH_NULL_MD5</span><br><span class="line"></span><br><span class="line">TLS 1.2 SHA256 和 SHA384 密码套件:</span><br><span class="line"></span><br><span class="line">TLS_RSA_WITH_AES_128_CBC_SHA256</span><br><span class="line">TLS_RSA_WITH_AES_256_CBC_SHA256</span><br><span class="line">TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256</span><br><span class="line">TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P384</span><br><span class="line">TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P521</span><br><span class="line">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P256</span><br><span class="line">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384</span><br><span class="line">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P521</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P256</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P384</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P521</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P384</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P521</span><br><span class="line">TLS_DHE_DSS_WITH_AES_128_CBC_SHA256</span><br><span class="line">TLS_DHE_DSS_WITH_AES_256_CBC_SHA256</span><br><span class="line">TLS_RSA_WITH_NULL_SHA256</span><br><span class="line"></span><br><span class="line">TLS 1.2 ECC GCM 密码套件:</span><br><span class="line"></span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P384</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P521</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P521</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如何修改此设置:</span><br><span class="line"></span><br><span class="line">1. 打开一个空白写字板文档。</span><br><span class="line"></span><br><span class="line">2. 复制可用套件的列表并将其粘贴到该文档中。</span><br><span class="line"></span><br><span class="line">3. 按正确顺序排列套件；删除不想使用的所有套件。</span><br><span class="line"></span><br><span class="line">4. 在每个套件名称的末尾键入一个逗号(最后一个套件名称除外)。确保没有嵌入空格。</span><br><span class="line"></span><br><span class="line">5. 删除所有换行符，以便密码套件名称位于单独的一个长行上。</span><br><span class="line"></span><br><span class="line">6. 将密码套件行复制到剪贴板，然后将其粘贴到编辑框中。最大长度为 1023 个字符。</span><br></pre></td></tr></table></figure><p>为了防止被一些扫描软件扫描出一些什么 TLV POOOLED的这种漏洞；所以我建议你配置TLS1.2 ECC GCM 密码套件； 与之使用的软件也要支持才行，否者OpenSSL进行会话密钥协商的时候，会出错！</p><p>SQL2016的数据连接的时候，采用OpenSSL的连接，其实说白了就是走的是HTTPS；如果你不信，可以点击打开浏览器查看百度的协议是啥：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tNc79gy1ftgah4km3fj30ho0bqq4u.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>所以我们配置TLS1.2的时候只配置 GCM的密码套件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">TLS 1.2 ECC GCM 密码套件:</span><br><span class="line"></span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P384</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P521</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384</span><br><span class="line">TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P521</span><br></pre></td></tr></table></figure><p>这样在漏洞扫描的时候，是绝对不会出现 TLS POOLED的漏洞的！</p><p>那其他的漏洞原理是如何设置还有修复的呢？？</p><p>网上查阅过一记录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line"># Copyright 2016, Alexander Hass</span><br><span class="line"># http://www.hass.de/content/setup-your-iis-ssl-perfect-forward-secrecy-and-tls-12</span><br><span class="line">#</span><br><span class="line"># Version 1.7</span><br><span class="line"># - Windows Version compare failed. Get-CimInstance requires Windows 2012 or later.</span><br><span class="line"># Version 1.6</span><br><span class="line"># - OS version detection for cipher suites order.</span><br><span class="line"># Version 1.5</span><br><span class="line"># - Enabled ECDH and more secure hash functions and reorderd cipher list.</span><br><span class="line"># - Added Client setting for all ciphers.</span><br><span class="line"># Version 1.4</span><br><span class="line"># - RC4 has been disabled.</span><br><span class="line"># Version 1.3</span><br><span class="line"># - MD5 has been disabled.</span><br><span class="line"># Version 1.2</span><br><span class="line"># - Re-factored code style and output</span><br><span class="line"># Version 1.1</span><br><span class="line"># - SSLv3 has been disabled. (Poodle attack protection)</span><br><span class="line">  </span><br><span class="line">Write-Host &apos;Configuring IIS with SSL/TLS Deployment Best Practices...&apos;</span><br><span class="line">Write-Host &apos;--------------------------------------------------------------------------------&apos;</span><br><span class="line">  </span><br><span class="line"># Disable Multi-Protocol Unified Hello</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\Multi-Protocol Unified Hello\Server&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\Multi-Protocol Unified Hello\Server&apos; -name Enabled -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\Multi-Protocol Unified Hello\Server&apos; -name &apos;DisabledByDefault&apos; -value 1 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\Multi-Protocol Unified Hello\Client&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\Multi-Protocol Unified Hello\Client&apos; -name Enabled -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\Multi-Protocol Unified Hello\Client&apos; -name &apos;DisabledByDefault&apos; -value 1 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">Write-Host &apos;Multi-Protocol Unified Hello has been disabled.&apos;</span><br><span class="line">  </span><br><span class="line"># Disable PCT 1.0</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0\Server&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0\Server&apos; -name Enabled -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0\Server&apos; -name &apos;DisabledByDefault&apos; -value 1 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0\Client&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0\Client&apos; -name Enabled -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\PCT 1.0\Client&apos; -name &apos;DisabledByDefault&apos; -value 1 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">Write-Host &apos;PCT 1.0 has been disabled.&apos;</span><br><span class="line">  </span><br><span class="line"># Disable SSL 2.0 (PCI Compliance)</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 2.0\Server&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 2.0\Server&apos; -name Enabled -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 2.0\Server&apos; -name &apos;DisabledByDefault&apos; -value 1 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 2.0\Client&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 2.0\Client&apos; -name Enabled -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 2.0\Client&apos; -name &apos;DisabledByDefault&apos; -value 1 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">Write-Host &apos;SSL 2.0 has been disabled.&apos;</span><br><span class="line">  </span><br><span class="line"># NOTE: If you disable SSL 3.0 the you may lock out some people still using</span><br><span class="line"># Windows XP with IE6/7. Without SSL 3.0 enabled, there is no protocol available</span><br><span class="line"># for these people to fall back. Safer shopping certifications may require that</span><br><span class="line"># you disable SSLv3.</span><br><span class="line">#</span><br><span class="line"># Disable SSL 3.0 (PCI Compliance) and enable &quot;Poodle&quot; protection</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&apos; -name Enabled -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Server&apos; -name &apos;DisabledByDefault&apos; -value 1 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Client&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Client&apos; -name Enabled -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\SSL 3.0\Client&apos; -name &apos;DisabledByDefault&apos; -value 1 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">Write-Host &apos;SSL 3.0 has been disabled.&apos;</span><br><span class="line">  </span><br><span class="line"># Add and Enable TLS 1.0 for client and server SCHANNEL communications</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&apos; -name &apos;Enabled&apos; -value &apos;0xffffffff&apos; -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server&apos; -name &apos;DisabledByDefault&apos; -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Client&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Client&apos; -name &apos;Enabled&apos; -value &apos;0xffffffff&apos; -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Client&apos; -name &apos;DisabledByDefault&apos; -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">Write-Host &apos;TLS 1.0 has been enabled.&apos;</span><br><span class="line">  </span><br><span class="line"># Add and Enable TLS 1.1 for client and server SCHANNEL communications</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&apos; -name &apos;Enabled&apos; -value &apos;0xffffffff&apos; -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server&apos; -name &apos;DisabledByDefault&apos; -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&apos; -name &apos;Enabled&apos; -value &apos;0xffffffff&apos; -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client&apos; -name &apos;DisabledByDefault&apos; -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">Write-Host &apos;TLS 1.1 has been enabled.&apos;</span><br><span class="line">  </span><br><span class="line"># Add and Enable TLS 1.2 for client and server SCHANNEL communications</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&apos; -name &apos;Enabled&apos; -value &apos;0xffffffff&apos; -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server&apos; -name &apos;DisabledByDefault&apos; -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&apos; -name &apos;Enabled&apos; -value &apos;0xffffffff&apos; -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client&apos; -name &apos;DisabledByDefault&apos; -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">Write-Host &apos;TLS 1.2 has been enabled.&apos;</span><br><span class="line">  </span><br><span class="line"># Re-create the ciphers key.</span><br><span class="line">New-Item &apos;HKLM:SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers&apos; -Force | Out-Null</span><br><span class="line">  </span><br><span class="line"># Disable insecure/weak ciphers.</span><br><span class="line">$insecureCiphers = @(</span><br><span class="line">  &apos;DES 56/56&apos;,</span><br><span class="line">  &apos;NULL&apos;,</span><br><span class="line">  &apos;RC2 128/128&apos;,</span><br><span class="line">  &apos;RC2 40/128&apos;,</span><br><span class="line">  &apos;RC2 56/128&apos;,</span><br><span class="line">  &apos;RC4 40/128&apos;,</span><br><span class="line">  &apos;RC4 56/128&apos;,</span><br><span class="line">  &apos;RC4 64/128&apos;,</span><br><span class="line">  &apos;RC4 128/128&apos;</span><br><span class="line">)</span><br><span class="line">Foreach ($insecureCipher in $insecureCiphers) &#123;</span><br><span class="line">  $key = (Get-Item HKLM:\).OpenSubKey(&apos;SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers&apos;, $true).CreateSubKey($insecureCipher)</span><br><span class="line">  $key.SetValue(&apos;Enabled&apos;, 0, &apos;DWord&apos;)</span><br><span class="line">  $key.close()</span><br><span class="line">  Write-Host &quot;Weak cipher $insecureCipher has been disabled.&quot;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"># Enable new secure ciphers.</span><br><span class="line"># - RC4: It is recommended to disable RC4, but you may lock out WinXP/IE8 if you enforce this. This is a requirement for FIPS 140-2.</span><br><span class="line"># - 3DES: It is recommended to disable these in near future. This is the last cipher supported by Windows XP.</span><br><span class="line"># - Windows Vista and before &apos;Triple DES 168&apos; was named &apos;Triple DES 168/168&apos; per https://support.microsoft.com/en-us/kb/245030</span><br><span class="line">$secureCiphers = @(</span><br><span class="line">  &apos;AES 128/128&apos;,</span><br><span class="line">  &apos;AES 256/256&apos;,</span><br><span class="line">  &apos;Triple DES 168&apos;</span><br><span class="line">)</span><br><span class="line">Foreach ($secureCipher in $secureCiphers) &#123;</span><br><span class="line">  $key = (Get-Item HKLM:\).OpenSubKey(&apos;SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers&apos;, $true).CreateSubKey($secureCipher)</span><br><span class="line">  New-ItemProperty -path &quot;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Ciphers\$secureCipher&quot; -name &apos;Enabled&apos; -value &apos;0xffffffff&apos; -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">  $key.close()</span><br><span class="line">  Write-Host &quot;Strong cipher $secureCipher has been enabled.&quot;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"># Set hashes configuration.</span><br><span class="line">New-Item &apos;HKLM:SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes&apos; -Force | Out-Null</span><br><span class="line">New-Item &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\MD5&apos; -Force | Out-Null</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\MD5&apos; -name Enabled -value 0 -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">  </span><br><span class="line">$secureHashes = @(</span><br><span class="line">  &apos;SHA&apos;,</span><br><span class="line">  &apos;SHA256&apos;,</span><br><span class="line">  &apos;SHA384&apos;,</span><br><span class="line">  &apos;SHA512&apos;</span><br><span class="line">)</span><br><span class="line">Foreach ($secureHash in $secureHashes) &#123;</span><br><span class="line">  $key = (Get-Item HKLM:\).OpenSubKey(&apos;SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes&apos;, $true).CreateSubKey($secureHash)</span><br><span class="line">  New-ItemProperty -path &quot;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\$secureHash&quot; -name &apos;Enabled&apos; -value &apos;0xffffffff&apos; -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">  $key.close()</span><br><span class="line">  Write-Host &quot;Hash $secureHash has been enabled.&quot;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"># Set KeyExchangeAlgorithms configuration.</span><br><span class="line">New-Item &apos;HKLM:SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms&apos; -Force | Out-Null</span><br><span class="line">$secureKeyExchangeAlgorithms = @(</span><br><span class="line">  &apos;Diffie-Hellman&apos;,</span><br><span class="line">  &apos;ECDH&apos;,</span><br><span class="line">  &apos;PKCS&apos;</span><br><span class="line">)</span><br><span class="line">Foreach ($secureKeyExchangeAlgorithm in $secureKeyExchangeAlgorithms) &#123;</span><br><span class="line">  $key = (Get-Item HKLM:\).OpenSubKey(&apos;SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms&apos;, $true).CreateSubKey($secureKeyExchangeAlgorithm)</span><br><span class="line">  New-ItemProperty -path &quot;HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\KeyExchangeAlgorithms\$secureKeyExchangeAlgorithm&quot; -name &apos;Enabled&apos; -value &apos;0xffffffff&apos; -PropertyType &apos;DWord&apos; -Force | Out-Null</span><br><span class="line">  $key.close()</span><br><span class="line">  Write-Host &quot;KeyExchangeAlgorithm $secureKeyExchangeAlgorithm has been enabled.&quot;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"># Set cipher suites order as secure as possible (Enables Perfect Forward Secrecy).</span><br><span class="line">$os = Get-WmiObject -class Win32_OperatingSystem</span><br><span class="line">if ([System.Version]$os.Version -lt [System.Version]&apos;10.0&apos;) &#123;</span><br><span class="line">  Write-Host &apos;Use cipher suites order for Windows 2008R2/2012/2012R2.&apos;</span><br><span class="line">  $cipherSuitesOrder = @(</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P521&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P256&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P521&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P384&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P521&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P384&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P256&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P521&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P384&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P256&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P521&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P521&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P384&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P521&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P384&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P521&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P384&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P256&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P521&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P384&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P256&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P521&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P384&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P256&apos;,</span><br><span class="line">    &apos;TLS_RSA_WITH_AES_256_GCM_SHA384&apos;,</span><br><span class="line">    &apos;TLS_RSA_WITH_AES_128_GCM_SHA256&apos;,</span><br><span class="line">    &apos;TLS_RSA_WITH_AES_256_CBC_SHA256&apos;,</span><br><span class="line">    &apos;TLS_RSA_WITH_AES_128_CBC_SHA256&apos;,</span><br><span class="line">    &apos;TLS_RSA_WITH_AES_256_CBC_SHA&apos;,</span><br><span class="line">    &apos;TLS_RSA_WITH_AES_128_CBC_SHA&apos;,</span><br><span class="line">    &apos;TLS_RSA_WITH_3DES_EDE_CBC_SHA&apos;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">  Write-Host &apos;Use cipher suites order for Windows 10/2016 and later.&apos;</span><br><span class="line">  $cipherSuitesOrder = @(</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA&apos;,</span><br><span class="line">    &apos;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA&apos;,</span><br><span class="line">    &apos;TLS_RSA_WITH_AES_256_GCM_SHA384&apos;,</span><br><span class="line">    &apos;TLS_RSA_WITH_AES_128_GCM_SHA256&apos;,</span><br><span class="line">    &apos;TLS_RSA_WITH_AES_256_CBC_SHA256&apos;,</span><br><span class="line">    &apos;TLS_RSA_WITH_AES_128_CBC_SHA256&apos;,</span><br><span class="line">    &apos;TLS_RSA_WITH_AES_256_CBC_SHA&apos;,</span><br><span class="line">    &apos;TLS_RSA_WITH_AES_128_CBC_SHA&apos;,</span><br><span class="line">    &apos;TLS_RSA_WITH_3DES_EDE_CBC_SHA&apos;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">$cipherSuitesAsString = [string]::join(&apos;,&apos;, $cipherSuitesOrder)</span><br><span class="line"># One user reported this key does not exists on Windows 2012R2. Cannot repro myself on a brand new Windows 2012R2 core machine. Adding this just to be save.</span><br><span class="line">New-Item &apos;HKLM:\SOFTWARE\Policies\Microsoft\Cryptography\Configuration\SSL\00010002&apos; -ErrorAction SilentlyContinue</span><br><span class="line">New-ItemProperty -path &apos;HKLM:\SOFTWARE\Policies\Microsoft\Cryptography\Configuration\SSL\00010002&apos; -name &apos;Functions&apos; -value $cipherSuitesAsString -PropertyType &apos;String&apos; -Force | Out-Null</span><br><span class="line">  </span><br><span class="line">Write-Host &apos;--------------------------------------------------------------------------------&apos;</span><br><span class="line">Write-Host &apos;NOTE: After the system has been rebooted you can verify your server&apos;</span><br><span class="line">Write-Host &apos;      configuration at https://www.ssllabs.com/ssltest/&apos;</span><br><span class="line">Write-Host &quot;--------------------------------------------------------------------------------`n&quot;</span><br><span class="line">  </span><br><span class="line">Write-Host -ForegroundColor Red &apos;A computer restart is required to apply settings. Restart computer now?&apos;</span><br><span class="line">Restart-Computer -Force -Confirm</span><br></pre></td></tr></table></figure><p>注意提示： 有些cipherSuitesOrder已经是弱的，或者已经是漏洞的算法；<br>注意上面提到的一些内容，只是作为参考其深入原理。</p><p>我在操作的过程中查阅到了一些问题：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tNc79gy1ftgb1s4xejj30gm07b3zx.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>因为我发现我设置通信协议为 TLS1.2 之后 SQL的客户端连接访问木有问题； 但是我的程序跑不起来了；坑爹了，到底哪里有问题了；就查阅到可能不支持TLS1.2；就是上述的截图；地址🔗<a href="http://kenhamady.com/cru/archives/2867" target="_blank" rel="noopener">http://kenhamady.com/cru/archives/2867</a></p><p>原来它娘的不支持TLS1.2 走的是TLS1.0； 哎呀，有点坑爹呀，木办法，继续得查询资料Google到这样子的一份资料：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tNc79gy1ftgbdxg8znj30pf02cwfc.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>需要安装新的驱动程序，然后才能通过新的语法去连接SQL高版本支持的TLS1.2；</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tNc79gy1ftgbf9a2hsj30px0b4acy.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>驱动连接的下载地址：<a href="https://docs.microsoft.com/en-us/sql/connect/oledb/oledb-driver-for-sql-server?view=sql-server-2017#3-microsoft-ole-db-driver-for-sql-server-msoledbsql" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/sql/connect/oledb/oledb-driver-for-sql-server?view=sql-server-2017#3-microsoft-ole-db-driver-for-sql-server-msoledbsql</a></p><p>有点特别强调： SQL2005版本是无法支持TLS1.2的；所以它是有TLS1.0的漏洞 TLS POOLED的；</p><p>希望我写的东西，能帮到一些童鞋理解一些里面的东西～～～～</p><p>说白了很简单： 下载SQL20016的数据库，好好安装；完成之后下载客户端2017或者其他支持TLS1.2的都行，最好是最新版本，为什么捏？因为新的东西支持的算法以及协议会比较完善；不会太多漏洞；但是也是有风险的，例如一些语法可能不支持了，需要修改你程序的一些代码才能兼容和运行起来； 然后下载新的连接驱动；那么，就基本OK了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;SQL如何支持TLS1-2&quot;&gt;&lt;a href=&quot;#SQL如何支持TLS1-2&quot; class=&quot;headerlink&quot; title=&quot;SQL如何支持TLS1.2&quot;&gt;&lt;/a&gt;SQL如何支持TLS1.2&lt;/h1&gt;&lt;p&gt;近期工作需要送检项目被扫描处以下漏洞：&lt;/p&gt;
&lt;f
      
    
    </summary>
    
    
      <category term="SQL" scheme="http://lmwtuedu.cn/categories/SQL/"/>
    
    
      <category term="SQL" scheme="http://lmwtuedu.cn/tags/SQL/"/>
    
      <category term="TLV1.2" scheme="http://lmwtuedu.cn/tags/TLV1-2/"/>
    
  </entry>
  
  <entry>
    <title>SQL2005 配置SSL证书流程</title>
    <link href="http://lmwtuedu.cn/2018/06/14/2018-06-14-SQL2005%20%E9%85%8D%E7%BD%AESSL%E8%AF%81%E4%B9%A6%E6%B5%81%E7%A8%8B/"/>
    <id>http://lmwtuedu.cn/2018/06/14/2018-06-14-SQL2005 配置SSL证书流程/</id>
    <published>2018-06-13T16:00:00.000Z</published>
    <updated>2019-09-17T08:17:51.041Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SQL2005-配置SSL证书流程"><a href="#SQL2005-配置SSL证书流程" class="headerlink" title="SQL2005 配置SSL证书流程"></a>SQL2005 配置SSL证书流程</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><blockquote><p>本人负责公司项目，送检公安部的时候，SQL2005的数据库被检测出如下问题，需要修复证书制作问题，查阅问题，特整理出来供大家参考。</p></blockquote><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fsapuuv5vpj30sd0ikn0d.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fsaqbln8q9j30sm0hrwh3.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>说明： 安装的SQL2005的数据库，自带动生成的证书是RSA1024和SHA-1的算法；SHA-1的算法已经被视为弱哈希算法（2017一月份）。所以我们得自己制作一张RSA1024以上的SHA256以上的证书，而且要是服务器的证书；</p><h2 id="制作流程"><a href="#制作流程" class="headerlink" title="制作流程"></a>制作流程</h2><p>检测环境： windows7 64位系统；</p><p>制作环境： windows7 64位系统；</p><h3 id="启动系统的ISS"><a href="#启动系统的ISS" class="headerlink" title="启动系统的ISS"></a>启动系统的ISS</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fsaqntm1pzj30bv0brgn2.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>说明： 安装SQL2005数据库的时候，如果报的任何错误和警告⚠️都需要认真查看和解决！ SQL2005数据库安装提前启动ISS服务，我本人操作时，先开启windos功能； web管理器的里面全部开启，万维网的也全部开启； （先不管有木有用，反正你也不清楚安装过程那些需要哪些不需要，先全部开放，后续如果不需要再关闭）； 有人可能会问，为什么不先安装后续解决开启； 呃，因为安装过程中软件会建立一些联系关系呀，例如路径之类的，注册表之类的，没有开启，它如何寻找到哪里呢？ 所以本人不建议你先安装而不去开启这些服务（这都是本人踩过很多坑总结的）；还有一点就是SQL的卸载很麻烦；所以争取一次搞定，不出现任何问题。前人已经帮你栽树，你只需乘凉就好啦！</p><h3 id="SQL安装"><a href="#SQL安装" class="headerlink" title="SQL安装"></a>SQL安装</h3><ol><li>具体安装流程我就不细说了，注意我截图的内容，强调二个位置（公司技术支持竟然不知道区别，得拉出去打屁屁）；</li></ol><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fsaqvxmvjij3072071glu.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>SQL Server Management Studio 是客户端的登陆界面；</p><p>SQL Server Configuration Management才是SQL的服务设置界面</p><h3 id="制作证书"><a href="#制作证书" class="headerlink" title="制作证书"></a>制作证书</h3><ul><li><p>前提安装VS2010的环境，因为只有VS2010的才支持SHA256之后的哈希算法；VS2008只支持MD5和SHA1（我司编译器，哎呀，讨厌死微软一套了）</p></li><li><p>如果你们的公司有证书服务器的话，可以略过此步骤啦，没有得继续查看哟</p></li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fsar5b5oc7j30io0cyt9o.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fsarb6077bj30oo07bglx.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><h3 id="安装证书"><a href="#安装证书" class="headerlink" title="安装证书"></a>安装证书</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fsarb6077bj30oo07bglx.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><ul><li>证书安装到ISS服务</li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fsarc43h0zj313s0iytby.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><ul><li>自己制作的证书只适合测试用，不受CA信赖，所以需要注册到根证书池；双击安装到证书池</li></ul><h3 id="SQL2005注册表查看替换SQL默认证书"><a href="#SQL2005注册表查看替换SQL默认证书" class="headerlink" title="SQL2005注册表查看替换SQL默认证书"></a>SQL2005注册表查看替换SQL默认证书</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fsarfk4qtaj31ba0qan0w.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><ul><li><p>Certificate 的存储的事证书的指纹哈希值；即IIS服务器证书的指纹哈希值</p></li><li><p>安装之后重新启动SQL的服务器程序；通过配置查看证书是否成功</p></li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fsare1d8x1j314r0gndij.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><ul><li><p>如果报错，或者启动不了，说明CN的制作的名称与SQL的ServerName的名称不一样，最好的方式事查看 SQL的日志 ERRORLOG的文件，里面有一行数据会显示server name的名称；我们需要记录，用于制作证书作为 CN的名称；</p></li><li><p>也可查看注册表</p></li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fsarf448n5j319u0q30x4.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><h3 id="重新链接SQL2005"><a href="#重新链接SQL2005" class="headerlink" title="重新链接SQL2005"></a>重新链接SQL2005</h3><ul><li>注意服务器启动项</li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fsarkpaq8qj312n0db0vp.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><ul><li>如果你是普通用户，请以管理员的身份运行程序（我司技术支持不知道如何用管理员身份运行，打屁屁）； 右键点击运行程序，选择管理员运行；</li></ul><h3 id="OK，SQL2005-的SSL配置完成"><a href="#OK，SQL2005-的SSL配置完成" class="headerlink" title="OK，SQL2005 的SSL配置完成"></a>OK，SQL2005 的SSL配置完成</h3><ul><li>用户可以明文链接</li><li>用户可以用SSL证书链接</li><li>用户可以用window程序登陆链接</li></ul><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><font color="red">不分先后顺序，对我解决我自己的问题，提供很大帮助和思路</font></li></ul><p>【资料参考】：<br><a href="https://blogs.msdn.microsoft.com/apgcdsd/2011/03/21/sql-server-1-sql-server-connection-encyption/" target="_blank" rel="noopener">https://blogs.msdn.microsoft.com/apgcdsd/2011/03/21/sql-server-1-sql-server-connection-encyption/</a></p><p>【内容截图显示】：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fsarpm3q3hj31c10fzgv7.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>[参考资料]<br>SQL制作证书流程：<br><a href="https://blogs.msdn.microsoft.com/apgcdsd/2011/01/19/how-tosql-server/" target="_blank" rel="noopener">https://blogs.msdn.microsoft.com/apgcdsd/2011/01/19/how-tosql-server/</a></p><p>【参考资料】<br><a href="https://docs.microsoft.com/zh-cn/sql/tools/configuration-manager/protocols-for-mssqlserver-properties-flags-tab?view=sql-server-2017" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/sql/tools/configuration-manager/protocols-for-mssqlserver-properties-flags-tab?view=sql-server-2017</a></p><p>【内容截图】<br>证书内容截图：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fsarrbk4shj31c10q3u00.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>如何查找证书<br>【参考资料】<br><a href="https://support.microsoft.com/en-us/help/318605/how-sql-server-uses-a-certificate-when-the-force-protocol-encryption-o" target="_blank" rel="noopener">https://support.microsoft.com/en-us/help/318605/how-sql-server-uses-a-certificate-when-the-force-protocol-encryption-o</a></p><p>bug漏洞：<br>5号： SSLv3 Padding Oracle On Downgraded Legacy Encryption Vulnerability(POOLE)<br>6号： TLS Padding Oracle Information Disclosure Vulnerability(TLS POODLE)<br>【参考资料】<br><a href="https://blog.csdn.net/u011078940/article/details/51554210" target="_blank" rel="noopener">https://blog.csdn.net/u011078940/article/details/51554210</a></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fsarrxsavqj31c10gpgy0.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>修改修改SQL的注册键值<br>【参考资料】<br><a href="http://stackoverflow.org.cn/front/ask/view?ask_id=660021" target="_blank" rel="noopener">http://stackoverflow.org.cn/front/ask/view?ask_id=660021</a></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fsarsqn0vhj31c1195b29.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>还有一点要注意的是：CN的名称； 如果CN的名称和主机不一样注意修改：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fsarta15z2j31c10qm4qp.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>证书从哪里来？<br>制作证书的流程：<br>【资料参考】<br>【网站】<br><a href="https://blogs.msdn.microsoft.com/apgcdsd/2011/01/19/how-tosql-server/" target="_blank" rel="noopener">https://blogs.msdn.microsoft.com/apgcdsd/2011/01/19/how-tosql-server/</a></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fsartql8bfj31c10oan8p.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>注意:<br>selfssl.exe 制作的证书默认的哈希算法是SHA-1； 不能修改，而SHA-1已经在2017年已经被判定为不安全哈希算法；因此不能制作RSA2048SHA256的证书。<br>只能通过makeCert的方式进行制作。</p><p>而通过makecert制作的时候，makecert的版本也要注意，VS2008版本只能制作MD5和SHA1的；VS2010的版本才可以制作SHA256以上的版本；<br>【参考资料】<br><a href="https://msdn.microsoft.com/zh-cn/library/bfsktky3(v=vs.100).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/zh-cn/library/bfsktky3(v=vs.100).aspx</a></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fsarwmmuvhj31c10mqdwx.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>注意此版本信息查阅：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fsasc3zsa9j31c1088acb.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>证书制作好了之后，就是安装证书：</p><p>链接地址参考：</p><p><a href="http://stackoverflow.org.cn/front/ask/view?ask_id=660021" target="_blank" rel="noopener">http://stackoverflow.org.cn/front/ask/view?ask_id=660021</a></p><p><a href="https://blog.csdn.net/u011078940/article/details/51554210" target="_blank" rel="noopener">https://blog.csdn.net/u011078940/article/details/51554210</a></p><p><a href="https://blogs.msdn.microsoft.com/apgcdsd/2011/01/19/how-tosql-server/" target="_blank" rel="noopener">https://blogs.msdn.microsoft.com/apgcdsd/2011/01/19/how-tosql-server/</a></p><p><a href="https://docs.microsoft.com/en-us/previous-versions/dotnet/netframework-1.1/bfsktky3(v=vs.71)" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/previous-versions/dotnet/netframework-1.1/bfsktky3(v=vs.71)</a></p><p><a href="https://www.microsoft.com/en-us/download/confirmation.aspx?id=17275" target="_blank" rel="noopener">https://www.microsoft.com/en-us/download/confirmation.aspx?id=17275</a></p><p><a href="https://docs.microsoft.com/zh-cn/sql/tools/configuration-manager/protocols-for-mssqlserver-properties-flags-tab?view=sql-server-2017" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/sql/tools/configuration-manager/protocols-for-mssqlserver-properties-flags-tab?view=sql-server-2017</a></p><p><a href="https://blogs.msdn.microsoft.com/apgcdsd/2011/03/21/sql-server-1-sql-server-connection-encyption/" target="_blank" rel="noopener">https://blogs.msdn.microsoft.com/apgcdsd/2011/03/21/sql-server-1-sql-server-connection-encyption/</a></p><p><a href="https://support.microsoft.com/en-us/help/316898/how-to-enable-ssl-encryption-for-an-instance-of-sql-server-by-using-mi" target="_blank" rel="noopener">https://support.microsoft.com/en-us/help/316898/how-to-enable-ssl-encryption-for-an-instance-of-sql-server-by-using-mi</a></p><p><a href="https://social.technet.microsoft.com/Forums/ie/en-US/f9dfdf68-df16-45c6-a349-72b3129f97fc/how-to-generate-a-csr-in-iis-75-with-sha2-algorithm?forum=winserversecurity" target="_blank" rel="noopener">https://social.technet.microsoft.com/Forums/ie/en-US/f9dfdf68-df16-45c6-a349-72b3129f97fc/how-to-generate-a-csr-in-iis-75-with-sha2-algorithm?forum=winserversecurity</a></p><p><a href="https://blog.csdn.net/wuwo333/article/details/53020403" target="_blank" rel="noopener">https://blog.csdn.net/wuwo333/article/details/53020403</a></p><p><a href="https://www.cnblogs.com/daxueba-ITdaren/p/4635784.html" target="_blank" rel="noopener">https://www.cnblogs.com/daxueba-ITdaren/p/4635784.html</a></p><p><a href="https://technet.microsoft.com/en-us/library/dd632629.aspx" target="_blank" rel="noopener">https://technet.microsoft.com/en-us/library/dd632629.aspx</a></p><p><a href="https://stackoverflow.com/questions/36817627/ssl-certificate-missing-from-dropdown-in-sql-server-configuration-manager" target="_blank" rel="noopener">https://stackoverflow.com/questions/36817627/ssl-certificate-missing-from-dropdown-in-sql-server-configuration-manager</a></p><p><a href="https://msdn.microsoft.com/zh-sg/library/bfsktky3(v=vs.100)" target="_blank" rel="noopener">https://msdn.microsoft.com/zh-sg/library/bfsktky3(v=vs.100)</a></p><p><a href="https://msdn.microsoft.com/zh-sg/library/bfsktky3(v=vs.100)" target="_blank" rel="noopener">https://msdn.microsoft.com/zh-sg/library/bfsktky3(v=vs.100)</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;SQL2005-配置SSL证书流程&quot;&gt;&lt;a href=&quot;#SQL2005-配置SSL证书流程&quot; class=&quot;headerlink&quot; title=&quot;SQL2005 配置SSL证书流程&quot;&gt;&lt;/a&gt;SQL2005 配置SSL证书流程&lt;/h1&gt;&lt;h2 id=&quot;背景&quot;&gt;&lt;
      
    
    </summary>
    
    
      <category term="SQL" scheme="http://lmwtuedu.cn/categories/SQL/"/>
    
    
      <category term="SQL2005" scheme="http://lmwtuedu.cn/tags/SQL2005/"/>
    
      <category term="SSL" scheme="http://lmwtuedu.cn/tags/SSL/"/>
    
  </entry>
  
  <entry>
    <title>前后端API交互如何保证数据安全性</title>
    <link href="http://lmwtuedu.cn/2018/06/08/2018-06-08-%E5%89%8D%E5%90%8E%E7%AB%AFAPI%E4%BA%A4%E4%BA%92%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E6%80%A7%EF%BC%9F/"/>
    <id>http://lmwtuedu.cn/2018/06/08/2018-06-08-前后端API交互如何保证数据安全性？/</id>
    <published>2018-06-07T16:00:00.000Z</published>
    <updated>2019-09-17T08:17:26.362Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前后端API交互如何保证数据安全性？"><a href="#前后端API交互如何保证数据安全性？" class="headerlink" title="前后端API交互如何保证数据安全性？"></a>前后端API交互如何保证数据安全性？</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前后端分离的开发方式，我们以接口为标准来进行推动，定义好接口，各自开发自己的功能，最后进行联调整合。无论是开发原生的APP还是webapp还是PC端的软件,只要是前后端分离的模式，就避免不了调用后端提供的接口来进行业务交互。</p><p>网页或者app，只要抓下包就可以清楚的知道这个请求获取到的数据，这样的接口对爬虫工程师来说是一种福音，要抓你的数据简直轻而易举。</p><p>数据的安全性非常重要，特别是用户相关的信息，稍有不慎就会被不法分子盗用，所以我们对这块要非常重视，容不得马虎。</p><h2 id="如何保证API调用时数据的安全性？"><a href="#如何保证API调用时数据的安全性？" class="headerlink" title="如何保证API调用时数据的安全性？"></a>如何保证API调用时数据的安全性？</h2><ul><li><p>通信使用https</p></li><li><p>请求签名，防止参数被篡改</p></li><li><p>身份确认机制，每次请求都要验证是否合法</p></li><li><p>APP中使用ssl pinning防止抓包操作</p></li><li><p>对所有请求和响应都进行加解密操作</p></li><li><p>等等方案…….</p></li></ul><h2 id="对所有请求和响应都进行加解密操作"><a href="#对所有请求和响应都进行加解密操作" class="headerlink" title="对所有请求和响应都进行加解密操作"></a>对所有请求和响应都进行加解密操作</h2><p>方案有很多种，当你做的越多，也就意味着安全性更高，今天我跟大家来介绍一下对所有请求和响应都进行加解密操作的方案，即使能抓包，即使能调用我的接口，但是我返回的数据是加密的，只要加密算法够安全，你得到了我的加密内容也对我没什么影响。</p><p>像这种工作最好做成统一处理的，你不能让每个开发都去关注这件事情，如果让每个开发去关注这件事情就很麻烦了，返回数据时还得手动调用下加密的方法，接收数据后还得调用下解密的方法。</p><p>为此，我基于Spring Boot封装了一个Starter, 内置了AES加密算法。GitHub地址如下：</p><p><a href="https://github.com/yinjihuan/spring-boot-starter-encrypt" target="_blank" rel="noopener">https://github.com/yinjihuan/spring-boot-starter-encrypt</a></p><p>先来看看怎么使用，可以下载源码，然后引入即可，然后在启动类上增加@EnableEncrypt注解开启加解密操作：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@EnableEncrypt</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class App &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(App.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>增加加密的key配置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.encrypt.key=abcdef0123456789</span><br><span class="line">spring.encrypt.debug=false</span><br></pre></td></tr></table></figure><ul><li><p>spring.encrypt.key：加密key，必须是16位</p></li><li><p>spring.encrypt.debug：是否开启调试模式,默认为false,如果为true则不启用加解密操作</p></li></ul><p>为了考虑通用性，不会对所有请求都执行加解密，基于注解来做控制</p><p>响应数据需要加密的话，就在Controller的方法上加@Encrypt注解即可。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Encrypt</span><br><span class="line">@GetMapping(&quot;/list&quot;)</span><br><span class="line">public Response queryNews(String city) &#123;</span><br><span class="line">    return Response.ok(city);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当我们访问/list接口时，返回的数据就是加密之后base64编码的格式。</p><p>还有一种操作就是前段提交的数据，分为2种情况，一种是get请求，这种暂时没处理，后面再考虑，目前只处理的post请求，基于json格式提交的方式，也就是说后台需要用@RequestBody接收数据才行, 需要解密的操作我们加上@Decrypt注解即可。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Decrypt</span><br><span class="line">@PostMapping(&quot;/save&quot;)</span><br><span class="line">public Response savePageLog(@RequestBody PageLogParam logParam, HttpServletRequest request) &#123;</span><br><span class="line">    pageLogService.save(logParam);</span><br><span class="line">    return Response.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>加了@Decrypt注解后，前端提交的数据需要按照AES加密算法，进行加密，然后提交到后端，后端这边会自动解密，然后再映射到参数对象中。</p><p>上面讲解的都是后端的代码，前端使用的话我们以js来讲解，当然你也能用别的语言来做，如果是原生的安卓app也是用java代码来处理。</p><p>前段需要做的就2件事情：</p><ul><li><p>统一处理数据的响应，在渲染到页面之前进行解密操作</p></li><li><p>当有POST请求的数据发出时，统一加密</p></li></ul><p>js加密文件请参考我GitHub中encrypt中的aes.js,crypto-js.js,pad-zeropadding.js</p><p>我们以axios来作为请求数据的框架，用axios的拦截器来统一处理加密解密操作</p><p>首先还是要封装一个js加解密的类，需要注意的是加密的key需要和后台的对上，不然无法相互解密，代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">var key  = CryptoJS.enc.Latin1.parse(&apos;abcdef0123456789&apos;);</span><br><span class="line">var iv   = CryptoJS.enc.Latin1.parse(&apos;abcdef0123456789&apos;);</span><br><span class="line">// 加密</span><br><span class="line">function EncryptData(data) &#123;</span><br><span class="line">    var srcs = CryptoJS.enc.Utf8.parse(data);</span><br><span class="line">    var encrypted = CryptoJS.AES.encrypt(srcs, key, &#123;</span><br><span class="line">        mode : CryptoJS.mode.ECB,</span><br><span class="line">        padding : CryptoJS.pad.Pkcs7</span><br><span class="line">    &#125;);</span><br><span class="line">    return encrypted.toString();</span><br><span class="line">&#125;</span><br><span class="line">// 解密</span><br><span class="line">function DecryptData(data) &#123;</span><br><span class="line">    var stime = new Date().getTime();</span><br><span class="line">    var decrypt = CryptoJS.AES.decrypt(data, key, &#123;</span><br><span class="line">        mode : CryptoJS.mode.ECB,</span><br><span class="line">        padding : CryptoJS.pad.Pkcs7</span><br><span class="line">    &#125;);</span><br><span class="line">    var result = JSON.parse(CryptoJS.enc.Utf8.stringify(decrypt).toString());</span><br><span class="line">    var etime = new Date().getTime();</span><br><span class="line">    console.log(&quot;DecryptData Time:&quot; + (etime - stime));</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>axios拦截器中统一处理代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 添加请求拦截器</span><br><span class="line">axios.interceptors.request.use(function (config) &#123;</span><br><span class="line">    // 对所有POST请加密，必须是json数据提交，不支持表单</span><br><span class="line">    if (config.method == &quot;post&quot;) &#123;</span><br><span class="line">        config.data = EncryptData(JSON.stringify(config.data));</span><br><span class="line">    &#125;</span><br><span class="line">    return config;</span><br><span class="line">  &#125;, function (error) &#123;</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">&#125;);</span><br><span class="line">// 添加响应拦截器</span><br><span class="line">axios.interceptors.response.use(function (response) &#123;</span><br><span class="line">    // 后端返回字符串表示需要解密操作</span><br><span class="line">    if(typeof(response.data) == &quot;string&quot;)&#123;</span><br><span class="line">        response.data = DecryptData(response.data);</span><br><span class="line">    &#125;</span><br><span class="line">    return response;</span><br><span class="line">  &#125;, function (error) &#123;</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>到此为止，我们就为整个前后端交互的通信做了一个加密的操作，只要加密的key不泄露，别人得到你的数据也没用，问题是如何保证key不泄露呢？</p><p>服务端的安全性较高，可以存储在数据库中或者配置文件中，毕竟在我们自己的服务器上，最危险的其实就时前端了，app还好，可以打包，但是要防止反编译等等问题。</p><p>如果是webapp则可以依赖于js加密来实现，下面我给大家介绍一种动态获取加密key的方式，只不过实现起来比较复杂，我们不上代码，只讲思路：</p><p>加密算法有对称加密和非对称加密，AES是对称加密，RSA是非对称加密。之所以用AES加密数据是因为效率高，RSA运行速度慢,可以用于签名操作。</p><p>我们可以用这2种算法互补，来保证安全性，用RSA来加密传输AES的秘钥，用AES来加密数据，两者相互结合，优势互补。</p><p>其实大家理解了HTTPS的原理的话对于下面的内容应该是一看就懂的，HTTPS比HTTP慢的原因都是因为需要让客户端与服务器端安全地协商出一个对称加密算法。剩下的就是通信时双方使用这个对称加密算法进行加密解密。</p><ol><li><p>客户端启动，发送请求到服务端，服务端用RSA算法生成一对公钥和私钥，我们简称为pubkey1,prikey1，将公钥pubkey1返回给客户端。</p></li><li><p>客户端拿到服务端返回的公钥pubkey1后，自己用RSA算法生成一对公钥和私钥，我们简称为pubkey2,prikey2，并将公钥pubkey2通过公钥pubkey1加密，加密之后传输给服务端。</p></li><li><p>此时服务端收到客户端传输的密文，用私钥prikey1进行解密，因为数据是用公钥pubkey1加密的，通过解密就可以得到客户端生成的公钥pubkey2</p></li><li><p>然后自己在生成对称加密，也就是我们的AES,其实也就是相对于我们配置中的那个16的长度的加密key,生成了这个key之后我们就用公钥pubkey2进行加密，返回给客户端，因为只有客户端有pubkey2对应的私钥prikey2，只有客户端才能解密，客户端得到数据之后，用prikey2进行解密操作，得到AES的加密key,最后就用加密key进行数据传输的加密，至此整个流程结束。</p></li></ol><p>##spring-boot-starter-encrypt原理<br>最后我们来简单的介绍下spring-boot-starter-encrypt的原理吧，也让大家能够理解为什么Spring Boot这么方便，只需要简单的配置一下就可以实现很多功能。</p><p>启动类上的@EnableEncrypt注解是用来开启功能的,通过@Import导入自动配置类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Target(&#123;ElementType.TYPE&#125;)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">@Inherited</span><br><span class="line">@Import(&#123;EncryptAutoConfiguration.class&#125;)</span><br><span class="line">public @interface EnableEncrypt &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>EncryptAutoConfiguration中配置请求和响应的处理类，用的是Spring中的RequestBodyAdvice和ResponseBodyAdvice，在Spring中对请求进行统计处理比较方便。如果还要更底层去封装那就要从servlet那块去处理了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@Component</span><br><span class="line">@EnableAutoConfiguration</span><br><span class="line">@EnableConfigurationProperties(EncryptProperties.class)</span><br><span class="line">public class EncryptAutoConfiguration &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 配置请求解密</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public EncryptResponseBodyAdvice encryptResponseBodyAdvice() &#123;</span><br><span class="line">        return new EncryptResponseBodyAdvice();</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * 配置请求加密</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public EncryptRequestBodyAdvice encryptRequestBodyAdvice() &#123;</span><br><span class="line">        return new EncryptRequestBodyAdvice();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过RequestBodyAdvice和ResponseBodyAdvice就可以对请求响应做处理了，大概的原理就是这么多了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;前后端API交互如何保证数据安全性？&quot;&gt;&lt;a href=&quot;#前后端API交互如何保证数据安全性？&quot; class=&quot;headerlink&quot; title=&quot;前后端API交互如何保证数据安全性？&quot;&gt;&lt;/a&gt;前后端API交互如何保证数据安全性？&lt;/h1&gt;&lt;h2 id=&quot;前
      
    
    </summary>
    
    
      <category term="code" scheme="http://lmwtuedu.cn/categories/code/"/>
    
    
      <category term="safe" scheme="http://lmwtuedu.cn/tags/safe/"/>
    
      <category term="API" scheme="http://lmwtuedu.cn/tags/API/"/>
    
  </entry>
  
  <entry>
    <title>累死你的不是工作，而是工作方法</title>
    <link href="http://lmwtuedu.cn/2018/05/18/2018-05-18-%E7%B4%AF%E6%AD%BB%E4%BD%A0%E7%9A%84%E4%B8%8D%E6%98%AF%E5%B7%A5%E4%BD%9C%EF%BC%8C%E8%80%8C%E6%98%AF%E5%B7%A5%E4%BD%9C%E6%96%B9%E6%B3%95/"/>
    <id>http://lmwtuedu.cn/2018/05/18/2018-05-18-累死你的不是工作，而是工作方法/</id>
    <published>2018-05-17T16:00:00.000Z</published>
    <updated>2019-09-17T08:16:39.903Z</updated>
    
    <content type="html"><![CDATA[<h2 id="累死你的不是工作，而是工作方法"><a href="#累死你的不是工作，而是工作方法" class="headerlink" title="累死你的不是工作，而是工作方法"></a>累死你的不是工作，而是工作方法</h2><p>我们一直都认为，如果一个人智商情商正常、学习和工作意愿高，就一定能出成绩。</p><p>然而，我带过很多人，也招过很多人，却发现一个奇怪的现象：有一些人，十分有意愿学习，非常努力，智商情商也都正常，然而工作产出却非常低，甚至不如很多资质低于他们的人。</p><p>我一直百思不得其解，一度怀疑自己看人不准。直到前阵子看到吴军的这段叙述，才幡然醒悟，仔细回想了这些人的工作方式，将他们与产出高的人相比，发现他们无一例外都存在这三个问题：</p><h3 id="问题1：只关注任务，不关注目标"><a href="#问题1：只关注任务，不关注目标" class="headerlink" title="问题1：只关注任务，不关注目标"></a>问题1：只关注任务，不关注目标</h3><p>假如你的老板正在飞机上，还有1小时落地，下来之后需要给客户做一个重要汇报，而你需要给他做一份PPT。但因为你错估了时间，导致PPT草草做完，而且发现其中一些数据没有，你怎么办？</p><p> 低效人士的做法是：疯狂地找数据，最后可能数据有了，然而PPT没有来得及做完，或者质量不高。</p><p> 一般人的做法是：找人帮自己一起找数据。</p><p> 而最高效的那些人，会根据老板此次汇报的目的，判断这些数据在其中的作用大小，如果作用不大，那么就把时间花在完善重要页数、而不是找数据上，如果很关键，那么就找其他人帮忙，或者找一些替代数据。</p><p> 这三类人之间的差距，其实就是任务导向与目标导向的差距。</p><p>  我此前的咨询公司，在做高潜人才研究的时候，有个发现：高潜力的人才是有共性的，具备这些共性的人，几乎做什么都能做好，而不具备的，几乎做任何工作都会障碍重重。</p><p> 这其中，有一项共性就是Result-driven（结果驱动）。那些高产出的人，未必动作更快，而是更善于判断，什么事情对结果是最有效的，然后，用尽一切办法保证结果达成，而不是死守着原有的工作任务。</p><p> 实际上，结果驱动不仅仅是一种工作习惯，更是一种思维方式。这种以终为始的思维模式，是我自己刻意训练的最有用的思维模式之一。</p><p> 比如思维训练营里，有学员问我：如何让自己对一个行业有真知灼见？</p><p> 想想看，如果是你，会如何回答？</p><p>我的回答方式，是反问她：具备真知灼见的目的是什么呢？是想让客户更加信任你、还是想让老板看到你的进步？</p><p> 假设你是希望客户信任你，觉得你懂他，那你要做的，就是看这个行业里的客户有什么痛点，然后针对这几个痛点，下功夫研究和分析，有更多洞见，然后借机沟通出去。了解一个行业，是一个太大的话题，没有目标，根本无从下手。</p><p> 所以，没有结果驱动的思维，而仅仅死守着工作任务，最终就是，出工不出活儿。</p><h3 id="问题2：应激式工作，而非统筹式工作"><a href="#问题2：应激式工作，而非统筹式工作" class="headerlink" title="问题2：应激式工作，而非统筹式工作"></a>问题2：应激式工作，而非统筹式工作</h3><p>如果你观察周围的同事，会发现，整天风风火火、急得上蹿下跳、各种任务来回切换的人，有时候产出并不高。看他们工作，就好像打地鼠一样，打完一个，另一个又冒上来，连看的人都跟着焦虑起来。</p><p> 而另一类人，他们做事专注、条理清晰、看起来很淡定，但最后，多困难的事儿都默默搞定了。</p><p> 两者的差别就在于，第一类人总是应激式工作。他们每天起来的第一件事，不是规划当天的工作，而是马上投入工作，以至于到了下班之后，发现还有很多事情没做完，而没做完的，可能又是最重要的。</p><p> 另外，领导临时给个任务、客户临时有个要求、同事临时要个数据，他们都会停下手里的事情，去忙这些，最终，在任务的切换上花费了巨大的精力。</p><p> 我跟公司的运营打过一个比方：假设你每项工作任务平均半小时可以做完，而任务之间的切换通常也要半小时，如果你经常一项不做完就切换到下一项，就算每个任务中途切换一次吧，那就意味着，8小时的工作时间，你至少有4小时都花在任务切换上了。</p><p> 这种应激式工作方式无疑是低效的，那什么才是高效的呢？统筹式工作。</p><p> 真正的统筹式工作，有几个特征：</p><p><strong>特征一，有计划地工作</strong></p><p> 我通常周日晚上就会排好下周每天的工作，而每天早上会排好当天的工作。而且，任务清单在工作的时候一直开着、实时更新，完成一项删掉一项，临时增加一项就插入相应的时间段，当天完不成的、非紧急的任务，我就改成第二天的日期。</p><p> 这种方式，会让自己很有掌控感，多少事情来了，都不会乱了阵脚。</p><p> 当然，在做计划的时候，你需要为高价值问题分配最多专门的时间。我此前特地写过一篇文章，就提到，大部分人在80%的时间里都是做无用功，根本原因就是没搞清楚真正要解决的问题。这6个问题，可以帮你省80%的无用功。</p><p><strong>特征二，形成自己固定的时间习惯</strong></p><p> 比如我的习惯是，在上午做需要烧脑的事情、在交通工具上听书、在饭后效率不高的时候集中回复微信消息和留言、在等人的时候构思下篇文章主题、在疲劳的时候刷一下公众号、在傍晚的时候跟团队开会、在晚上做一个简单总结。</p><p> 这种习惯，一方面把不同难度的工作跟自己的效率波峰波谷相匹配，达到效率最大化；另一方面，我会清楚地知道，5分钟、10分钟、30分钟，对我来说分别可以干什么，这样就不会一有碎片时间，就习惯性地刷朋友圈了。</p><p><strong>特征三，及时记录、每天总结</strong></p><p> 当你正在工作的时候，老板布置了一个任务、客户又来了一个问题，你会如何呢？很多人就直接扑到临时任务上去了，但真正好的做法是，如果不是十万火急，你可以快速用关键词记在笔记本上，不需要任何思考，然后马上回到刚才的任务，做完再看笔记本。</p><p> 另外，你在一天当中，学到了什么、犯了什么错误，当时也要记下来，因为过了那个时候，你很快就会忘，然后继续犯这个错误。当然，这些记录，晚上都需要进行整理。</p><p> 我曾说过，此前8年多的顾问生涯里，成长最快的那半年，我每天都坚持写工作日记。</p><p> 另外，记录还有一个好处，就是可以减轻大脑负担。每天的例行工作、自己常犯的错误，这些都可以列清单。你的大脑是用来思考的，是很宝贵的，别把一支笔就可以做的事情，强加给你的大脑来做。</p><h3 id="问题3：几乎从不“偷懒”"><a href="#问题3：几乎从不“偷懒”" class="headerlink" title="问题3：几乎从不“偷懒”"></a>问题3：几乎从不“偷懒”</h3><p>“懒癌”是第一生产力。仔细盘点一下，我们哪样创新不是因为懒呢？不想走路，有了汽车；不想爬楼，有了电梯；不想打扫，有了扫地机器人……</p><p>工作中的大部分事情，并不是一次性的，而是持续的，那么就可以在第一次做的时候，搭好框架。</p><p> 比如，我让运营每周做一次数据分析，这个事情是重复性的，所以高效的做法是：建一张excel表格，把固定需要分析的参数都做好公式，每周只需要把导出来的源数据贴进去，刷新之后参数就出来，然后只需要看参数来得出结论。</p><p> 当然，这里所说的偷懒，不仅是善用工具，还包括善用他人。</p><p> 比如，你从来没做过数据分析，那么就先去找找前人怎么做的；比如，你有自己的团队或者实习生，那就不要做任何他们就可以做的事情；再比如，去运营社群，摸索出一套群主激励机制，比你自己去做群主，要高效得多。</p><p>所以，这三个让你Work Smart的工作方式，听起来难吗？一点也不，而且你很可能也听说过。但是，为什么很多人做不到呢？我观察下来，有几个障碍：</p><h3 id="障碍1：工作环境所限。"><a href="#障碍1：工作环境所限。" class="headerlink" title="障碍1：工作环境所限。"></a>障碍1：工作环境所限。</h3><p> 很多人的工作性质，就不是结果导向型的，而是任务导向型的。他的工作岗位要求他做的，就是完成任务，至于背后的出发点，不需要知道。而且，领导有可能就是考核努力、考核苦劳，而不是考核产出。</p><p> 实际上，工作性质对一个人的思维方式、行为习惯的影响，大到超乎想象。</p><p>你去看，刚毕业的时候，一个学校一个专业的同学，看起来差不多，但过了几年，你会发现，只要接触一个人几分钟，听他说几句话，就能大致判断出他的职业。</p><p> 再极端一些的，多年前我曾经因为要帮客户设计流程，去他们的产线观察生产过程，在噪音极大、灯光昏暗的厂房里，我看着流水线工人机械地盯着机器、等待换箱，几个小时下来，我自己也开始反应迟钝、敏锐度下降了。</p><h3 id="障碍2：没有资深的人辅导。"><a href="#障碍2：没有资深的人辅导。" class="headerlink" title="障碍2：没有资深的人辅导。"></a>障碍2：没有资深的人辅导。</h3><p> 从开头的案例可以看出，Google工程师那么优秀的一群人，在从校园进入公司之后，也需要有经验的人辅导。</p><p> 但很多公司并不像Google那样，重视对新人工作方式的培养，将Work Smart提到非常高的位置。</p><p> 他们往往只重视教员工What（需要做哪些事情、用什么工具等等），却没有How（如何聪明地做这些事情）和Why（这些事情对公司、对客户有什么帮助、要达到何种目的），导致员工的聪明才干发挥不出来，没有成就感。</p><h3 id="障碍3：思维方式固化。"><a href="#障碍3：思维方式固化。" class="headerlink" title="障碍3：思维方式固化。"></a>障碍3：思维方式固化。</h3><p> 一部分人，会在工作多年之后，发现工作性质和工作环境的负面影响，醒悟过来想要改变。</p><p> 然而，从学校踏入社会的这几年，是思维和工作方式形成的关键几年，如果任务导向、应激式努力、闷头蛮干的工作方式在大脑中固化了，形成了下意识思维，是很难扭转过来的。</p><p> 我带过几个人，此前的工作经历都是任务式、应激式的，在跟他们合作的时候，的确能够感受到他们与自己固有思维作斗争的痛苦与挣扎，然而，并不是每个人最终都能挣扎出来、突破自我的。</p><p> 所以，年轻时候的工作选择，你选择的不只是一份工作，而是一种思维习惯、工作方式、价值观甚至生活方式。</p><p> 在初入职场的几年，处于何种工作环境、跟谁一起工作、被谁辅导工作，足以影响你的下半辈子。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;累死你的不是工作，而是工作方法&quot;&gt;&lt;a href=&quot;#累死你的不是工作，而是工作方法&quot; class=&quot;headerlink&quot; title=&quot;累死你的不是工作，而是工作方法&quot;&gt;&lt;/a&gt;累死你的不是工作，而是工作方法&lt;/h2&gt;&lt;p&gt;我们一直都认为，如果一个人智商情商正
      
    
    </summary>
    
    
      <category term="article" scheme="http://lmwtuedu.cn/categories/article/"/>
    
    
      <category term="news" scheme="http://lmwtuedu.cn/tags/news/"/>
    
  </entry>
  
  <entry>
    <title>今日头条》再被整肃　“内涵段子”永久关停</title>
    <link href="http://lmwtuedu.cn/2018/04/12/2018-04-12-%E4%BB%8A%E6%97%A5%E5%A4%B4%E6%9D%A1%E2%80%94%E5%86%85%E6%B6%B5%E6%AE%B5%E5%AD%90/"/>
    <id>http://lmwtuedu.cn/2018/04/12/2018-04-12-今日头条—内涵段子/</id>
    <published>2018-04-11T16:00:00.000Z</published>
    <updated>2019-09-17T08:16:34.553Z</updated>
    
    <content type="html"><![CDATA[<p>##《今日头条》再被整肃　“内涵段子”永久关停</p><p><a href="https://botanwang.com/articles/201804/%E5%86%8D%E8%AF%9A%E6%81%B3%E7%9A%84%E9%81%93%E6%AD%89%E4%B9%9F%E6%94%B9%E5%8F%98%E4%B8%8D%E4%BA%86%E5%91%BD%E8%BF%90.html" target="_blank" rel="noopener">再诚恳的道歉也改变不了命运</a></p><blockquote><p>佛曰：再诚恳的道歉也改变不了命运</p></blockquote><p>今日头条创始人、CEO 张一鸣的致歉信成为今日热点，张老板的道歉信写得极其诚恳，完全不像一个工程师的手笔，严重怀疑是某知名写手的代笔。他在致歉信中说：‌‌“我真诚地向监管部门致歉，向用户及同事们道歉。从昨天下午接到监管部门的通知到现在，我一直处在自责和内疚之中，一夜未眠。产品走错了路，出现了与社会主义核心价值观不符的内容，没有贯彻好舆论导向，接受处罚，所有责任在我。我们片面注重增长和规模，却没有及时强化质量和责任，忽视了引导用户获取正能量信息的责任。对承担企业社会责任，弘扬正能量，把握正确的舆论导向认识不够，思想上缺乏重视。一直以来，我们过分强调技术的作用，却没有意识到，技术必须要用社会主义核心价值观来引导，传播正能量，符合时代要求，尊重公序良俗。‌‌”他还声称今日头条将永久关停‌‌“内涵段子‌‌”客户端软件及公众号，还说要强化总编辑责任制，全面纠正算法和机器审核的缺陷，不断强化人工运营和审核，将现有6000人的运营审核队伍，扩大到10000 人。</p><p>作为一个成功的知名互联网企业的老总，张老板的道歉信已经到了声泪俱下诚惶诚恐卑躬屈膝的程度，让人几乎不忍卒读心生同情了。建议研究企业史的朋友好好保存这份致歉信，它是了解当下营商环境和企业家生存法则的经典文献，其史料价值也许不亚于四十年前小岗村农民要求包产到户的血手印文书。据说改革开放都四十年了，此国做企业的还动辄得罪，动不动就要写检讨过关，也难怪境外势力血口喷人说咱们搞的不是市场经济了。至于咱这里搞的是啥子经济，经济学家们有各种忽悠，看了张老板今天的检讨，我突然恍然大悟：原来我们搞的是检讨经济。</p><p>在朋友圈，看到张鸣老师调侃道：‌‌“原来以为张一鸣比我多个‌‌‘一’，牛逼大了。现在看来，他还不如我，我只是在小时候写检讨，他都这个岁数了，还在写检讨。‌‌”确实，张一鸣同志比起有点反骨的知识人，这个检讨够低声下气的，可是那么大的企业摆在人家手心里，不服软还真不行，张鸣老师是一人吃饱全家不饿，张一鸣同志却是身家性命全靠D恩，我辈本是蓬蒿人，岂能摧眉折腰事权贵？不得不感叹，在赵家</p><p>村当老板，真是窝囊憋屈得很，想站着把钱挣，实在很难，想学《白鹿原》中的白嘉轩那样挺直腰杆，可是任凭你多么有经营才华，一不小心就有绑匪的铁棒抽来，直接把你干趴下！</p><p>去年春节跟我90后的侄儿聊天，得知他在某直播公司做经纪，我说：那你得小心，你这个行业是打擦边球的，很可能因为低俗就被端掉。侄儿确信心满满的说：我们不谈政治，我支持某大大，不会有事的。我说：不是你不谈政治<em>政</em>治就不关心你，互联网头上一直悬着把剑，你知道网信办么？他说：我不知道，我不关心这个。话到这里，聊天就基本聊死了。作为长辈，虽然心里骂了他三声傻逼，可还是不忍心骂出口。</p><p>我都没法跟他讲去年我在看守*所遇到的一个哥们的故事。那哥们在深圳办了一个网络公司，也是搞三俗</p><p>的，打擦边球，靠放不露点的AV 短视频赚取网民的充值点播费，短短几个月就通过第三方支付收到几</p><p>千万的分成。结果全公司几十人被一锅端，这哥们现在面临着巨额诈骗罪起诉，在里面苦等着一审开庭。在里面经常听他闲聊创业之苦，平民百姓，无背景，无资源，赚钱难，只有捞偏门，打擦边球。只是可怜他老婆和一岁的女儿，不知道以后怎么办。每每谈及，他总是泪下。</p><p>最近和广州一个企业家朋友聊天，他做实体曾经很成功，早已亿万身价，谈及现在的经营环境，他说：现在跟我打球的老板越来越多了，大家都不知道以后该干嘛怎么干了。真是春江水暖鸭先知，谁说今天的老板们为富不仁犬儒混沌了，他们每天在泥水里打滚，水深水浅水冷水暖最敏感，珠三角的老板们都如此，其他地区的老板就不用说了。</p><p>鲁迅先生曾说：‌‌“中国历来只经历了两个时代，一个是暂时坐稳了奴隶的时代，一个是想做奴隶而不可得</p><p>的时代。‌‌”鲁夫子要是活在此时代，怕也只能再次如此感叹了，或者，他感叹都发不出了，早已经在里面啃窝窝头了。</p><p>不过，我相信在张老板此番真诚的检讨之后，他的奴才宝座暂时是可以坐稳一阵的，毕竟，乖宝宝才有好饭吃，至于以后如何，那只有天晓得了。</p><p>延伸阅读：黄云腾：告别内涵再见段友（三声）</p><p>内涵段子关停的消息，是在4月10日下午——这个平静的周二下午——传到了大伟的耳朵里。</p><p>大伟把手机打开，点击内涵段子的应用图标。手忙脚乱没有让应用打开的速度变得更快。应用上的短视频和段子依旧，不过，评论里有人证实了这个伤感的消息。有人晒出了官方通知的截图。上面写着，</p><p>由于‌‌“导向不正、格调低俗‌‌”，内涵段子将被永久关停。</p><p>永久关停——意味着‌‌“内涵段子‌‌”客户端软件及公众号将被无限期关闭。行政机构还要求内涵段子的母公司字节跳动举一反三，全面清理类似视听节目产品。</p><p>大伟今年23岁，使用内涵段子已经5年，生活在江苏无锡。这个平台确实长期存在着打擦边球的黄色或其它违规内容，是吸引很多人来到这里获得某种快乐的直接原因。</p><p>但关停的消息来得很突兀，没有人被事先通知，特别是长期乐在其中的段友。</p><p>5年时间里，大伟的闲暇时间几乎都在这款应用上度过，他会在上面看搞笑的视频和段子，和人对暗号。大伟用了自己的车之后，立即在网上买了一款‌‌“内涵段子‌‌”的车贴，贴在自己的车上。当车堵在路中间，或者需要等红灯，大伟时常可以听到同道中人在车尾鸣笛——节奏相同的、一长两短的‌‌“滴-滴滴‌‌”声。</p><p>这是段友们在人海茫茫中互相辨认的明证，也是彼此心照不宣的一张身份证。此时此刻你在微博等社交平台上，还可以搜到无数这样段友相认的视频。</p><p>5年过去了，大伟还记得自己从内涵段子认识段友，和段友见面的心情。那是一种找到了组织的感觉，就好像漂流在大海上的船只终于跟上了自己的船队。</p><p>2018年的4月，中国很多地方冷热交替，阴晴不定。有些事情的解决方案，注定是一种鸵鸟哲学。这五年时间里，大伟说，他的每一台手机，开机时装的第一个APP，都是内涵段子。</p><p>他把手机打开，发了一条微博，自从有了内涵段子，大伟已经很久没有再用微博。他写下，‌‌“你不仅仅是个app，你更是我的青春‌‌”。</p><p>‌‌“啤酒小龙虾，段友是一家‌‌”</p><p>在7点41分的时候，段友的另一个聚集地，内涵段子贴吧里陷入一片混乱。消息已经传开。有人不愿相信，发帖还在询问，‌‌“真的就这样了吗？‌‌”</p><p>百度贴吧上，很多人也都有类似的疑问和震惊。名为‌‌“内涵段子‌‌”的百度贴吧在大伟接到消息不久后就和另外一个名为‌‌“段友之家吧‌‌”的贴吧合并，超过100万的大伟们在吧内逡巡，时不时发出‌‌“应该何去何从‌‌”的疑问和零星略显激烈的抗议声。</p><p>在两篇置顶的帖子中，其中一篇便是劝告大家理性发言。</p><p>作为今日头条的第二款独立产品，内涵段子诞生于2012年。在它诞生前后，没人可以想到这款产品可以迸发出这么大的能量，也没有人可以预估这款产品和它衍生的群体——段友，会成为中文互联网世界中一个隐秘但坚实的群体。</p><p>但是，这一切的的确确发生了。从湖南到新疆，再从山西到浙江，DJ到学生，形形色色的人都有可能是内涵段子的一份子。</p><p>4月6日，一个长沙望城的女孩在微博上晒出了望城段友聚会的视频。在这份7分钟的视频中，画面中有20余人站成一排，所有人的汽车后面都贴了内涵段子的车贴。</p><p>段友的交往方式遍布全国的各个地区社群，他们有着一套自己的社交体系和行为规矩。例如，‌‌“滴~滴滴‌‌”这个一长两短的汽车喇叭声，和内涵段子的车贴作为互相识别的标识；类似口号有‌‌“啤酒小龙虾，段友是一家‌‌”、‌‌“轻风吹杨柳，敢问是段友‌‌”、‌‌“天王盖地虎，小鸡炖蘑菇‌‌”等等。</p><p>内涵段子最开始是被设计为今日头条用户的导流入口。今日头条CEO张一鸣曾经坦言，内涵段子和它的‌‌“大哥‌‌”搞笑囧图都是这种思路的产物。</p><p>‌‌“我们要覆盖很多形式；我们要覆盖很多平台，有手机有PC ……其实这些产品（内涵段子），都涵盖了之前的想法，只不过以一种比较接地气的想法诞生。因为当时的移动互联网发展非常快，我们希望快速推出产品，以获取用户来验证想法。‌‌”</p><p>承接百思不得姐和糗事百科的内涵段子，从一开始就立足于接地气和满足快乐。在某种程度上，这种以段子和搞笑视频为主的快乐消解了严肃的意义，从而显得low或低俗——在最大程度上，它却可以让人们拥有对同一事物的相同视角或认同感。</p><p>《内涵段子》这首歌，如今在网易云音乐上评论已经突破9000条。这首歌是内涵段子的非官方主题曲。创作者程炳杰之前是沈阳音乐学院的学生。他最初只是把这首歌上传到内涵段子里——这个集成文字、图片于一体的应用，在上线视频功能后拉动了一波上传热潮，此后让视频成为内涵段子中内容分发的主要形式。</p><p>程炳杰的歌曲最终获得了17万个赞，并因此获得了将其灌录成唱片的机会。在这首歌里，程炳杰写道，‌‌“看到段子带给我们的/不止微笑眼泪/让太多的内涵让你我体会/内涵的不止是段子还有每个人的美。‌‌”</p><p>这股凝聚力也拉动整个应用得以向社区转变。娇姐和楠哥是来自长沙的一对情侣，因为内涵段子而结识。2017年6月，他们在长沙梅溪湖进行段友聚会。一位段友带了台无人机，他们借此拿着对讲机指挥航拍汽车双闪。后来，航拍段友车队就在社区里流行起来。</p><p>他们也会一起聚起来做公益，为长沙失聪的孩子们送去玩偶公仔、课桌椅子、和画具。2017年12月，拥有900人规模的甘肃段友俱乐部来到甘肃斜坡希望小学，为学前班到六年级的孩子，带来了92套服装、68套学习用品和若干体育用品。</p><p>‌‌“APP不在，人还在‌‌”</p><p>无论是在乐山、介休、平梁，还是新榆、铜陵，你都可以看见同样的场景：汽车的亮光打在路边，几十辆汽车排成几排，无人机在空中航拍，汽车边的人们都露出某种上扬的、熟悉的笑容。像某种回声又或者一种微弱的响应，熟悉的声音响了起来，‌‌“滴—滴滴……‌‌”</p><p>更大的不确定性一直存在于这种段友自发性的行动之中，后者也始终处于被注意的状态之下。</p><p>今天晚上20点，海门公安在微博上发布通告称，发现有部分人员通过网络召集的形式自行组织‌‌“抖友‌‌”聚集活动，活动地点均选择在道路及一些公共场所，涉嫌触犯法律。</p><p>这封通告还提到，根据《中华人民共和国集会游行示威法》，公安机关可以对负责人和直接负责人处以警告或者十五日以下拘留。</p><p>此前，西安市也曾对段友在部分路段鸣笛做出罚款处理。不过，相比这种温和的处理手段，海门似乎有意对‌‌“抖友‌‌”聚会进行定性，来将其规范在合理合规的官方体系。</p><p>今年，今日头条在官方监管中被认为具有了更强烈的危险性。从去年年底到今天，今日头条已经被官方处罚五次。今年3月29日，今日头条因为违规‌‌“二跳‌‌”，被人民日报定性为‌‌“不安分、不守法‌‌”。昨天下午3点，今日头条被要求从各互联网应用商店暂停下载。在这次处罚里，今日头条被要求暂停下载服务3周，时间从4月9日15时起至4月30日15时止。</p><p>在张一鸣的话术中，2018年本来是今日头条在社会责任发力的一年。‌‌“2018对我们已满六年的企业来说……作为一个社会的一分子，一家平台型企业来说，我们希望在企业社会责任这一块能做更多的事情。‌‌”</p><p>前不久，张一鸣在今年年初清华大学的一次分享中还谈道，‌‌“过去我们更多关心业务的成长，现在我们希望对管理团队，对业务负责人提出更高的要求。不仅关心业务，不仅关心全球化，也能够有更开阔的视角去认识、承担更多的企业社会责任。‌‌”</p><p>这个故事需要更稳定的产品壁垒和防御体系支撑。在今天晚上，人民网发布微评，‌‌“产品不能沦为算法的奴隶‌‌”，今日头条因此得到了‌‌“外科手术式‌‌”监管。以西瓜视频、火山小视频、抖音、悟空问答、内涵段子为矩阵的今日头条，也将不得不因此面临产品环节缺失与舆论审判的双重压力。</p><p>今晚，抖音发布公告称将在本周第一期反沉迷系统。用户连续使用90分钟后将被提醒用户注意时间。此外，抖音还提供由用户设定密码开启的时间锁功能，一旦单日使用时长累计达到2小时，系统将自动锁定，用户需要重新输入密码才能继续使用。</p><p>由于售假，以及多地出现模仿抖音视频受伤事件，抖音不得不采取这类应急措施，用以维护产品和正在形成的‌‌“抖友‌‌”的社群稳定。</p><p>虽然在很多段友中存在着对抖音的鄙视传统，但是在内涵段子最后的时间里，很多段友相约在抖音重逢。就在刚刚，抖音已经无法查看留言评论，也因为服务维护而参与留言。</p><p>倒回到晚上5点23分的时候，一封帖子开始得到吧友响应。那是一位吧友上传了官方通知关停的截图。这位有着7.1年吧龄的吧友，把帖子的标题取成‌‌“段友们，再最后对一遍暗号‌‌”。这就是这封帖子的全部和残留在段友们——千千万万的大伟们，眼中最后的一抹温情记忆——一切都在不言中。</p><p>现在，在内涵段子的首页是关停公告，首页的视频永远停留在了同一条，标题是‌‌“厉害了，我的…‌‌”</p><p>（注：文中大伟为化名）</p><p>我们在内涵段子里看到的十句留言</p><p>‌‌“一觉醒来，家TM没了。‌‌”</p><p>‌‌“今后唯一能笑的地方都灰飞烟灭了。‌‌”</p><p>‌‌“巅峰诞生虚伪的拥护，黄昏见证虔诚的信徒。‌‌”</p><p>‌‌“4.10内涵空难。‌‌”</p><p>‌‌“内涵段子最后一个刷新出来的是一句话，厉害了我的国。‌‌”</p><p>‌‌“我不会卸载，我等着你。‌‌”</p><p>‌‌“如果多年以后我孩子问我，爸爸内涵段子是什么组织，我会微笑并自豪着说那是我的青春。‌‌”</p><p>‌‌“内涵一日不死，抖音永远是太子，结果真的死了。‌‌”</p><p>‌‌“有多少人像我一样拿起手机不知道该干嘛了。‌‌”</p><p>‌‌“APP不在了，但是我们车友还在，路上还能遇见段友，请记住，滴~滴滴。‌‌”</p><blockquote><p>结束语： 赚钱的方式永远都在刑法里，你要触动它吗？</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;##《今日头条》再被整肃　“内涵段子”永久关停&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://botanwang.com/articles/201804/%E5%86%8D%E8%AF%9A%E6%81%B3%E7%9A%84%E9%81%93%E6%AD%89%E4%B
      
    
    </summary>
    
    
      <category term="article" scheme="http://lmwtuedu.cn/categories/article/"/>
    
    
      <category term="news" scheme="http://lmwtuedu.cn/tags/news/"/>
    
  </entry>
  
  <entry>
    <title>Java跨平台读取本机硬件信息</title>
    <link href="http://lmwtuedu.cn/2018/04/02/2018-04-02-Java%E8%B7%A8%E5%B9%B3%E5%8F%B0%E8%AF%BB%E5%8F%96%E6%9C%AC%E6%9C%BA%E7%A1%AC%E4%BB%B6%E4%BF%A1%E6%81%AF/"/>
    <id>http://lmwtuedu.cn/2018/04/02/2018-04-02-Java跨平台读取本机硬件信息/</id>
    <published>2018-04-01T16:00:00.000Z</published>
    <updated>2019-09-17T08:16:04.058Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Java跨平台读取本机硬件信息"><a href="#Java跨平台读取本机硬件信息" class="headerlink" title="Java跨平台读取本机硬件信息"></a>Java跨平台读取本机硬件信息</h3><p>最近做一个授权项目，需要查询各种系统的硬件信息，例如CPU、MAC等等。 于是各种google了一下，查询到了Sigar这个工具。</p><p><a href="http://sourceforge.net/projects/sigar/files/latest/download?source=files" target="_blank" rel="noopener">sigar-1.6.4.zip下载地址</a></p><ul><li>maven</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.fusesource&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;sigar&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.6.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><ul><li>非Maven：直接拷贝下载压缩包中的Sigar.jar 到你的项目lib目录</li></ul><h3 id="添加sigar本地库到-java-library-path"><a href="#添加sigar本地库到-java-library-path" class="headerlink" title="添加sigar本地库到 java.library.path"></a>添加sigar本地库到 java.library.path</h3><p>sigar API 依赖本地库文件工作的，内部通过java.library.path加载本地库文件。 本地库文件根据不同的平台，有下面这些文件。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tNc79gy1fpychr574vj30cx0ecdhz.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>我试着将这些文件放在classpath下（src/main/resources）或者通过 sigar-dist 依赖的方式加载都以失败告终。网上有篇<a href="http://arviarya.wordpress.com/2013/09/22/sigar-access-operating-system-and-hardware-level-information/" target="_blank" rel="noopener">博客</a> 讲如何通过解压 sigar-dist 依赖的方式，来组织 java.library.path，但是整个配置太过复杂。</p><p>最终我想到个办法是:</p><p>将 sigar 的本地库文件放在 src/main/resources/sigar 目录下，还是的 classpath 下<br>通过 java api 读取 sigar 路径，并将路径追加到 java.library.path中。</p><p>代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package com.darker.util.sigar;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * helper class to check the operating system this Java VM runs in</span><br><span class="line"> * http://stackoverflow.com/questions/228477/how-do-i-programmatically-determine-operating-system-in-java</span><br><span class="line"> * compare to http://svn.terracotta.org/svn/tc/dso/tags/2.6.4/code/base/common/src/com/tc/util/runtime/Os.java</span><br><span class="line"> * http://www.docjar.com/html/api/org/apache/commons/lang/SystemUtils.java.html</span><br><span class="line"> */</span><br><span class="line">public final class OsCheck &#123;</span><br><span class="line">    /**</span><br><span class="line">     * types of Operating Systems</span><br><span class="line">     */</span><br><span class="line">    public enum OSType &#123;</span><br><span class="line">        Windows, MacOS, Linux, Other</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected static OSType detectedOS;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * detected the operating system from the os.name System property and cache</span><br><span class="line">     * the result</span><br><span class="line">     *</span><br><span class="line">     * @returns - the operating system detected</span><br><span class="line">     */</span><br><span class="line">    public static OSType getOperatingSystemType() &#123;</span><br><span class="line">        if (detectedOS == null) &#123;</span><br><span class="line">            String OS = System.getProperty(&quot;os.name&quot;, &quot;generic&quot;).toLowerCase();</span><br><span class="line">            if (OS.indexOf(&quot;win&quot;) &gt;= 0) &#123;</span><br><span class="line">                detectedOS = OSType.Windows;</span><br><span class="line">            &#125; else if ((OS.indexOf(&quot;mac&quot;) &gt;= 0) || (OS.indexOf(&quot;darwin&quot;) &gt;= 0)) &#123;</span><br><span class="line">                detectedOS = OSType.MacOS;</span><br><span class="line">            &#125; else if (OS.indexOf(&quot;nux&quot;) &gt;= 0) &#123;</span><br><span class="line">                detectedOS = OSType.Linux;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                detectedOS = OSType.Other;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return detectedOS;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">package com.darker.util.sigar;</span><br><span class="line"></span><br><span class="line">import com.google.common.io.Resources;</span><br><span class="line">import org.hyperic.sigar.Sigar;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author gaohui</span><br><span class="line"> * @date 13-11-27 19:43</span><br><span class="line"> */</span><br><span class="line">public class SigarUtil &#123;</span><br><span class="line"></span><br><span class="line">    public final static Sigar sigar = initSigar();</span><br><span class="line"></span><br><span class="line">    private static Sigar initSigar() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            String file = Resources.getResource(&quot;sigar/.sigar_shellrc&quot;).getFile();</span><br><span class="line">            File classPath = new File(file).getParentFile();</span><br><span class="line"></span><br><span class="line">            String path = System.getProperty(&quot;java.library.path&quot;);</span><br><span class="line">            if (OsCheck.getOperatingSystemType() == OsCheck.OSType.Windows) &#123;</span><br><span class="line">                path += &quot;;&quot; + classPath.getCanonicalPath();</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                path += &quot;:&quot; + classPath.getCanonicalPath();</span><br><span class="line">            &#125;</span><br><span class="line">            System.setProperty(&quot;java.library.path&quot;, path);</span><br><span class="line"></span><br><span class="line">            return new Sigar();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h3><ol><li>平常我们编译各种平台下的库时，如何解决跨平的问题？ </li><li>sigar这部分的开源设计代码是否值得我们学习他的设计模式？</li><li></li></ol><h3 id="参考地址"><a href="#参考地址" class="headerlink" title="参考地址"></a>参考地址</h3><p><a href="https://blog.csdn.net/u013474568/article/details/52250908" target="_blank" rel="noopener">sigar使用示例</a></p><p><a href="https://blog.csdn.net/c446984928/article/details/50739873" target="_blank" rel="noopener">java项目中使用Sigar获取系统信息</a></p><p><a href="http://bastengao.com/blog/2013/12/using-sigar-in-maven-project.html" target="_blank" rel="noopener">在 maven 项目中使用 sigar</a></p><p><a href="https://gist.github.com/bastengao/7853455" target="_blank" rel="noopener">源码参考</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Java跨平台读取本机硬件信息&quot;&gt;&lt;a href=&quot;#Java跨平台读取本机硬件信息&quot; class=&quot;headerlink&quot; title=&quot;Java跨平台读取本机硬件信息&quot;&gt;&lt;/a&gt;Java跨平台读取本机硬件信息&lt;/h3&gt;&lt;p&gt;最近做一个授权项目，需要查询各种系统
      
    
    </summary>
    
    
      <category term="code" scheme="http://lmwtuedu.cn/categories/code/"/>
    
    
      <category term="Java" scheme="http://lmwtuedu.cn/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>吉他的音阶</title>
    <link href="http://lmwtuedu.cn/2018/04/01/2018-04-01-%E5%90%89%E4%BB%96%E7%9A%84%E9%9F%B31234567%E7%9A%84%E5%BC%B9%E6%B3%95/"/>
    <id>http://lmwtuedu.cn/2018/04/01/2018-04-01-吉他的音1234567的弹法/</id>
    <published>2018-03-31T16:00:00.000Z</published>
    <updated>2019-09-17T08:15:26.098Z</updated>
    
    <content type="html"><![CDATA[<h3 id="吉他的音1234567的弹法"><a href="#吉他的音1234567的弹法" class="headerlink" title="吉他的音1234567的弹法"></a>吉他的音1234567的弹法</h3><p>请看  C调音阶图：</p><p>示例：“1”的音在5弦三品上。“2”的音在5弦五品上，“3”的音在4弦二品上，“4”的音在4弦四品上，“5”的音在3弦空弦上，“6”的音在3弦二品上，“7”的音在3弦空弦上。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fpxmeojnvnj30go06aq3n.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>从上往下依次为一弦（最细）到六弦（最粗）。从左到右是一品到二十一品。</p><p>空弦音表示在此弦的空弦上弹奏左手不需要按弦。例如3弦空弦音是“5”，表示3弦空弦时拨动后发出是“5”的音。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;吉他的音1234567的弹法&quot;&gt;&lt;a href=&quot;#吉他的音1234567的弹法&quot; class=&quot;headerlink&quot; title=&quot;吉他的音1234567的弹法&quot;&gt;&lt;/a&gt;吉他的音1234567的弹法&lt;/h3&gt;&lt;p&gt;请看  C调音阶图：&lt;/p&gt;
&lt;p&gt;示例：“
      
    
    </summary>
    
    
      <category term="music" scheme="http://lmwtuedu.cn/categories/music/"/>
    
    
      <category term="guitar" scheme="http://lmwtuedu.cn/tags/guitar/"/>
    
  </entry>
  
  <entry>
    <title>我不愿意再为谁一路小跑，气喘吁吁了</title>
    <link href="http://lmwtuedu.cn/2018/03/27/2018-03-27-%E6%88%91%E4%B8%8D%E6%84%BF%E6%84%8F%E5%86%8D%E4%B8%BA%E8%B0%81%E4%B8%80%E8%B7%AF%E5%B0%8F%E8%B7%91%E6%B0%94%E5%96%98%E5%90%81%E5%90%81%E4%BA%86/"/>
    <id>http://lmwtuedu.cn/2018/03/27/2018-03-27-我不愿意再为谁一路小跑气喘吁吁了/</id>
    <published>2018-03-26T16:00:00.000Z</published>
    <updated>2019-09-17T08:14:40.332Z</updated>
    
    <content type="html"><![CDATA[<h2 id="我不愿意再为谁一路小跑，气喘吁吁了"><a href="#我不愿意再为谁一路小跑，气喘吁吁了" class="headerlink" title="我不愿意再为谁一路小跑，气喘吁吁了"></a>我不愿意再为谁一路小跑，气喘吁吁了</h2><p>讲一件真事儿。</p><p>我一个朋友，以前非常非常喜欢一个女生，在她生日的时候为了给她惊喜，把她所有的照片和视频找过来，花好长时间自学了AE软件，用眼花缭乱的特效，给她做了个片子。</p><p>他现在有钱多了，然后现在喜欢的这个女生，他也是很喜欢很喜欢的，但她生日的时候，他不做片子了，打算去网上花点钱找人做首歌送给她。</p><p>好像一首歌比一条片子更好听，也更值得发朋友圈一点儿，但他没有那种再为一个人悄悄去学一整个软件的心情了。</p><p>不是懒，也不是忙，就是……真的没有那心情了。</p><p>那个他送片子的女生，跟他告别的时候是在火车站，他舍不得她，就陪着她坐到目的地，再自己一个人坐回来。</p><p>那是很多年前，十几个小时的绿皮火车。</p><p>我猜他再也没坐过绿皮火车。确实不需要多少钱，可是坐得人太腰酸背痛了。</p><p>我是在他更有钱的时候认识的他，他至今依然是个很善良，很好的男生，也会细致入微地关心女朋友。</p><p>可我知道，从前那种日子回不来了，他不会再为谁坐十几个小时的绿皮火车了，现在这么多高铁，去哪儿都方便，那辆火车不会再开过他的心上了。</p><p>这是我近来听过的最想哭的事儿之一。</p><p>原来人的一辈子，或许就只有一个人是能让我们喜欢到极致，喜欢到歇斯底里，喜欢到可以放下一切的，经过了这个人，后来所有的付出都太礼貌，太克制，也太谨慎了。</p><p>我依然有热情余留给后来爱上的人，但我当初爱你的时候，是我这辈子最浪漫，最勇敢，也最孤注一掷的时候。</p><p>虽然那个时候，你也并没打算珍惜我。</p><p>02</p><p>我以前以为热情是可以再生的，或者说热情是用不完的，如果被一个人伤得太厉害了，就跑到下一个人那里取暖。</p><p>这样听上去很平衡，也很有盼头。</p><p>但不是这样的。</p><p>我发现我这些年，喜欢一个人的时间已经越来越短。</p><p>年轻的时候喜欢一个人，可以越挫越勇地去追，那个人我追了他一年有余，其实你问他优秀吗，并没有，但我就是喜欢，一喜欢我就收不住。</p><p>我那一年多每天花上八九个小时想念他，多难的熬煎，我走过来了。</p><p>我给他送书，指导他写作业，他睡不着，我去找晚安故事念给他听，所有的事情，只要有关他，我不嫌麻烦。</p><p>他让我在电话上唱歌给他听，我唱。他说我不是好的女生，又平庸又敏感，我认。他对我呼之即来挥之即去，我接受。</p><p>我喜欢第二个人的时间大概就几个月吧，我受不了他一直晃晃然，不给我说法，就直接跟他掰了。</p><p>那个时候我其实有大把的时间，也不是什么忙得滴水不漏的成功人士，但，我就是觉得，我开始害怕浪费时间了。</p><p>我喜欢第三个人的时间更短，人嘛，长大了，会探望本质了，知道他跟我不是一路人后，我就干干脆脆地跑回去，继续过自己每天写稿，挣钱，聚餐的日子。</p><p>你问会想他吗，会的，但是，也只有在花钱花得有点没劲儿的时候想那么几秒钟，觉得‌‌“要是他在的话，我可以抱一抱‌‌”，别的没有了。</p><p>表面上看着是我越来越无所谓，越来越刀枪不入，但不是这样的。</p><p>是我的真心快用完了。</p><p>我的浪漫快用完了，我的勇气快用完了。</p><p>我18岁可以为了一个人彻夜不眠，可以为了他去学一门乐器，什么都让着他，现在22岁就不行了，我做什么都会想问一句‌‌“凭什么‌‌”，对感情更是。</p><p>大家时间都好宝贵哦，我凭什么为你不顾一切呢？</p><p>你说，凭什么。</p><p>03</p><p>我长大了，我知道为感情失神太徒然了，我身边全是遍体鳞伤的落败者，我自己也曾经是那个落败者。</p><p>我已经不会有从前那种，没有被任何人篡改和破坏过的完满了。</p><p>我后来喜欢的人其实都非常优秀，优秀得很值得爱，特别值得爱，但我……我身上的爱没有那么多了。</p><p>能方便一点解决的事儿，我绝对不去麻烦。</p><p>现在到处都是五花八门的app，买礼物压根不用挑，比如我再喜欢一个人的时候，要是献殷勤，最多点进一个app，帮他下单一顿早餐，反正就几十块钱。</p><p>你让我亲自赶去他楼下送给他，我是不愿意的。</p><p>但在18岁的时候，我是愿意的。</p><p>我还会一路小跑，气喘吁吁，怕手上的早餐冷掉。</p><p>不，现在我不愿意再为谁一路小跑，气喘吁吁了。</p><p>真的不愿意了。</p><blockquote><p>语录：有人曾经问我，思念一个人到极致是什么感觉，我曾经在深夜里彻底的体会过，我曾在某夜给你发了一句晚安， 迟迟没有收到你的回复， 一晚上醒来七次，看着泛着白光的手机，就是 那种可怕的朦胧的意思， 梦里梦见收到你的回复 然后意识带我从梦中挣扎出来， 立马去翻看手机， 你看这就是思念入骨髓，然后尽然连梦境都不放过！ by LJ</p></blockquote><p>文章转载：<a href="https://botanwang.com/articles/201803/%E6%88%91%E4%B8%8D%E6%84%BF%E6%84%8F%E5%86%8D%E4%B8%BA%E8%B0%81%E4%B8%80%E8%B7%AF%E5%B0%8F%E8%B7%91%EF%BC%8C%E6%B0%94%E5%96%98%E5%90%81%E5%90%81%E4%BA%86.html" target="_blank" rel="noopener">我不愿意再为谁一路小跑，气喘吁吁了</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;我不愿意再为谁一路小跑，气喘吁吁了&quot;&gt;&lt;a href=&quot;#我不愿意再为谁一路小跑，气喘吁吁了&quot; class=&quot;headerlink&quot; title=&quot;我不愿意再为谁一路小跑，气喘吁吁了&quot;&gt;&lt;/a&gt;我不愿意再为谁一路小跑，气喘吁吁了&lt;/h2&gt;&lt;p&gt;讲一件真事儿。&lt;/p
      
    
    </summary>
    
    
      <category term="article" scheme="http://lmwtuedu.cn/categories/article/"/>
    
    
      <category term="news" scheme="http://lmwtuedu.cn/tags/news/"/>
    
  </entry>
  
  <entry>
    <title>lombok注解简单介绍</title>
    <link href="http://lmwtuedu.cn/2018/03/26/2018-03-26-lombok%E6%B3%A8%E8%A7%A3/"/>
    <id>http://lmwtuedu.cn/2018/03/26/2018-03-26-lombok注解/</id>
    <published>2018-03-25T16:00:00.000Z</published>
    <updated>2019-09-17T08:13:53.756Z</updated>
    
    <content type="html"><![CDATA[<h2 id="lombok注解"><a href="#lombok注解" class="headerlink" title="lombok注解"></a>lombok注解</h2><p>lombok是一个可以帮助我们简化java代码编写的工具类，尤其简化JavaBean的编写，即通过采用注解的方式，消除代码中的构造方法，getter/setter等代码，使我们编写的类更加简洁，当然，这带来的副作用就是不易阅读；但是还是可以看得懂，废话不多说，上干货：</p><ul><li>@NonNull</li><li>@Cleanup</li><li>@Getter/@Setter</li><li>@ToString</li><li>@EqualsAndHashCode</li><li>@NoArgsConstructor/@RequiredArgsConstructor/@AllArgsConstructor</li><li>@Data</li><li>@Value</li><li>@SneakyThrows</li><li>@Synchronized</li><li>@Log</li></ul><h3 id="NonNull"><a href="#NonNull" class="headerlink" title="@NonNull"></a>@NonNull</h3><p>这个注解可以用在成员方法或构造方法的参数前面，会自动产生一个关于此参数的非空检查，如果参数为空，则抛出一个空指针异常，举一个例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 成员方法参数加上@NonNull注解</span><br><span class="line">public String getName(@NonNull Person p)&#123;</span><br><span class="line">return p.getName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果相当于:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public String getName(Person p)&#123;</span><br><span class="line">if(null == p)&#123;</span><br><span class="line">throw new NullPointerException(p.toString() + &quot;is null&quot;)</span><br><span class="line">&#125;</span><br><span class="line">return p.getName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用构造方法的参数上效果类似，就不再举例子了。</p><h3 id="Cleanup"><a href="#Cleanup" class="headerlink" title="@Cleanup"></a>@Cleanup</h3><p>这个注解用在变量前面，可以保证此变量代表的资源会被自动关闭，默认是调用资源的close（）方法，如果该资源有其它关闭方法，可以使用@Cleanup(“methodName”)来指定要调用的方法，就用输入输出流来举一个例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) throws IOException&#123;</span><br><span class="line">@Cleanup InputStream in = new FileInputStream(args[0]);</span><br><span class="line">@Cleanup OutputStream out = new FileOutputStream(args[1]);</span><br><span class="line">byte[] b = new bytep[1024];</span><br><span class="line">while(true)&#123;</span><br><span class="line">int r = in.read(b);</span><br><span class="line">if(-1 == r)&#123;</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">out.write(b, 0, r);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实际效果相当于：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) throws IOException &#123;</span><br><span class="line">     InputStream in = new FileInputStream(args[0]);</span><br><span class="line">     try &#123;</span><br><span class="line">       OutputStream out = new FileOutputStream(args[1]);</span><br><span class="line">       try &#123;</span><br><span class="line">         byte[] b = new byte[10000];</span><br><span class="line">         while (true) &#123;</span><br><span class="line">           int r = in.read(b);</span><br><span class="line">           if (r == -1) break;</span><br><span class="line">           out.write(b, 0, r);</span><br><span class="line">         &#125;</span><br><span class="line">       &#125; finally &#123;</span><br><span class="line">         if (out != null) &#123;</span><br><span class="line">           out.close();</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125; finally &#123;</span><br><span class="line">       if (in != null) &#123;</span><br><span class="line">         in.close();</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>是不是简化了很多。</p><h3 id="Getter-Setter"><a href="#Getter-Setter" class="headerlink" title="@Getter/@Setter"></a>@Getter/@Setter</h3><p>这一对注解从名字上就很好理解，用在成员变量前面，相当于为成员变量生成对应的get和set方法，同时还可以为生成的方法指定访问修饰符，当然，默认为public，直接来看下面的简单的例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class Programmer&#123;</span><br><span class="line">    @Getter</span><br><span class="line">    @Setter</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    @Setter(AccessLevel.PROTECTED)</span><br><span class="line">    private int age;</span><br><span class="line"></span><br><span class="line">    @Getter(AccessLevel.PUBLIC)</span><br><span class="line">    private String language;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>效果相当于：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class Programmer&#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private int age;</span><br><span class="line">    private String language;</span><br><span class="line"></span><br><span class="line">    public void setName(String name)&#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName()&#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected void setAge(int age)&#123;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getLanguage()&#123;</span><br><span class="line">        return language;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这两个注解还可以直接用在类上，可以为此类里的所有非静态成员变量生成对应的get和set方法。</p><h3 id="ToString-EqualsAndHashCode"><a href="#ToString-EqualsAndHashCode" class="headerlink" title="@ToString/@EqualsAndHashCode"></a>@ToString/@EqualsAndHashCode</h3><p>这两个注解也比较好理解，就是生成toString，equals和hashcode方法，同时后者还会生成一个canEqual方法，用于判断某个对象是否是当前类的实例，生成方法时只会使用类中的非静态和非transient成员变量，这些都比较好理解，就不举例子了。<br>当然，这两个注解也可以添加限制条件，例如用@ToString(exclude={“param1”，“param2”})来排除param1和param2两个成员变量，或者用@ToString(of={“param1”，“param2”})来指定使用param1和param2两个成员变量，@EqualsAndHashCode注解也有同样的用法。</p><h3 id="NoArgsConstructor-RequiredArgsConstructor-AllArgsConstructor"><a href="#NoArgsConstructor-RequiredArgsConstructor-AllArgsConstructor" class="headerlink" title="@NoArgsConstructor/@RequiredArgsConstructor /@AllArgsConstructor"></a>@NoArgsConstructor/@RequiredArgsConstructor /@AllArgsConstructor</h3><p>这三个注解都是用在类上的</p><p>第一个和第三个都很好理解:就是为该类产生无参的构造方法和包含所有参数的构造方法.</p><p>第二个注解则使用类中所有带有@NonNull注解的或者带有final修饰的成员变量生成对应的构造方法，</p><p>当然，和前面几个注解一样，成员变量都是非静态的，另外，如果类中含有final修饰的成员变量，是无法使用@NoArgsConstructor注解的。 </p><p>三个注解都可以指定生成的构造方法的访问权限，同时，第二个注解还可以用@RequiredArgsConstructor(staticName=”methodName”)的形式生成一个指定名称的静态方法，返回一个调用相应的构造方法产生的对象，下面来看一个生动鲜活的例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@RequiredArgsConstructor(staticName = &quot;sunsfan&quot;)</span><br><span class="line">@AllArgsConstructor(access = AccessLevel.PROTECTED)</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">public class Shape &#123;</span><br><span class="line">    private int x;</span><br><span class="line">    @NonNull</span><br><span class="line">    private double y;</span><br><span class="line">    @NonNull</span><br><span class="line">    private String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实际效果相当于：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public class Shape &#123;</span><br><span class="line">    private int x;</span><br><span class="line">    private double y;</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    public Shape()&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected Shape(int x,double y,String name)&#123;</span><br><span class="line">        this.x = x;</span><br><span class="line">        this.y = y;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Shape(double y,String name)&#123;</span><br><span class="line">        this.y = y;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Shape sunsfan(double y,String name)&#123;</span><br><span class="line">        return new Shape(y,name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Data-Value"><a href="#Data-Value" class="headerlink" title="@Data/@Value"></a>@Data/@Value</h3><p>呃!!<br>@Data注解综合了3,4,5和6里面的@RequiredArgsConstructor注解，其中@RequiredArgsConstructor使用了类中的带有@NonNull注解的或者final修饰的成员变量，它可以使用@Data(staticConstructor=”methodName”)来生成一个静态方法，返回一个调用相应的构造方法产生的对象。这个例子就也省略了吧…<br>@Value注解和@Data类似，区别在于它会把所有成员变量默认定义为private final修饰，并且不会生成set方法。</p><h3 id="SneakyThrows"><a href="#SneakyThrows" class="headerlink" title="@SneakyThrows"></a>@SneakyThrows</h3><p>这个注解用在方法上，可以将方法中的代码用try-catch语句包裹起来，捕获异常并在catch中用Lombok.sneakyThrow(e)把异常抛出，可以使用@SneakyThrows(Exception.class)的形式指定抛出哪种异常，很简单的注解，直接看个例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class SneakyThrows implements Runnable &#123;</span><br><span class="line">    @SneakyThrows(UnsupportedEncodingException.class)</span><br><span class="line">    public String utf8ToString(byte[] bytes) &#123;</span><br><span class="line">        return new String(bytes, &quot;UTF-8&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @SneakyThrows</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        throw new Throwable();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实际效果相当于：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class SneakyThrows implements Runnable &#123;</span><br><span class="line">    @SneakyThrows(UnsupportedEncodingException.class)</span><br><span class="line">    public String utf8ToString(byte[] bytes) &#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            return new String(bytes, &quot;UTF-8&quot;);</span><br><span class="line">        &#125;catch(UnsupportedEncodingException uee)&#123;</span><br><span class="line">            throw Lombok.sneakyThrow(uee);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @SneakyThrows</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            throw new Throwable();</span><br><span class="line">        &#125;catch(Throwable t)&#123;</span><br><span class="line">            throw Lombok.sneakyThrow(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Synchronized"><a href="#Synchronized" class="headerlink" title="@Synchronized"></a>@Synchronized</h3><p>这个注解用在类方法或者实例方法上，效果和synchronized关键字相同，区别在于锁对象不同，对于类方法和实例方法，synchronized关键字的锁对象分别是类的class对象和this对象，而@Synchronized得锁对象分别是私有静态final对象LOCK和私有final对象lock，当然，也可以自己指定锁对象，例子也很简单，往下看：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class Synchronized &#123;</span><br><span class="line">    private final Object readLock = new Object();</span><br><span class="line"></span><br><span class="line">    @Synchronized</span><br><span class="line">    public static void hello() &#123;</span><br><span class="line">        System.out.println(&quot;world&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Synchronized</span><br><span class="line">    public int answerToLife() &#123;</span><br><span class="line">        return 42;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Synchronized(&quot;readLock&quot;)</span><br><span class="line">    public void foo() &#123;</span><br><span class="line">        System.out.println(&quot;bar&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实际效果相当于：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public class Synchronized &#123;</span><br><span class="line">   private static final Object $LOCK = new Object[0];</span><br><span class="line">   private final Object $lock = new Object[0];</span><br><span class="line">   private final Object readLock = new Object();</span><br><span class="line"></span><br><span class="line">   public static void hello() &#123;</span><br><span class="line">     synchronized($LOCK) &#123;</span><br><span class="line">       System.out.println(&quot;world&quot;);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public int answerToLife() &#123;</span><br><span class="line">     synchronized($lock) &#123;</span><br><span class="line">       return 42;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public void foo() &#123;</span><br><span class="line">     synchronized(readLock) &#123;</span><br><span class="line">       System.out.println(&quot;bar&quot;);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="Log"><a href="#Log" class="headerlink" title="@Log"></a>@Log</h3><p>这个注解用在类上，可以省去从日志工厂生成日志对象这一步，直接进行日志记录，具体注解根据日志工具的不同而不同，同时，可以在注解中使用topic来指定生成log对象时的类名。不同的日志注解总结如下(上面是注解，下面是实际作用)：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@CommonsLog</span><br><span class="line">private static final org.apache.commons.logging.Log log = org.apache.commons.logging.LogFactory.getLog(LogExample.class);</span><br><span class="line">@JBossLog</span><br><span class="line">private static final org.jboss.logging.Logger log = org.jboss.logging.Logger.getLogger(LogExample.class);</span><br><span class="line">@Log</span><br><span class="line">private static final java.util.logging.Logger log = java.util.logging.Logger.getLogger(LogExample.class.getName());</span><br><span class="line">@Log4j</span><br><span class="line">private static final org.apache.log4j.Logger log = org.apache.log4j.Logger.getLogger(LogExample.class);</span><br><span class="line">@Log4j2</span><br><span class="line">private static final org.apache.logging.log4j.Logger log = org.apache.logging.log4j.LogManager.getLogger(LogExample.class);</span><br><span class="line">@Slf4j</span><br><span class="line">private static final org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(LogExample.class);</span><br><span class="line">@XSlf4j</span><br><span class="line">private static final org.slf4j.ext.XLogger log = org.slf4j.ext.XLoggerFactory.getXLogger(LogExample.class);</span><br></pre></td></tr></table></figure><p>关于lombok的注解先写到这里，当然，还有其他一些注解需要大家自己去摸索，同时lombok一直在扩展，将来肯定会加入更多的注解元素，拭目以待了。</p><p>转载：<br><a href="https://blog.csdn.net/sunsfan/article/details/53542374" target="_blank" rel="noopener">lombok注解介绍</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;lombok注解&quot;&gt;&lt;a href=&quot;#lombok注解&quot; class=&quot;headerlink&quot; title=&quot;lombok注解&quot;&gt;&lt;/a&gt;lombok注解&lt;/h2&gt;&lt;p&gt;lombok是一个可以帮助我们简化java代码编写的工具类，尤其简化JavaBean的编写，
      
    
    </summary>
    
    
      <category term="code" scheme="http://lmwtuedu.cn/categories/code/"/>
    
    
      <category term="lombok" scheme="http://lmwtuedu.cn/tags/lombok/"/>
    
  </entry>
  
  <entry>
    <title>分布式设计架构初步思路</title>
    <link href="http://lmwtuedu.cn/2018/03/05/2018-03-05-%E5%88%86%E5%B8%83%E8%AE%BE%E8%AE%A1%E6%9E%B6%E6%9E%84%E6%80%9D%E8%B7%AF/"/>
    <id>http://lmwtuedu.cn/2018/03/05/2018-03-05-分布设计架构思路/</id>
    <published>2018-03-04T16:00:00.000Z</published>
    <updated>2019-09-17T08:13:38.348Z</updated>
    
    <content type="html"><![CDATA[<h2 id="分布设计架构思路"><a href="#分布设计架构思路" class="headerlink" title="分布设计架构思路"></a>分布设计架构思路</h2><h3 id="初步设计"><a href="#初步设计" class="headerlink" title="初步设计"></a>初步设计</h3><p>网站的访问特点和现实世界的财富分配一样遵循二八定律： 80%的业务访问集中在20%的数据上。既然大部分的业务访问集中在一小部分的数据上，那么如果把这一小部分数据缓存在内存中，是不是可以减少数据库的访问压力呢？ 提高整个网站的数据访问速度，改善数据库的写入性能呢？</p><p>网站使用的缓存可以分为两种： 缓存在应用服务器上的本地缓存和缓存在专门的分布式缓存服务器上的远程缓存。本地缓存的访问速度更快些，但是受应用服务器内存的限制，其缓存数量有限，而且会出现和应用程序争用内存的情况。 远程分布式缓存可以使用集群的方式，部署大内存的服务器作为专门的缓存服务器，可以理论上做到不受内存容量限制的缓存服务。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tNc79gy1foyjm3jg7yj30kg0fp0ts.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>使用缓存后，数据访问的压力得到有效的缓解，但是单一应用服务器能够处理的请求连接有限；在网站访问的高峰期，应用服务器成为整个网站的瓶颈。</p><h3 id="进一步提升（应用集群）"><a href="#进一步提升（应用集群）" class="headerlink" title="进一步提升（应用集群）"></a>进一步提升（应用集群）</h3><p>应用服务器集群改善网站的并发处理能力，使用集群时网站解决高并发、海量数据问题的常用手段。当一台服务器的处理能力、存储空间不足时，不要企图去换更强大的服务器，对大型网站而言，不管多么强大的服务器，都满足不了网站持续增长的业务需求。这种情况下，更恰当的做法是增加一台服务器分担原有服务器的访问以及存储压力。</p><p>对网站架构而言，只要能通过增加一台服务器的方式改善负载压力，就可以以同样的方式持续增加服务器不断改善系统性能，从而实现系统的可伸缩性。应用系统服务器实现集群时网站可伸缩集群架构设计中较为简单成熟的一种。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws3.sinaimg.cn/large/006tNc79gy1foykc75g2dj30r90fpdh9.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>通过负载均衡调度器，可以将用户浏览器的访问请求分发到应用服务器集群中的任何一台服务器上，如果有更多的用户，就在集群中加入更多的应用服务器，使应用服务器的负载压力不再成为网站的瓶颈。</p><h3 id="进一步升级（数据库读写分离）"><a href="#进一步升级（数据库读写分离）" class="headerlink" title="进一步升级（数据库读写分离）"></a>进一步升级（数据库读写分离）</h3><p>网站使用缓存后，绝大部分数据读操作访问都可以不通过数据库就能够完成，但是仍有一部分读操作（缓存访问不命中、缓存过期）和全部的写操作都需要访问数据库，在网站到达一定规模后，数据库因为负载压力过高而成为网站的瓶颈。</p><p>目前大部分的主流数据库都是提供主从热备功能，通过配置两台数据库主从关系，可以将一台数据库服务器的数据更新同步到另一台服务器上。网站利用数据库的这一功能，实现数据库读写分离，从而改善数据库负载压力。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tNc79gy1foykzuawthj30r90h0tag.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><p>应用服务器在写数据的时候，访问主数据库，主数据库通过主从复制机制将数据库更新同步到从数据库，这样当应用服务器读数据的时候，就可以通过从数据库获得数据。为了便于应用程序访问读写分离后的数据库，通常在应用服务器端使用专门的数据访问模块，使数据库读写分离对应用透明。</p><h3 id="再次简单升级（反向代理和CDN加速网站响应）"><a href="#再次简单升级（反向代理和CDN加速网站响应）" class="headerlink" title="再次简单升级（反向代理和CDN加速网站响应）"></a>再次简单升级（反向代理和CDN加速网站响应）</h3><p>用户规模越来越大，由于中国的复杂网络环境，不同地区的用户访问网站时，速度差别也极大。数据显示： 网站访问延迟和用户流失率正相关，网站访问越慢，用户越容易失去耐心而离开。 为了提供更好的用户体验，留在用户，需要加速网站访问速度。 主要手段使用CDN和反向代理。</p><p>反向代理和CDN的基本原理是缓存，区别在于CDN部署在网络提供商的机房，使用户在请求网站服务时，可以从距离自己最近的网络提供商机房获取数据； 而反向代理则部署在网站的中心机房，当用户请求到达中心机房后，首先访问的服务器是反向代理服务器，如果反向代理服务器中缓存着用户请求的资源，就将其直接返回给用户。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fp1qnmet5yj30t60l6768.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><h3 id="再次升级（分布式文件-分布式数据库）"><a href="#再次升级（分布式文件-分布式数据库）" class="headerlink" title="再次升级（分布式文件/分布式数据库）"></a>再次升级（分布式文件/分布式数据库）</h3><p>数据库经过读写分离后，从一台服务器拆分成两台服务器，但是随着网站业务的发展依然不能满足，这时需要使用分布式数据库。 文件系统也是一样，需要使用分布式系统。 分布式数据库是网站数据库拆分的最后手段，只有在单表数据规模非常庞大的时候才使用。不到不得已时，网站更常用的数据库拆分手段时业务分库，将不同业务的数据部署在不同的物理服务器上。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fp1qxys6wzj30tt0jk407.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><h3 id="优化设计（NoSQL和搜索引擎）"><a href="#优化设计（NoSQL和搜索引擎）" class="headerlink" title="优化设计（NoSQL和搜索引擎）"></a>优化设计（NoSQL和搜索引擎）</h3><p>随着网站业务越来越复杂，对数据存储和检索的需求也越来越复杂化，网站需要采用一些非关系数据技术如NoSQL和非数据库查询技术如搜索引擎。</p><p>NoSQL和搜索引擎都是源自互联网的技术手段，对可伸缩的分布式特效具有更好的支持。 应用服务器则通过一个统一数据访问模块访问各种数据，减少应用程序管理的诸多数据源的麻烦。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fp1r97zw8fj30tt0jkq4w.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><h3 id="拆分设计（业务拆分）"><a href="#拆分设计（业务拆分）" class="headerlink" title="拆分设计（业务拆分）"></a>拆分设计（业务拆分）</h3><p>大型网站为了应对日益复杂的业务场景，通过使用分而治之的手段将整个网站业务分成不同的产品线。 具体到技术上，将一个网站拆分成为许多不同的应用（有点微服务器的感觉）， 每个应用独立部署维护。 应用之间可以通过一个超链接建立关系（在首页上的导航链接每个都指向不同的应用地址），也可以通过消息队列进行数据分发，当然最多的还是通过访问同一个数据存储系统来构建一个关联的完整系统。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fp1xt3gijdj30tt0jktb4.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure><h3 id="分布式服务"><a href="#分布式服务" class="headerlink" title="分布式服务"></a>分布式服务</h3><p>由于所有应用要和所有数据库系统连接，在数万台服务器规模的网站中，这些连接的数目是服务器规模的平方，导致存数据库接资源不足，拒绝服务。</p><p>既然每一个应用都需要执行相同的业务操作，比如： 用户管理、商品管理等，那么可以将这些共有的业务提取出来，独立部署。 由这些可复用的业务连接数据库，提供共用业务服务，而应用系统只需要管理用户界面，通过分布式服务调用共有业务服务完成具体业务操作。</p><p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fp1y7nakpgj30tt0q0tbl.jpg" alt></p><p>书籍参考： 大型网站架构核心原理与解析</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;分布设计架构思路&quot;&gt;&lt;a href=&quot;#分布设计架构思路&quot; class=&quot;headerlink&quot; title=&quot;分布设计架构思路&quot;&gt;&lt;/a&gt;分布设计架构思路&lt;/h2&gt;&lt;h3 id=&quot;初步设计&quot;&gt;&lt;a href=&quot;#初步设计&quot; class=&quot;headerlink&quot; 
      
    
    </summary>
    
    
      <category term="framework" scheme="http://lmwtuedu.cn/categories/framework/"/>
    
    
      <category term="framework" scheme="http://lmwtuedu.cn/tags/framework/"/>
    
  </entry>
  
  <entry>
    <title>当前流行的一些软件保护技术</title>
    <link href="http://lmwtuedu.cn/2018/03/02/2018-03-02-%E5%BD%93%E5%89%8D%E6%B5%81%E8%A1%8C-%E7%9A%84%E4%B8%80%E4%BA%9B%E8%BD%AF%E4%BB%B6%E4%BF%9D%E6%8A%A4%E6%8A%80%E6%9C%AF/"/>
    <id>http://lmwtuedu.cn/2018/03/02/2018-03-02-当前流行-的一些软件保护技术/</id>
    <published>2018-03-01T16:00:00.000Z</published>
    <updated>2019-09-17T08:12:56.264Z</updated>
    
    <content type="html"><![CDATA[<h2 id="当前流行的一些软件保护技术"><a href="#当前流行的一些软件保护技术" class="headerlink" title="当前流行的一些软件保护技术"></a>当前流行的一些软件保护技术</h2><h3 id="序列号保护"><a href="#序列号保护" class="headerlink" title="序列号保护"></a>序列号保护</h3><p>数学算法一项都是密码加密的核心，但在一般的软件加密中，它似乎并不太为人们关心，因为大多数时候软件加密本身实现的都是一种编程技巧。 但近几年来随着序列号加密程序的普及，数学算法在软件加密中的比重似乎是越来越大了。</p><p>看看在网络上大行其道的序列号加密的工作原理。当用户从网络上下载某个shareware——共享软件后，一般都有使用时间上的限制，当过了共享软件的试用期后，你必须到这个软件的公司去注册后方能继续使用。注册过程一般是用户把自己的私人信息（一般主要指名字）连同信用卡号码告诉软件公司，软件公司会根据用户的信息计算出一个序列号，在用户得到这个序列号后，按照注册需要的步骤在软件中输入注册信息和注册码，其注册信息的合法性由软件验证通过后，软件就会取消本身的各种限制，这种加密实现起来比较简单，不需要额外的成本，用户购买也非常方便，在互联网上的软件80%都是以这种方式来保护的。</p><p>软件验证序列号的合法性过程，其实就是验证用户名和序列号之间的换算关系是否正确的过程。其验证最基本有两种，一种是按照用户输入的姓名来生成注册码，再同用户输入的注册码比较，公式表示如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">序列哈 = F(用户名)</span><br></pre></td></tr></table></figure><p>这种方法等于在用户软件中再现了软件公司生产注册码的过程，实际上是非常不安全的，不论其过程是多么的复杂，解密者只需把你的换算过程从程序中提取出来就可以编制一个通用的注册程序。</p><p>另外一种是通过注册码来验证用户名的正确性，公式表示如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用户名称 = F逆（序列号）（如 ACDSEE）</span><br></pre></td></tr></table></figure><p>这其实是软件公司注册码计算过程的反算法，如果正向算法与反向算法不是对称算法的话，对于解密者来说，的确有些困难，但这种算法相当不好设计。</p><p>于是有人考虑以下的算法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F1(用户名称) = F2（序列号）</span><br></pre></td></tr></table></figure><p>F1、F21是两种完全不同的算法，但用户名通过F1算法计算出的特征字等于序列号通过F2计算出的特征字，这种算法在设计上比较简单，保密性相对以上两种算法也要好的多，如果能够把F1、F2算法设计成不可逆算法的话，保密性相当的好；可一旦解密者找到其中之一的反算法的话，这种算法就不安全了，一元算法的设计看来再如何努力也很难有太大的突破，那么二元呢？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">特定值 = F(用户名，序列号)</span><br></pre></td></tr></table></figure><p>这个算法看上去相当不错，用户名称和序列号之间的关系不再那么清晰了，但同时也失去了用户名与序列号的一一对应关系，软件开发者必须自己维护用户名称与序列号之间的唯一性，但这似乎不是难以办到的事，建立一个数据库就可以了。当然也可以把用户名称和序列号分为几部分来构造多元的算法。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">特定值 = F（用户名1， 用户名2， ···， 序列号1， 序列号2， ····）</span><br></pre></td></tr></table></figure><p>现有的序列号加密算法大多是软件开发者自行设计的，大部分相当简单。而且有些算法作者虽然下了很大的功夫，效果却往往得不到它所希望的结果。</p><h2 id="时间限制"><a href="#时间限制" class="headerlink" title="时间限制"></a>时间限制</h2><p> 有些程序的试用版每次运行都有时间限制，例如运行10分钟或20分钟就停止工作，必须重新运行该程序才能正常工作。这些程序里面自然有个定时器来统计程序运行的时间。</p><p> 这种方法使用的较少。</p><h2 id="Key-File-保护"><a href="#Key-File-保护" class="headerlink" title="Key File 保护"></a>Key File 保护</h2><p>Key File（注册文件）是一种利用文件来注册软件的保护方式。 Key File一般是一个文件，可以是纯文本文件，也可以是包含不可显示字符的二进制文件，其内容是一些加密过或未加密的数据。其中可能有用户名、注册码等信息。 文件格式则由软件作者自己定义。试用版软件没有注册文件，当用户向作者付费之后，会收到作者寄来的注册文件，其中可能包含用户的个人信息。用户只要将该文件放入指定目录，就可以让软件成为正式版。该文件一般是放在软件的安装目录中或者系统目录下。软件每次启动时，从该文件中读取数据，然后利用某种算法进行处理，根据处理的结果判断是否为正确的注册文件，如果正确则注册版模式来运行。</p><p>这种保护方法使用也不多</p><h3 id="CD-check（基本淘汰）"><a href="#CD-check（基本淘汰）" class="headerlink" title="CD-check（基本淘汰）"></a>CD-check（基本淘汰）</h3><p>　　即光盘保护技术。程序在启动时判断光驱中的光盘上是否存在特定的文件，如果不存在则认为用户没有正版光盘，拒绝运行。在程序运行的过程当中一般不再检查光盘的存在与否。Windows下的具体实现一般是这样的：先用GetLogicalDriveStrings（ ）或GetLogicalDrives（ ）得到系统中安装的所有驱动器的列表，然后再用GetDriveType（ ）检查每一个驱动器，如果是光驱则用CreateFileA（ ）或FindFirstFileA（ ）等函数检查特定的文件存在与否，并可能进一步地检查文件的属性、大小、内容等。　　</p><h3 id="软件狗"><a href="#软件狗" class="headerlink" title="软件狗"></a>软件狗</h3><p>   软件狗是一种智能型加密工具。它是一个安装在并口，串口等接口上的硬件电路，同时有一套使用各种语言的接口软件和工具软件。当被狗保护的软件运行时，程序向插在计算机上的软件狗发出查询命令，软件狗迅速计算查询并给出响应，正确的响应保证软件继续运行。如果没有软件狗，程序将不能运行，复杂的软硬件技术结合在一起防止软件盗版。真正有商业价值得软件一般都用软件狗来保护。</p><p>   平时常见的狗主要有“洋狗”（国外狗）和“土狗”（国产狗）。这里“洋狗”主要指美国的彩虹和以色列的HASP，“土狗”主要有金天地（现在与美国彩虹合资，叫“彩虹天地”）、深思、尖石。总的说来，“洋狗”在软件接口、加壳、反跟踪等“软”方面没有“土狗”好，但在硬件上破解难度非常大；而“土狗”在软的方面做的很好，但在硬件上不如“洋狗”，稍有单片机功力的人，都可以复制。</p><h3 id="软盘加密"><a href="#软盘加密" class="headerlink" title="软盘加密"></a>软盘加密</h3><p>　　通过在软盘上格式化一些非标准磁道，在这些磁道上写入一些数据，如软件的解密密钥等等。这种软盘成为“钥匙盘”。软件运行时用户将软盘插入，软件读取这些磁道中的数据，判断是否合法的“钥匙盘”。</p><p>　　软盘加密还有其它一些技术，如弱位加密等等。</p><p>　　随着近年来软盘的没落，这种方法基本上退出了历史舞台。　　</p><h3 id="将软件与机器硬件信息结合"><a href="#将软件与机器硬件信息结合" class="headerlink" title="将软件与机器硬件信息结合"></a>将软件与机器硬件信息结合</h3><p>用户得到（买到或从网上下载）软件后，安装时，软件从用户的机器上取得该机器的一些硬件信息（如硬盘序列号，BOIS序列号等等），然后把这些信息和用户的序列号、用户名等进行计算，从而在一定程度上将软件和硬件部分绑定。用户需要把这一序列号用Email、电话或邮寄等方式给软件供应商，软件开发商利用注册机（软件）产生该软件的注册号寄给用户即可。软件加密虽然加密强度比硬件方法较弱，但它具有非常廉价的成本、方便的使用方法等优点。非常适合作为采用光盘（CDROM）等方式发授软件的加密方案。</p><p>此种加密算法的优点：</p><ul><li>不同机器注册码不同。用户获得一个密码只能在一台机器上注册使用软件。不同于目前大多软件采用的注册方法，即只要知道注册码，可在任何机器上安装注册。</li><li>不需要任何硬件或软盘</li><li>可以选择控制软件运行在什么机器、运行多长时间或次数等</li><li>可让软件在不注册的功能为演示软件，只能运行一段时间或部分功能。注册后立即变成为正式软件</li><li>采用特别技术，解密者很难找到产生注册码的规律</li><li>在使用注册码产生软件（注册机）时可以采用使用密码、密码盘、总次数限制等方法。</li><li>方便易用，价格低廉。</li></ul><p>这种加密还有以下特点：</p><ol><li>注册加密的软件，只能在一台机器上安装使用。把软件拷贝到其它机器上不能运行。</li><li>若用户想在另一台机器上安装运行，必须把软件在这台机器上运行的序列号，寄送给软件出版商换取注册码，当然再交一份软件费用。</li><li>此加密方法特别适应在因特网上发布的软件以及光盘发布的软件。  </li></ol><p><a href="http://www.williamlong.info/archives/704.html" target="_blank" rel="noopener">软件加密技术和注册机制</a></p><h2 id="授权验证"><a href="#授权验证" class="headerlink" title="授权验证"></a>授权验证</h2><h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ol><li>RSA非对称加密，公钥加密，私钥解密，保证license信息安全。</li><li>私钥签名公钥验证，数字签名：防止license被冒充签发（认证）； 保证数据完整性； 数字签名具有不可抵赖性（即不可否认性）。</li><li>硬件信息采集，防止程序被无限拷贝。</li><li>授权截止时间，完成业务上授权需求。</li><li>使用license的业务代码混淆加密，防止反编译替换跳过验证流程。（其实看设计的复杂程度，破解只是时间问题）</li><li>可以加入自定义数据（授权版本、授权对象、授权功能列表）等等，方便扩展。</li></ol><h2 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h2><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://ws1.sinaimg.cn/large/006tNc79gy1foyifqkqdyj30n20readi.jpg" alt title>                </div>                <div class="image-caption"></div>            </figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;当前流行的一些软件保护技术&quot;&gt;&lt;a href=&quot;#当前流行的一些软件保护技术&quot; class=&quot;headerlink&quot; title=&quot;当前流行的一些软件保护技术&quot;&gt;&lt;/a&gt;当前流行的一些软件保护技术&lt;/h2&gt;&lt;h3 id=&quot;序列号保护&quot;&gt;&lt;a href=&quot;#序列号保
      
    
    </summary>
    
    
      <category term="code" scheme="http://lmwtuedu.cn/categories/code/"/>
    
    
      <category term="safe" scheme="http://lmwtuedu.cn/tags/safe/"/>
    
  </entry>
  
  <entry>
    <title>QPS、PV、RT（响应时间）之间的关系</title>
    <link href="http://lmwtuedu.cn/2018/02/27/2018-02-27-QPS%E3%80%81PV%E3%80%81RT%EF%BC%88%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4%EF%BC%89%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB/"/>
    <id>http://lmwtuedu.cn/2018/02/27/2018-02-27-QPS、PV、RT（响应时间）之间的关系/</id>
    <published>2018-02-26T16:00:00.000Z</published>
    <updated>2019-09-17T08:12:29.142Z</updated>
    
    <content type="html"><![CDATA[<h2 id="QPS、PV、RT（响应时间）之间的关系"><a href="#QPS、PV、RT（响应时间）之间的关系" class="headerlink" title="QPS、PV、RT（响应时间）之间的关系"></a>QPS、PV、RT（响应时间）之间的关系</h2><p>在进行系统性能压测和系统性能优化的时候，会涉及到QPS、PV、RT相关的概念。</p><h3 id="QPS"><a href="#QPS" class="headerlink" title="QPS"></a>QPS</h3><p>QPS： query per seconds 单个进程每秒请求服务器的成功次数</p><p>QPS = rep/sec = 请求数/秒</p><h3 id="QPS如何统计？"><a href="#QPS如何统计？" class="headerlink" title="QPS如何统计？"></a>QPS如何统计？</h3><p>QPS统计方式【一般使用http_load进行统计】</p><p>QPS= 总请求数 /（进程总数*请求时间）</p><h3 id="根据QPS推算PV"><a href="#根据QPS推算PV" class="headerlink" title="根据QPS推算PV"></a>根据QPS推算PV</h3><p>单台服务器每天PV计算<br>公式1: 每天总PV = QPS<em>3600</em>6<br>公式2: 每天总PV = QPS<em>3600</em>8</p><h3 id="根据QPS、PV推算服务器数量"><a href="#根据QPS、PV推算服务器数量" class="headerlink" title="根据QPS、PV推算服务器数量"></a>根据QPS、PV推算服务器数量</h3><p>服务器数量 = 每天总PV / 单台服务器每天总PV</p><p>峰值QPS和机器计算公式：</p><p>原理： 每天80%的访问集中在20%的时间里，这20%时间叫做峰值时间</p><p>峰值时间每秒请求数（QPS）： （总PV数 * 80%）/（每天秒数*20%）</p><p>峰值机器数量： 峰值时间QPS / 单台机器的QPS</p><p>例子：</p><p>Q： 每天300W PV的在单台机器上，这台机器需要多少QPS？</p><p>A： （3000000 * 0.8）/（86400 * 0.2） = 139（QPS）</p><p>Q： 如果一台机器的QPS是58， 需要几台机器来支持？ </p><p>A： 139/58 = 3</p><h3 id="最佳线程数"><a href="#最佳线程数" class="headerlink" title="最佳线程数"></a>最佳线程数</h3><p>性能压测的情况下, 起初随着用户的增加， QPS会上升，当到了一定的阀值之后，用户数量增加QPS并不会增加，或者增加不明显，同时请求的响应时间却大幅增加，这个阀值我们认为是最佳线程数。</p><p>为什么要找最佳线程数？</p><ul><li>过多的线程只会造成，更多的内存开销，更多的CPU开销，但是对提升QPS确毫无帮助</li><li>找到最佳线程数后通过简单的设置，可以让web系统更加稳定，得到最高、最稳定的QPS输出。</li></ul><p>最佳线程数的获取：</p><ul><li>通过用户慢慢递增来进行性能压测，观察QPS，响应时间</li><li>根据公式计算： 服务器端最佳线程数量 = （（线程等待时间 + 线程CPU时间）/（线程CPU时间））* cpu数量</li><li>单用户压测，查看CPU的消耗，然后直接乘以百分比，再进行压测，一般这个值的附近应该就是最佳线程数量。</li></ul><h3 id="影响最佳线程数的主要因素"><a href="#影响最佳线程数的主要因素" class="headerlink" title="影响最佳线程数的主要因素"></a>影响最佳线程数的主要因素</h3><ol><li><p>IO</p><p> IO开销较多的应用，其CPU线程等待时间会比较长，所以线程数量可以开的多一些，相反则线程数量要少一些， 其实有两种极端，纯IO的应用，比如 proxy， 则线程数量可以开到非常大（实在太大了则需要考虑线程切换的开销），这种应用基本上后端（比如这个proxy是代理搜索的）的QPS能有多少， proxy就有多少。</p></li><li><p>CPU</p><p> 对于耗CPU的计算，这种情况一般来讲只能开到CPU个数的线程数量。但是并不是说这种应用的QPS就不高，往往这种应用QPS可以很高，因为耗CPU计算的应用，往往处理单次请求的时间会很短。</p></li><li><p>QPS和线程数的关系</p><ol><li>在最佳线程数量之前，QPS和线程是相互递增的关系，线程数量到了最佳线程之后，QPS持平，不在上升，甚至略有下降，同时响应时间持续上升。</li><li>同一个系统而言，最佳线程数越多，QPS越高。</li></ol></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;QPS、PV、RT（响应时间）之间的关系&quot;&gt;&lt;a href=&quot;#QPS、PV、RT（响应时间）之间的关系&quot; class=&quot;headerlink&quot; title=&quot;QPS、PV、RT（响应时间）之间的关系&quot;&gt;&lt;/a&gt;QPS、PV、RT（响应时间）之间的关系&lt;/h2&gt;&lt;
      
    
    </summary>
    
    
      <category term="code" scheme="http://lmwtuedu.cn/categories/code/"/>
    
    
      <category term="QPS" scheme="http://lmwtuedu.cn/tags/QPS/"/>
    
      <category term="PV" scheme="http://lmwtuedu.cn/tags/PV/"/>
    
      <category term="RT" scheme="http://lmwtuedu.cn/tags/RT/"/>
    
  </entry>
  
  <entry>
    <title>每个人都逃不掉的消费陷阱</title>
    <link href="http://lmwtuedu.cn/2018/02/24/2018-02-24-%E6%AF%8F%E4%B8%AA%E4%BA%BA%E9%83%BD%E9%80%83%E4%B8%8D%E6%8E%89%E7%9A%84%E6%B6%88%E8%B4%B9%E9%99%B7%E9%98%B1/"/>
    <id>http://lmwtuedu.cn/2018/02/24/2018-02-24-每个人都逃不掉的消费陷阱/</id>
    <published>2018-02-23T16:00:00.000Z</published>
    <updated>2019-09-17T08:12:04.639Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>世界就是这样， 好马配好鞍，好船配好帆，王八对绿豆，傻X配脑瘫，没有太大意外，万物都会自然归位。</p></blockquote><p><a href="http://www.botanwang.com/node/103023" target="_blank" rel="noopener">每个人都逃不掉的消费陷阱</a></p><p>农历狗年春节来临，返乡或出游的人们开启了“买买买”模式。根据银联的报告，去年春节从除夕到正月初五期间，中国人光是银联刷卡就消费了3787亿元。在消费升级的大环境下，预计2018年春节期间的消费将继续保持10%以上的增长态势，而整个2018年，社会消费品零售总额或将突破40万亿元人民币。</p><p>不过，当你在愉快地“买买买”的同时是否有思考过，自己是否真的需要自己花钱买的每一件商品？如果答案为否，那么，购物的意义又何在呢？你的每一次不经意的购物，是不是也在不知不觉之中让自己掉入了一个看不见的消费陷阱？</p><p>实际上，现在潜伏在我们每个人面前的，确实有一个看不见的消费陷阱。在不知不觉间，很多人不幸掉落进这个陷阱之中。而讽刺的是，我们设置这个陷阱的原因，恰恰是以“经济发展”为不可辩驳的理由。</p><p>一、挤泡沫、打房价，最终还是为了拉动消费</p><p>进入2018年，除了消费的预期普遍增高，还有另一个数据也引人注意，那就是房贷的利率进一步上升。</p><p>据统计，去年四季度房贷利率平均5.26%，已经持续近一年的上升趋势，而在2018年1月，全国首套房的平均利率已经上升到5.43%，相当于基准利率1.11.倍，比上月上升0.93%。</p><p>从房贷利率从去年持续至今的不断上调，可以看到有关部门抑制房价泡沫的意愿。整个2018年，去资产泡沫的大方向应该也不会停下来。</p><p>在房地产泡沫被不断抑制的同时，我们发现消费在经济中占比的作用越来越大。据统计局数据，去年，中国经济的总增长中有58.8%都是由消费贡献。官方对于经济增长的宏观叙述，也由传统的“投资拉动”改为“消费和投资共同拉动”。</p><p>这个叙述方式的细微改变，反映出了经济部门思路的转变，这对于我们每个人的生活都会产生很大的影响。</p><p>在房价泡沫因为低利率而高涨的日子里，普通人年均工资买不了几平米的楼房，尤其一线城市的资产泡沫膨胀，造成了巨大的生活成本压力，使得普通人为了储钱买房而长期不愿消费、不敢消费。</p><p>因此，如果要充分释放普通人的消费能力，首先必须让房价不再像过去那样疯长。这样，人们才有可能存的下更多的钱用于消费。</p><p>此外，在稳住房价的同时，还得让那些买不起房的人们打消“储钱买房”的长期打算，愿意把手里的钱花出去。这就需要建立长期的公共住房制度。</p><p>我们看到，最近召开的经济工作会议，再次强调了尽快建设“多主体供应、多渠道保障、租购并举的住房制度”，也就是所谓的住房长效机制。传媒接二连三的强调住房长效机制建设，可见解决这个问题对于国家来讲有多么的急迫。</p><p>这有几分模仿新加坡的住房制度。在“新加坡模式”的住房制度下，昂贵的商品房是专属富人之间的买卖，而中下收入者普遍住进了福利性住房和政府提供的公共住房。这些房子不会给住户产权，但却可以长期赋予其居住使用权。</p><p>这样做的最大作用，就是用提供住廉价房的方法，让占据社会大多数的中下层人士能够安心的工作，踏实的消费，为经济增长作出贡献。</p><p>俗话说，“民无恒产，则无恒心”，但大部分人一辈子其实也积累不下什么价值昂贵的“恒产”，试问他们怎么可能安心消费？在无法改变大部分人没有“恒产”的情况下，用各种办法给予他们基本安全感，然后引导他们花钱消费，就成为了实现经济增长的重要方法。</p><p>在中国经济的巨大存量中，房地产在过去占据了大部分的比例，两年前，地产总价值已占GDP的411%，远远超过国际水准。现在，要想把过度依靠地产的经济转变为“消费拉动型”经济，就必需要以各种手段从房地产中挤出一部分资金，让其流到消费领域。</p><p>住房的长效机制和各种抑制不动产泡沫的手段，都是为消费增长做铺垫的手段之一。</p><p>不过，仅仅如此依然没办法大幅提高消费。原因在于，中国的流动性依然很紧，人们的收入增长依然不够多。</p><p>目前的中国，逐渐进入了一个“缺钱”的状态，虽然最新的数据显示中国的信贷创下新高，但是，流通中货币余额只有7.46万亿元，同比下降13.8%。人民币的货币流通性其实是在下降，人们手里真正能用来交换的钱其实依然很紧，与此同时，中国的居民收入增长水平似乎还撑不起一个庞大的“消费型经济”。</p><p>众所周知，这些年来中国人均收入有明显的增长，2017年城镇居民人均可支配收入36396元，比起08年金融危机时的15781元，增长幅度很大。</p><p>但如果横向比较，就会发现差距。中国的居民人均可支配收入水平相当于同期美国水平的约12%、日本水平的26%、韩国水平的35%、英国水平的17%，大约等同于美国上世纪70年代初的水平。</p><p>如此低下的收入水平，仅仅靠从住房端“减负”显然不足以改变经济增长的模式。</p><p>二、透支自己未来的人，将掉进消费的陷阱</p><p>进一步促进人们消费的直接方式在于：增加负债。</p><p>道理很简单：如果现在的钱不够消费，那就透支未来的钱提前消费，以后慢慢还。人们从货币购买力的不断贬值的事实中学到一课：时间越往后，钱越不值钱。因此，欠钱的时间越长，随着货币贬值，还债压力就会持续减小。既如此，不欠白不欠啊。</p><p>于是我们看到，中国人对负债的态度这些年发生了180度的大转变，从贷款买房买车，到贷款上学与日常消费，按揭付款越来越流行。</p><p>长期这么下来，老百姓欠下了多少债呢？根据社科院《三季度中国去杠杆进程报告》的数据，居民部门杠杆率延续着上升趋势，2017年前三个季度上升了3.8个百分点，居民的负债与可支配收入之比达到了48.6%。</p><p>这个比例甚至远远高于城镇居民储蓄占可支配收入的比例。也就是说，中国人爱存钱的习惯，正在逐渐被爱欠钱的习惯代替。</p><p>负债的数字当中，其实有超过一半的部分是被房贷占据了。不过，这个趋势未来很可能会发生改变，随着年青一代住房刚需的逐渐减弱，以及上文所说的“住房长效机制”的建立，以后在这个统计当中，纯消费的比例会不断提高，房贷的部分会慢慢减少。</p><p>最终，我们会欠钱购买越来越多不必要的商品，成为消费的奴隶。这并不是危言耸听，那些被裸照逼债的女大学生，还不起钱自杀的年轻人……所有看似个别的现象，其实都是“消费转型”的总体趋势下必然会发生的事情。</p><p>你是否发现了一个悲催的现实：老百姓欠债的事实一直没变，改变的是债务类别。从过去长期的房贷欠债变成了未来的消费品债务。随着债务类型的改变，所谓的经济增长模式也相应的发生了改变。但实际上，欠下巨款、吭哧搬砖还钱的从来都是同一拨人。</p><p>这一拨人，被消费两个字坑得不轻。</p><p>从买房买车，到买各种奢侈品，在社会功能上，“买买买”有一个巨大的作用，那就是以消费品来区分社会阶级。中国人根深蒂固的概念是：用房、车、包、表、衣的品牌来评价一个人的社会阶层。于是，人们玩命的购买象征着“上流阶层”的商品，无以复加的来包装自己，攀比成风、享受成风，最后的结果就是债务成山。</p><p>然而，消费其实并不能实际上改变人的阶层，消费实际的作用，无非是产生了市场交换、推动GDP增长。也就是说，消费行为成为了推动经济向前发展的“燃料”。</p><p>这有点像韩国电影《雪国列车》的情节设置。在雪原上奔驰的列车里，不同的乘客按照阶层坐在不同车厢，高级阶层坐在列车前端的豪华车厢，低阶阶层坐在列车末尾简陋的硬座车厢。</p><p>在硬座车厢的人，无论怎么努力、花多少钱疏通关系，都无法挤进前面的优等车厢。那么这些硬座乘客有什么用呢？他们的“作用”就在于为这列火车提供燃料。</p><p>当你花掉你手里的钱，就像是为火车燃烧的锅炉里添加了一铲煤，为火车提速，这其实就是在为经济做贡献。但是，这一笔“经济燃料”燃烧后产生的“废料”却需要你自己承担，那“废料”就是债务，需要你亲手偿还。</p><p>这就是消费者最可悲的地方。</p><p>政治学家拉斯基曾说过：“消费者几乎不采取行动来控制他们的环境……他们不表达自己的需求，只是等着商家来发现自己的需求，并且商家也只是在能盈利时才会来满足这些需求。”</p><p>这段话精辟地总结出了消费者长期被操控、被商家剪羊毛的特性。硬座车厢里的乘客，其实就是负债最多的消费者。</p><p>当经济发展已正式转变为“消费拉动”时，广大的消费者是时候长点心了。请在买买买的冲动爆发之前，先想清楚几件事：第一，我买的东西是否是我生活必须的；第二，我是否能在消费后依然保持不欠债的财务原则；第三，每一笔花出去的钱，如果视为投入，那么回报是什么？</p><p>你只有按照这个思路持续玩下去，才有可能在经济的游戏中避免陷入消费的陷阱。否则，等待你的命运就是成为火车锅炉里的那块烧红的煤炭，燃烧自己照亮别人，成为经济机器运转的炮灰。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;世界就是这样， 好马配好鞍，好船配好帆，王八对绿豆，傻X配脑瘫，没有太大意外，万物都会自然归位。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://www.botanwang.com/node/103023&quot; target=
      
    
    </summary>
    
    
      <category term="article" scheme="http://lmwtuedu.cn/categories/article/"/>
    
    
      <category term="news" scheme="http://lmwtuedu.cn/tags/news/"/>
    
  </entry>
  
</feed>
